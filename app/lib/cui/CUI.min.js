!function(a){var b={kitId:"jwv7ouu",scriptTimeout:3e3};if(!a.Typekit){var c=document.getElementsByTagName("html")[0];c.className+=" wf-loading";var d=setTimeout(function(){c.className=c.className.replace(/(\s|^)wf-loading(\s|$)/g," "),c.className+=" wf-inactive"},b.scriptTimeout),e=document.createElement("script"),f=!1;e.src="//use.typekit.net/"+b.kitId+".js",e.type="text/javascript",e.async="true",e.onload=e.onreadystatechange=function(){var a=this.readyState;if(!(f||a&&"complete"!=a&&"loaded"!=a)){f=!0,clearTimeout(d);try{Typekit.load(b)}catch(c){}}};var g=document.getElementsByTagName("script")[0];g.parentNode.insertBefore(e,g)}}(this);var Class,Exception;!function(){var a=function(a){var b=a.bind(this);return b._methodName=a._methodName,this[b._methodName]=b,b},b=function(a){return a.extend=this,new Class(a)};Class=function(c){if(c=c||{},c.hasOwnProperty("extend")&&!c.extend)throw new Class.NonTruthyExtendError("function"===c.toString?c.toString():c.toString);var d=c.extend||Object,e=c.construct,f=c.destruct;if(delete c.bind,delete c.extend,delete c.destruct,delete c.construct,c.hasOwnProperty("toString")&&"function"!=typeof c.toString){var g=c.toString;c.toString=function(){return g.toString()}}else!c.hasOwnProperty("toString")&&d.prototype.hasOwnProperty("toString")&&(c.toString=d.prototype.toString);var h=c,i=Object.create(d&&d.prototype);if(i.superClass=d.prototype,h)for(var j in h)h.hasOwnProperty(j)&&(i[j]=h[j],"function"==typeof h[j]&&(i[j]._methodName=j,i[j]._parentProto=i));i.inherited=function(a){var b=a.callee,c=b._methodName;if(!c)throw new Class.MissingCalleeError(this.toString());for(var d=b._parentProto,e=null;d.superClass&&(d=d.superClass,e=d[c],"function"!=typeof e););if("function"==typeof e){var f=this.inherited;this.inherited=d.inherited;var g=e.apply(this,a);return this.inherited=f,g}throw new Class.InheritedMethodNotFoundError(this.toString(),c)},i.bind=a,i.destruct=function(){"function"==typeof f&&f.apply(this),d&&d.prototype&&"function"==typeof d.prototype.destruct&&d.prototype.destruct.apply(this)},i.construct=function(){var a=arguments;void 0===a[0]&&(a.length=1,a[0]={}),d&&d.prototype&&"function"==typeof d.prototype.construct&&d.prototype.construct.apply(this,arguments),"function"==typeof e&&e.apply(this,arguments)};var k=function(){var a=Object.create(i);return i.construct.apply(a,arguments),a};return k.toString=i.toString,k.prototype=i,k.extend=b,i.constructor=k,k},Object.create||(Object.create=function(a){function b(){}if(arguments.length>1)throw new Error("Object.create implementation only accepts the first parameter.");return b.prototype=a,new b}),Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),Exception=new Class({extend:Error,construct:function(){this.name="Error",this.message="General exception"},toString:function(){return this.name+": "+this.message}});var c=Exception.extend({name:"Class Exception"});Class.NonTruthyExtendError=c.extend({construct:function(a){this.message=a+" attempted to extend a non-truthy object"}}),Class.InheritedMethodNotFoundError=c.extend({construct:function(a,b){this.message=a+" can't call method '"+b+"', no method defined in parent classes"}}),Class.MissingCalleeError=c.extend({construct:function(a){this.message=a+" can't call inherited method: calling method did not have _methodName"}})}(),function(a,b){b.CUI=b.CUI||{},CUI.options=a.extend({debug:!1,dataAPI:!0},CUI.options),a(function(){a(document).trigger("cui-contentloaded")})}(jQuery,this),function(a,b){var c=1;CUI.util={isTouch:"ontouchstart"in b,getNextId:function(){return"coral-"+c++},getDataTarget:function(b){var c=b.attr("href"),d=a(b.attr("data-target")||c&&c.replace(/.*(?=#[^\s]+$)/,""));return d},decapitalize:function(a){return a.slice(0,1).toLowerCase()+a.slice(1)},capitalize:function(a){return a.slice(0,1).toUpperCase()+a.slice(1)},plugClass:function(b,c,d){c=c||CUI.util.decapitalize(b.toString()),a.fn[c]=function(e){var f=arguments;return this.each(function(){var g=a(this),h=a.extend({},g.data(),"object"==typeof e&&e,{element:this}),i=g.data(c)||new b(h);"string"==typeof e?i[e].apply(i,Array.prototype.slice.call(f,1)):a.isPlainObject(e)&&i.set(e),"function"==typeof d&&d.call(this,i)})},a.fn[c].Constructor=b},buildFunction:function(a,b){if(b=b||[],"string"==typeof b&&(b=[b]),a)try{var c=Function;return new c(b,"return "+a+"("+b.join(", ")+");")}catch(d){return null}},selectText:function(b,c,d){var e=b.val();if(e.length>0){c=c||0,d=d||e.length;var f=a(b)[0];if(f.setSelectionRange)f.blur(),f.setSelectionRange(c,d),f.focus();else if(f.createTextRange){var g=f.createTextRange();g.collapse(!0),g.moveEnd("character",d-e.length),g.moveStart("character",c),g.select()}}},getNested:function(a,b){if(!b)return a;for(var c="string"==typeof b?b.split("."):b,d=a;d&&c.length>0;)d=d[c.shift()];return d},isTrue:function(a){return"true"===a}},a("html").toggleClass("touch",CUI.util.isTouch)}(jQuery,this),function(a){function b(b,d){var e,f,g,h=b.nodeName.toLowerCase();return"area"===h?(e=b.parentNode,f=e.name,b.href&&f&&"map"===e.nodeName.toLowerCase()?(g=a("img[usemap=#"+f+"]")[0],!!g&&c(g)):!1):(/input|select|textarea|button|object/.test(h)?!b.disabled:"a"===h?b.href||d:d)&&c(b)}function c(b){return a.expr.filters.visible(b)&&!a(b).parents().addBack().filter(function(){return"hidden"===a.css(this,"visibility")}).length}a.fn.loadWithSpinner=function(b,c,d){var e=a(this);if(b&&(c||e.data("loaded-remote")!==b)){var f=setTimeout(function(){e.html('<div class="spinner large"></div>')},50);e.load(b,function(a,b,c){clearTimeout(f),"error"===b&&(e.html('<div class="alert error"><strong>ERROR</strong> Failed to load content: '+c.statusText+" ("+c.status+")</div>"),e.data("loaded-remote","")),"function"==typeof d&&d.call(this,a,b,c)}),e.data("loaded-remote",b)}},a.fn.finger=function(){return CUI.util.isTouch&&this.on.apply(this,arguments),this},a.fn.pointer=function(){return CUI.util.isTouch||this.on.apply(this,arguments),this},a.fn.fipo=function(){var a=Array.prototype.slice.call(arguments,1,arguments.length);return this.pointer.apply(this,a),a[0]=arguments[0],this.finger.apply(this,a),this},a.extend(a.expr[":"],{data:a.expr.createPseudo(function(b){return function(c){return!!a.data(c,b)}}),focusable:function(c){return b(c,!isNaN(a.attr(c,"tabindex")))},tabbable:function(c){var d=a.attr(c,"tabindex"),e=isNaN(d);return(e||d>=0)&&b(c,!e)}})}(jQuery,this),function(a,b){function c(a,b,c){return[parseFloat(a[0])*(n.test(a[0])?b/100:1),parseFloat(a[1])*(n.test(a[1])?c/100:1)]}function d(b,c){return parseInt(a.css(b,c),10)||0}function e(b){var c=b[0];return 9===c.nodeType?{width:b.width(),height:b.height(),offset:{top:0,left:0}}:a.isWindow(c)?{width:b.width(),height:b.height(),offset:{top:b.scrollTop(),left:b.scrollLeft()}}:c.preventDefault?{width:0,height:0,offset:{top:c.pageY,left:c.pageX}}:{width:b.outerWidth(),height:b.outerHeight(),offset:b.offset()}}a.ui=a.ui||{};var f,g=Math.max,h=Math.abs,i=Math.round,j=/left|center|right/,k=/top|center|bottom/,l=/[\+\-]\d+(\.[\d]+)?%?/,m=/^\w+/,n=/%$/,o=a.fn.position;a.position={scrollbarWidth:function(){if(f!==b)return f;var c,d,e=a("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),g=e.children()[0];return a("body").append(e),c=g.offsetWidth,e.css("overflow","scroll"),d=g.offsetWidth,c===d&&(d=e[0].clientWidth),e.remove(),f=c-d},getScrollInfo:function(b){var c=b.isWindow?"":b.element.css("overflow-x"),d=b.isWindow?"":b.element.css("overflow-y"),e="scroll"===c||"auto"===c&&b.width<b.element[0].scrollWidth,f="scroll"===d||"auto"===d&&b.height<b.element[0].scrollHeight;return{width:f?a.position.scrollbarWidth():0,height:e?a.position.scrollbarWidth():0}},getWithinInfo:function(b){var c=a(b||window),d=a.isWindow(c[0]);return{element:c,isWindow:d,offset:c.offset()||{left:0,top:0},scrollLeft:c.scrollLeft(),scrollTop:c.scrollTop(),width:d?c.width():c.outerWidth(),height:d?c.height():c.outerHeight()}}},a.fn.position=function(b){if(!b||!b.of)return o.apply(this,arguments);b=a.extend({},b);var f,n,p,q,r,s,t=a(b.of),u=a.position.getWithinInfo(b.within),v=a.position.getScrollInfo(u),w=(b.collision||"flip").split(" "),x={};return s=e(t),t[0].preventDefault&&(b.at="left top"),n=s.width,p=s.height,q=s.offset,r=a.extend({},q),a.each(["my","at"],function(){var a,c,d=(b[this]||"").split(" ");1===d.length&&(d=j.test(d[0])?d.concat(["center"]):k.test(d[0])?["center"].concat(d):["center","center"]),d[0]=j.test(d[0])?d[0]:"center",d[1]=k.test(d[1])?d[1]:"center",a=l.exec(d[0]),c=l.exec(d[1]),x[this]=[a?a[0]:0,c?c[0]:0],b[this]=[m.exec(d[0])[0],m.exec(d[1])[0]]}),1===w.length&&(w[1]=w[0]),"right"===b.at[0]?r.left+=n:"center"===b.at[0]&&(r.left+=n/2),"bottom"===b.at[1]?r.top+=p:"center"===b.at[1]&&(r.top+=p/2),f=c(x.at,n,p),r.left+=f[0],r.top+=f[1],this.each(function(){var e,j,k=a(this),l=k.outerWidth(),m=k.outerHeight(),o=d(this,"marginLeft"),s=d(this,"marginTop"),y=l+o+d(this,"marginRight")+v.width,z=m+s+d(this,"marginBottom")+v.height,A=a.extend({},r),B=c(x.my,k.outerWidth(),k.outerHeight());"right"===b.my[0]?A.left-=l:"center"===b.my[0]&&(A.left-=l/2),"bottom"===b.my[1]?A.top-=m:"center"===b.my[1]&&(A.top-=m/2),A.left+=B[0],A.top+=B[1],a.support.offsetFractions||(A.left=i(A.left),A.top=i(A.top)),e={marginLeft:o,marginTop:s},a.each(["left","top"],function(c,d){a.ui.position[w[c]]&&a.ui.position[w[c]][d](A,{targetWidth:n,targetHeight:p,elemWidth:l,elemHeight:m,collisionPosition:e,collisionWidth:y,collisionHeight:z,offset:[f[0]+B[0],f[1]+B[1]],my:b.my,at:b.at,within:u,elem:k})}),b.using&&(j=function(a){var c=q.left-A.left,d=c+n-l,e=q.top-A.top,f=e+p-m,i={target:{element:t,left:q.left,top:q.top,width:n,height:p},element:{element:k,left:A.left,top:A.top,width:l,height:m},horizontal:0>d?"left":c>0?"right":"center",vertical:0>f?"top":e>0?"bottom":"middle"};l>n&&h(c+d)<n&&(i.horizontal="center"),m>p&&h(e+f)<p&&(i.vertical="middle"),i.important=g(h(c),h(d))>g(h(e),h(f))?"horizontal":"vertical",b.using.call(this,a,i)}),k.offset(a.extend(A,{using:j}))})},a.ui.position={fit:{left:function(a,b){var c,d=b.within,e=d.isWindow?d.scrollLeft:d.offset.left,f=d.width,h=a.left-b.collisionPosition.marginLeft,i=e-h,j=h+b.collisionWidth-f-e;b.collisionWidth>f?i>0&&0>=j?(c=a.left+i+b.collisionWidth-f-e,a.left+=i-c):a.left=j>0&&0>=i?e:i>j?e+f-b.collisionWidth:e:i>0?a.left+=i:j>0?a.left-=j:a.left=g(a.left-h,a.left)},top:function(a,b){var c,d=b.within,e=d.isWindow?d.scrollTop:d.offset.top,f=b.within.height,h=a.top-b.collisionPosition.marginTop,i=e-h,j=h+b.collisionHeight-f-e;b.collisionHeight>f?i>0&&0>=j?(c=a.top+i+b.collisionHeight-f-e,a.top+=i-c):a.top=j>0&&0>=i?e:i>j?e+f-b.collisionHeight:e:i>0?a.top+=i:j>0?a.top-=j:a.top=g(a.top-h,a.top)}},flip:{left:function(a,b){var c,d,e=b.within,f=e.offset.left+e.scrollLeft,g=e.width,i=e.isWindow?e.scrollLeft:e.offset.left,j=a.left-b.collisionPosition.marginLeft,k=j-i,l=j+b.collisionWidth-g-i,m="left"===b.my[0]?-b.elemWidth:"right"===b.my[0]?b.elemWidth:0,n="left"===b.at[0]?b.targetWidth:"right"===b.at[0]?-b.targetWidth:0,o=-2*b.offset[0];0>k?(c=a.left+m+n+o+b.collisionWidth-g-f,(0>c||c<h(k))&&(a.left+=m+n+o)):l>0&&(d=a.left-b.collisionPosition.marginLeft+m+n+o-i,(d>0||h(d)<l)&&(a.left+=m+n+o))},top:function(a,b){var c,d,e=b.within,f=e.offset.top+e.scrollTop,g=e.height,i=e.isWindow?e.scrollTop:e.offset.top,j=a.top-b.collisionPosition.marginTop,k=j-i,l=j+b.collisionHeight-g-i,m="top"===b.my[1],n=m?-b.elemHeight:"bottom"===b.my[1]?b.elemHeight:0,o="top"===b.at[1]?b.targetHeight:"bottom"===b.at[1]?-b.targetHeight:0,p=-2*b.offset[1];0>k?(d=a.top+n+o+p+b.collisionHeight-g-f,a.top+n+o+p>k&&(0>d||d<h(k))&&(a.top+=n+o+p)):l>0&&(c=a.top-b.collisionPosition.marginTop+n+o+p-i,a.top+n+o+p>l&&(c>0||h(c)<l)&&(a.top+=n+o+p))}},flipfit:{left:function(){a.ui.position.flip.left.apply(this,arguments),a.ui.position.fit.left.apply(this,arguments)},top:function(){a.ui.position.flip.top.apply(this,arguments),a.ui.position.fit.top.apply(this,arguments)}}},function(){var b,c,d,e,f,g=document.getElementsByTagName("body")[0],h=document.createElement("div");b=document.createElement(g?"div":"body"),d={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},g&&a.extend(d,{position:"absolute",left:"-1000px",top:"-1000px"});for(f in d)b.style[f]=d[f];b.appendChild(h),c=g||document.documentElement,c.insertBefore(b,c.firstChild),h.style.cssText="position: absolute; left: 10.7432222px;",e=a(h).offset().left,a.support.offsetFractions=e>10&&11>e,b.innerHTML="",c.removeChild(b)}()}(jQuery),function(a){var b=Math.abs;a.ui.position.flip.top=function(a,c){var d,e,f=c.within,g=f.offset.top+f.scrollTop,h=f.height,i=f.isWindow?f.scrollTop:f.offset.top,j=a.top-c.collisionPosition.marginTop,k=j-i,l=j+c.collisionHeight-h-i,m="top"===c.my[1],n=m?-c.elemHeight:"bottom"===c.my[1]?c.elemHeight:0,o="top"===c.at[1]?c.targetHeight:"bottom"===c.at[1]?-c.targetHeight:0,p=-2*c.offset[1];0>k?(e=a.top+n+o+p+c.collisionHeight-h-g,(0>e||e<b(k))&&(a.top+=n+o+p)):l>0&&(d=a.top-c.collisionPosition.marginTop+n+o+p-i,(d>0||b(d)<l)&&(a.top+=n+o+p))}}(jQuery),function(a){CUI.Widget=new Class({toString:"Widget",construct:function(b){this.options=a.extend({},"object"==typeof this.defaults&&this.defaults,b),this.$element=a(b.element),this.$element.data(CUI.util.decapitalize(this.toString()),this),this.bind(this.hide),this.bind(this.show),this.bind(this.toggleVisibility),this.on("change:visible",function(a){this[a.value?"_show":"_hide"]()}.bind(this))},set:function(b,c){if(a.isPlainObject(b))for(var d in b)this._set(d,b[d]);else this._set(b,c);return this},_set:function(b,c){var d=a.Event("beforeChange:"+b,{widget:this,option:b,currentValue:this.options[b],value:c});return this.$element.trigger(d),d.isDefaultPrevented()?this:(this.options[b]=c,d=a.Event("change:"+b,{widget:this,option:b,value:c}),this.$element.trigger(d),void 0)},get:function(a){return this.options[a]},on:function(){return this.$element.on.apply(this.$element,arguments),this},off:function(){return this.$element.off.apply(this.$element,arguments),this},show:function(b){if(b=b||{},this.options.visible)return this;if(!b.silent){var c=a.Event("show");if(this.$element.trigger(c),c.isDefaultPrevented())return this}return this.options.visible=!0,this._show(b),this},_show:function(){this.$element.show()},hide:function(b){if(b=b||{},!this.options.visible)return this;if(!b.silent){var c=a.Event("hide");if(this.$element.trigger(c),c.isDefaultPrevented())return this}return this.options.visible=!1,this._hide(b),this},_hide:function(){this.$element.hide()},toggleVisibility:function(){return this[this.options.visible?"hide":"show"]()},setName:function(a){return this.toString=function(){return a},this}})}(jQuery,this),function(a){var b="cui-state",c="cui-state-restore",d={},e=!1,f=a(document);CUI.util.state={config:{serverpersistence:!0},save:function(c,e,f,g){var h=a(c),i=function(a,b){d.global[c]=d.global[c]||{},d.global[c][b]=d.global[c][b]||{},d.global[c][b].val=h.attr(b),d.global[c][b].autorestore=f||!1,d.global[c][b].customEvent=g||null};e&&(a.isArray(e)?a.each(e,i):i(0,e)),localStorage.setItem(b,JSON.stringify(d)),CUI.util.state.config.serverpersistence&&a.cookie(b,JSON.stringify(d),{expires:7,path:"/"})},restore:function(b,g){var h,i,j=g||function(){return!0},k=function(b){h=b,i=a(h),d.global[h]&&a.each(d.global[h],l)},l=function(a,b){j(h,a,b)&&(i.attr(a,b.val),b.customEvent&&f.trigger(b.customEvent,[i,b]),f.trigger(c,[i,b]))};e||(e=CUI.util.state.load()),b?k(b):a.each(d.global,k)},load:function(){var a=localStorage.getItem(b);return d=a?JSON.parse(a):{global:{}},!0},setSessionItem:function(a,b,c){var d=a;c&&(d=a+":"+c),sessionStorage.setItem(d,JSON.stringify(b))},getSessionItem:function(a,b){var c=a;b&&(c=a+":"+b);var d=sessionStorage.getItem(c);return d&&(d=JSON.parse(d)),d},removeSessionItem:function(a,b){var c=a;b&&(c=a+":"+b),sessionStorage.removeItem(c)},clearSessionItems:function(a){if(a){a=":"+a;for(var b=sessionStorage.length,c=[],d=0;b>d;d++){var e=sessionStorage.key(d),f=e.length;f>a.length&&e.substring(f-a.length)===a&&c.push(e)}for(var g=c.length,h=0;g>h;h++)sessionStorage.removeItem(c[h])}}},f.ready(function(){CUI.util.state.restore(null,function(a,b,c){return c.autorestore?!0:!1})})}(jQuery,this),CUI.util.HTTP={isOkStatus:function(a){try{return 0===String(a).indexOf("2")}catch(b){return!1}},html5UploadSupported:function(){var a=new XMLHttpRequest;return!!(a&&"upload"in a&&"onprogress"in a.upload)}},function(){CUI.util.color={hex:function(a){return("0"+parseInt(a,10).toString(16)).slice(-2)},HexToRGB:function(a){return a=parseInt(a.indexOf("#")>-1?a.substring(1):a,16),{r:a>>16,g:(65280&a)>>8,b:255&a}},RGBAToHex:function(a){var b=a.substring(a.indexOf("(")+1,a.lastIndexOf(")")).split(/,\s*/);return"#"+this.hex(b[0])+this.hex(b[1])+this.hex(b[2])},RGBToHex:function(a){return"#"+this.hex(a.r)+this.hex(a.g)+this.hex(a.b)},CMYKtoRGB:function(a){var b={r:0,g:0,b:0},c=parseInt(a.c,10)/100,d=parseInt(a.m,10)/100,e=parseInt(a.y,10)/100,f=parseInt(a.k,10)/100;return b.r=1-Math.min(1,c*(1-f)+f),b.g=1-Math.min(1,d*(1-f)+f),b.b=1-Math.min(1,e*(1-f)+f),b.r=Math.round(255*b.r),b.g=Math.round(255*b.g),b.b=Math.round(255*b.b),b},RGBtoCMYK:function(a){var b={c:0,m:0,y:0,k:0};if(0===parseInt(a.r,10)&&0===parseInt(a.g,10)&&0===parseInt(a.b,10))return b.k=100,b;var c=parseInt(a.r,10)/255,d=parseInt(a.g,10)/255,e=parseInt(a.b,10)/255;return b.k=Math.min(1-c,1-d,1-e),b.c=(1-c-b.k)/(1-b.k),b.m=(1-d-b.k)/(1-b.k),b.y=(1-e-b.k)/(1-b.k),b.c=Math.round(100*b.c),b.m=Math.round(100*b.m),b.y=Math.round(100*b.y),b.k=Math.round(100*b.k),b},fixHex:function(a){3===a.length&&(a=a.charAt(0)+a.charAt(0)+a.charAt(1)+a.charAt(1)+a.charAt(2)+a.charAt(2)),-1===a.indexOf("#")&&(a="#"+a);var b=/(^#[0-9A-F]{6})|(^#[0-9A-F]{3})$/i.test(a);return b?a:(this.$element.find("[name=':hex']").val(""),"")},isSameColor:function(a,b){return a&&b&&a===b},isValid:function(a,b){return-1!=b.indexOf(a)?""!==this.fixHex(this.RGBAToHex(b)):!1}}}(jQuery,this),function(a){CUI.Rail=new Class({toString:"Rail",extend:CUI.Widget,construct:function(){this.$element.hasClass("theme-dark")||this.$element.addClass("theme-dark"),this.applyOptions()},applyOptions:function(){this._initFoldable(),this.$element.find(".rail-switch").length>0&&this._initRailSwitcher(),this._makeAccessible()},_show:function(){this.$element.removeClass("closed")},_hide:function(){this.$element.addClass("closed")},_initFoldable:function(){var b="open",c="rail-section-foldable-";this.$element.find("section.foldable").each(function(d,e){var f=a(e),g=f.find(".heading"),h=f.find(".fold"),i=c+(g.attr("href")||" "+(new Date).getTime()+"-"+d).substring(1),j=f.hasClass(b);f.attr("role","presentation"),g.attr({role:"button",id:g.attr("id")||i,"aria-controls":h.attr("id")||i+"-fold",tabindex:0,"aria-expanded":j}),h.attr({id:h.attr("id")||i+"-fold","aria-labelledby":g.attr("id"),"aria-hidden":!j,"aria-expanded":j})}),this.$element.fipo("tap","click","section.foldable .heading",function(c){var d=a(c.currentTarget),e=d.parents(".foldable:first"),f=e.find(".fold"),g=e.toggleClass(b).hasClass(b);d.attr({"aria-expanded":g}),f.attr({"aria-hidden":!g,"aria-expanded":g}),g&&"tap"===c.type&&(f.attr("tabindex","-1").trigger("focus"),d.trigger("focus"),f.removeAttr("tabindex"))}).on("keydown","section.foldable .heading:not(button):not(a[href])",function(b){var c=a(b.currentTarget);switch(b.which){case 13:case 32:c.trigger("click")}})},_initRailSwitcher:function(){var b="active",c="focus",d="rail-switcher-view-",e=this.$element.find(".rail-switch a"),f=this.$element.find(".rail-view");e.filter('[href="#"]').each(function(){var b=a(this),c=b.data("view"),e=f.filter('[data-view="'+c+'"]');b.attr("href","#"+d+c),e.attr("id",d+c)}),this.$element.find(".rail-switch nav").attr({role:"tablist"}),e.attr({role:"tab","aria-selected":function(){return a(this).hasClass(b)},tabindex:function(){return a(this).hasClass(b)?0:-1},"aria-controls":function(){return a(this).attr("href").substring(1)}}),f.attr({role:"tabpanel","aria-hidden":function(){return!a(this).hasClass(b)},"aria-expanded":function(){return a(this).hasClass(b)},"aria-labelledby":function(){return a(this).attr("id")}}),this.$element.fipo("tap","click",".rail-switch a",function(c){var d=a(c.currentTarget),g=d.attr("href").substring(1),h=f.filter("#"+g);c.preventDefault(),f.removeClass(b).attr({"aria-hidden":!0,"aria-expanded":!1}),e.removeClass(b).attr({"aria-selected":!1,tabindex:-1}),d.addClass(b).attr({"aria-selected":!0,tabindex:0}),h.addClass(b).attr({"aria-hidden":!1,"aria-expanded":!0})}),this.$element.pointer("blur",".rail-switch a",function(b){a(b.currentTarget).removeClass(c)})},_makeAccessible:function(){var b="focus";this.$element.attr("role","complementary");var c=this.$element.find('[role="tablist"]'),d='[role="tab"]';c.on("keydown",d,function(c){var e=a(c.currentTarget),f=a(c.delegateTarget).find(d),g=e,h=!0,i=f.index(e);switch(c.which){case 33:case 37:case 38:g=i-1>-1?f[i-1]:f[0];break;case 34:case 39:case 40:g=i+1<f.length?f[i+1]:f[f.length-1];break;case 36:g=f[0];break;case 35:g=f[f.length-1];break;default:h=!1}h&&(c.preventDefault(),a(g).addClass(b).trigger("focus").trigger("click"))})}}),CUI.util.plugClass(CUI.Rail),CUI.options.dataAPI&&a(function(){a("[data-init~=rail]").rail()})}(jQuery,this),function(a){CUI.Modal=new Class({toString:"Modal",extend:CUI.Widget,construct:function(){0===this.$element.children().length&&this.$element.html(CUI.Templates.modal(a.extend({},this.options,{buttons:""}))),this.$element.addClass("modal"),this.header=this.$element.find(".modal-header"),this.body=this.$element.find(".modal-body"),this.footer=this.$element.find(".modal-footer"),this._previousFocus=a(),this.backdrop=a("<div/>",{"class":"modal-backdrop",style:"display: none;"}).fipo("tap","click",function(){"static"!==this.options.backdrop&&this.hide()}.bind(this)),this.body.loadWithSpinner(this.options.remote),this.applyOptions(),this.$element.on("change:heading",this._setHeading.bind(this)).on("change:header",this._setHeader.bind(this)).on("change:content",this._setContent.bind(this)).on("change:buttons",this._setFooter.bind(this)).on("change:type",this._setType.bind(this)).on("change:fullscreen",this._setFullscreen.bind(this)).fipo("tap","click",'[data-dismiss="modal"]',this.hide.bind(this)),this._makeAccessible()},defaults:{backdrop:"static",visible:!0,type:"default",fullscreen:!1,attachToBody:!0},_types:["default","error","notice","success","help","info"],applyOptions:function(){this._setHeader(),this._setHeading(),this._setContent(),this._setFooter(),this._setType(),this._setFullscreen(),this.options.visible&&(this.options.visible=!1,this.show())},_makeAccessible:function(){var b=this,c="modal-header"+(new Date).getTime()+"-";this.$element.attr({role:"dialog","aria-hidden":!this.options.visible,"aria-labelledby":c+"label","aria-describedby":c+"message",tabindex:-1}),this.header.find("h2").attr({id:c+"label",tabindex:0}),this.body.attr({id:c+"message",role:"document",tabindex:0}),this.$element.on("keydown",":focusable",function(c){var d,e=(a(c.currentTarget),b.$element.find(":tabbable"));switch(c.which){case 9:c.shiftKey&&c.currentTarget===e[0]?d=e.last():c.shiftKey||c.currentTarget!==e[e.length-1]||(d=e.first())}d&&(c.preventDefault(),d.trigger("focus"))})},_setType:function(){this.options.type&&(this.$element.removeClass(this._types.join(" ")),"default"!==this.options.type&&this.$element.addClass(this.options.type))},_setHeader:function(){this.options.header&&this.header.find("h2").html(this.options.header)},_setHeading:function(){this.options.heading&&(this.options.header=this.options.heading,this._setHeader.apply(this,arguments))},_setContent:function(){this.options.content&&this.body.html(this.options.content)},_setFooter:function(){if(a.isArray(this.options.buttons)){var b=this;this.footer.empty(),a.each(this.options.buttons,function(c,d){var e=d.href?a("<a/>",{"class":"button"}):a("<button/>",{type:"button"});e.html(d.label),"hide"===d.click?e.attr("data-dismiss","modal"):a.isFunction(d.click)&&e.fipo("tap","click",d.click.bind(b,{dialog:b})),d.href&&e.attr("href",d.href),d.className&&e.addClass(d.className),b.footer.append(e)})}},_setFullscreen:function(){this.options.fullscreen?this.$element.addClass("fullscreen"):this.$element.removeClass("fullscreen")},_show:function(){var b,c=a("body"),d=this;return this._previousFocus=a(":focus"),this._previousFocus.trigger("blur"),c.addClass("modal-open"),this.center(),this.$element.trigger("beforeshow"),this._toggleBackdrop(!0),this.options.attachToBody&&(0===this.$element.parent("body").length&&this.$element.appendTo(c),this.$element.siblings("[aria-hidden]").each(function(b,c){a(c).data("aria-hidden",a(c).attr("aria-hidden"))}),this.$element.siblings().not("script, link, style").attr("aria-hidden",this.options.visible)),this.$element.attr("aria-hidden",!this.options.visible),this.$element.fadeIn(),this.$element.find(":tabbable:not(.modal-header .close):first").focus(),b=a('<div class="cui-modal-tabcapture" tabindex="0"/>'),b.on("focus.modal-tabcapture",function(b){var c,e=d.$element.find(":tabbable"),f=a("body > .cui-modal-tabcapture"),g=f.last();c=b.currentTarget===g[0]?e.filter(":not(.modal-header .close):last"):e.filter(":not(.modal-header .close):first"),0===c.length&&(c=d.$element),c.trigger("focus")}).prependTo(c).clone(!0).appendTo(c),a(document).on("keydown.modal-escape",this._escapeKeyHandler.bind(this)),this},_hide:function(){return a("body").removeClass("modal-open").find(".cui-modal-tabcapture").off("focus.modal-tabcapture").remove(),a(document).off("keydown.modal-escape"),this.$element.trigger("beforehide"),this._toggleBackdrop(!1),this.$element.attr("aria-hidden",!this.options.visible),this.$element.siblings().removeAttr("aria-hidden").filter(':data("aria-hidden")').each(function(b,c){a(c).attr("aria-hidden",a(c).data("aria-hidden")).removeData("aria-hidden")}),this.$element.fadeOut().trigger("blur"),this._previousFocus.trigger("focus"),this},center:function(){var a=this.$element.outerWidth(),b=this.$element.outerHeight();this.$element.css({"margin-left":-(a/2),"margin-top":-(b/2)})},_toggleBackdrop:function(b){if(this.options.backdrop){var c=a("body");(b||this.backdrop.is(":hidden"))&&b!==!1?this.backdrop.appendTo(c).fadeIn():this.backdrop.fadeOut(function(){a(this).detach()})}},_escapeKeyHandler:function(a){27===a.which&&this.hide()}}),CUI.util.plugClass(CUI.Modal),CUI.options.dataAPI&&(a(document).on("cui-contentloaded.data-api",function(b){a("[data-init~=modal]",b.target).modal()}),a(document).fipo("tap.modal.data-api","click.modal.data-api",'[data-toggle="modal"]',function(b){var c=a(this),d=CUI.util.getDataTarget(c),e=c.attr("href"),f=a.extend({remote:!/#/.test(e)&&e},d.data(),c.data());"string"==typeof f.buttons&&(f.buttons=JSON.parse(f.buttons));var g=d.data("modal"),h=!0;g&&g.get("visible")&&(h=!1),d.modal(f),g&&d.data("modal").set({visible:h}),b.preventDefault()}).finger("click.modal.data-api",'[data-toggle="modal"]',!1))}(jQuery,this),function(a){CUI.Tabs=new Class({toString:"Tabs",extend:CUI.Widget,construct:function(){this.tablist=this.$element.find("> nav"),this.tabs=this.tablist.find('> a[data-toggle~="tab"]'),this.panels=this.$element.find("> section"),this._applyOptions(),this.$element.on("change:type",this._setType.bind(this)),this.$element.on("change:active",this._setActive.bind(this))},defaults:{},DEFAULT_VARIANT_KEY:"default",WHITE_VARIANT_CLASS:"white",STACKED_VARIANT_CLASS:"stacked",NAV_VARIANT_CLASS:"nav",VARIANT_TYPES:["default","white","stacked","nav"],setDisabled:function(a,b){var c=b||!1;return a.toggleClass("disabled",c).prop("aria-disabled",c),this},setEnabled:function(a){return this.setDisabled(a,!0)},_applyOptions:function(){var a=this.tabs.filter(".active");this.options.type&&this._setType(this.options.type),this._initTabswitch(),this._makeAccessible(),0===a.length?this._setActive(this.options.active||0):this._activateTab(a,!0)},_setActive:function(b){b=a.isNumeric(b)?b:this.options.active;var c=this.tabs.eq(b);this._activateTab(c,!0)},_setType:function(b){var c="string"===a.type(b)?b:this.options.type;(this.VARIANT_TYPES.indexOf(c)>-1||c===this.DEFAULT_VARIANT_KEY)&&(this.$element.removeClass(this.VARIANT_TYPES.join(" ")),c!==this.DEFAULT_VARIANT_KEY&&this.$element.addClass(c))},_activateTab:function(a,b){var c,d=a.attr("href"),e="active";return a.hasClass("disabled")?(a.blur(),!1):(c=this.panels.filter("#"+a.attr("aria-controls")),d&&"#"!==d.charAt(0)&&c.loadWithSpinner(d),this.tabs.removeClass(e).attr({"aria-selected":!1,tabindex:-1}),this.panels.removeClass(e).attr({"aria-hidden":!0}),a.addClass(e).attr({"aria-selected":!0,tabindex:0}),c.addClass(e).attr({"aria-hidden":!1}),b||a.trigger("focus"),void 0)},_initTabswitch:function(){var b=this,c='> nav > a[data-toggle="tab"]';this.$element.fipo("tap","click",c,function(c){var d=a(c.currentTarget);c.preventDefault(),b._activateTab(d)}).finger("click",c,!1)},_makeAccessible:function(){var b=this,c="tabs-panel-"+(new Date).getTime()+"-",d='> [role="tab"]';this.tablist.attr("role","tablist"),this.tabs.each(function(b,d){var e=a(d);e.attr({role:"tab",tabindex:-1,"aria-selected":!1,"aria-controls":c+b,"aria-disabled":e.hasClass("disabled")})}),this.panels.each(function(b,d){var e=a(d);e.attr({id:c+b,role:"tabpanel","aria-hidden":!0})}),this.tablist.on("keydown",d,function(c){var e=a(c.currentTarget),f=a(c.delegateTarget).find(d).not('[aria-disabled="true"]'),g=e,h=!0,i=f.index(e);switch(c.which){case 33:case 37:case 38:g=i-1>-1?f[i-1]:f[f.length-1];break;case 34:case 39:case 40:g=i+1<f.length?f[i+1]:f[0];break;case 36:g=f[0];break;case 35:g=f[f.length-1];break;default:h=!1}h&&(c.preventDefault(),g=a(g),b._activateTab(g))})}}),CUI.util.plugClass(CUI.Tabs),CUI.options.dataAPI&&a(document).on("cui-contentloaded.data-api",function(b){a("[data-init~=tabs]",b.target).tabs()})}(jQuery,this),function(a){CUI.Alert=new Class({toString:"Alert",extend:CUI.Widget,construct:function(){this.$element.delegate('[data-dismiss="alert"]',"click.dismiss.alert",this.hide),this.$element.addClass("alert"),this.$element.on("change:heading",this._setHeading.bind(this)),this.$element.on("change:content",this._setContent.bind(this)),this.$element.on("change:type",this._setType.bind(this)),this.$element.on("change:closable",this._setClosable.bind(this)),this.$element.on("change:size",this._setSize.bind(this)),a.each(this._types,function(a,b){return this.$element.hasClass(b)?(this.options.type=b,!1):void 0}.bind(this)),a.each(this._sizes,function(a,b){return this.$element.hasClass(b)?(this.options.size=b,!1):void 0}.bind(this)),0===this.$element.children().length&&(this.options.type=this._fixType(this.options.type),this.options.heading=this._fixHeading(this.options.heading),this.$element.html(CUI.Templates.alert(this.options)),this._setClosable(),this._setType(),this._setSize()),this._setHeading(),this._setContent()},defaults:{type:"error",size:"small",heading:void 0,visible:!0,closable:!0},_types:["error","notice","success","help","info"],_sizes:["small","large"],_setContent:function(){"string"!=typeof this.options.content&&this.$element.find("div").html(this.options.content)},_setHeading:function(){"string"==typeof this.options.content&&this.$element.find("strong").html(this.options.heading)},_setType:function(){this._isValidType(this.options.type)&&(this.$element.removeClass(this._types.join(" ")),this.$element.addClass(this.options.type))},_setSize:function(){this._isValidSize(this.options.size)&&("small"===this.options.size?this.$element.removeClass("large"):this.$element.addClass("large"))},_setClosable:function(){var a=this.$element.find(".close");a.length?a[this.options.closable?"show":"hide"]():this.$element.prepend('<button class="close" data-dismiss="alert">&times;</button>')
},_isValidType:function(a){return"string"==typeof a&&this._types.indexOf(a)>-1},_isValidSize:function(a){return"string"==typeof a&&this._sizes.indexOf(a)>-1},_fixType:function(a){return this._isValidType(a)?a:this.defaults.type},_fixHeading:function(a){return void 0===a?this._fixType(this.options.type).toUpperCase():a}}),CUI.util.plugClass(CUI.Alert),CUI.options.dataAPI&&a(function(){a("body").fipo("tap.alert.data-api","click.alert.data-api",'[data-dismiss="alert"]',function(b){a(b.target).parent().hide(),b.preventDefault()})})}(window.jQuery),function(a){var b=0;CUI.Popover=new Class({toString:"Popover",extend:CUI.Widget,construct:function(){this.$element.addClass("popover"),this.$element.on("change:content",this._setContent.bind(this)),this.$element.on("change:pointAt",this._position.bind(this)),this.$element.on("change:pointFrom",this._position.bind(this)),this.$element.on("change:alignFrom",this._position.bind(this)),""===this.$element.html()&&this._setContent(),this._createTail(),this.uuid=b+=1},defaults:{pointFrom:"bottom",preventAutoHide:!1,alignFrom:"left",visible:!1},_directions:["top","bottom","right","left"],_createTail:function(){this._$tail=a('<div class="popover-arrow arrow-left"/>').appendTo(this.$element),this._cachedTailDimensions={},this._cachedTailDimensions.leftRight={width:this._$tail.outerWidth(),height:this._$tail.outerHeight()},this._cachedTailDimensions.topBottom={width:this._cachedTailDimensions.leftRight.height,height:this._cachedTailDimensions.leftRight.width},this._$tail.removeClass("arrow-left")},_position:function(){if(this.options.visible&&this.options.pointAt){var b,c=this.$element,d=this.options.pointAt,e=this.options.pointFrom,f=this._cachedTailDimensions;if(a.isArray(d)){if(2!==d.length)return;d=this._convertCoordsToEvent(d)}var g=function(a,g){var h,i=c.offsetParent().offset();("top"==e||"bottom"==e)&&i.top+a.top<0?h="bottom":("left"==e||"right"==e)&&i.left+a.left<0&&(h="right"),h?(b=this._instructionFactory[h]({target:d,tailDimensions:f,allowFlip:!1,callback:this._applyFinalPosition.bind(this)}),c.position(b)):this._applyFinalPosition(a,g)}.bind(this);b=this._instructionFactory[e]({target:d,tailDimensions:f,allowFlip:!0,callback:g}),c.position(b)}},_convertCoordsToEvent:function(b){var c=a.Event();return c.pageX=b[0],c.pageY=b[1],c},_applyFinalPosition:function(b,c){var d={top:b.top};if("right"===this.options.alignFrom){var e,f=this.$element.offsetParent();"html"==f.prop("tagName").toLowerCase()?(f=a("body"),e=f.outerWidth(!0)):e=f.innerWidth(),d.left="auto",d.right=e-b.left-this.$element.outerWidth(!0)}else d.left=b.left,d.right="auto";this.$element.css(d),this._positionTail(c)},_instructionFactory:{top:function(a){return{my:"center bottom-"+a.tailDimensions.topBottom.height,at:"center top",of:a.target,collision:"fit "+(a.allowFlip?"flip":"none"),using:a.callback}},right:function(a){return{my:"left+"+a.tailDimensions.leftRight.width+" center",at:"right center",of:a.target,collision:(a.allowFlip?"flip":"none")+" fit",using:a.callback}},bottom:function(a){return{my:"center top+"+a.tailDimensions.topBottom.height,at:"center bottom",of:a.target,collision:"fit "+(a.allowFlip?"flip":"none"),using:a.callback}},left:function(a){return{my:"right-"+a.tailDimensions.leftRight.width+" center",at:"left center",of:a.target,collision:(a.allowFlip?"flip":"none")+" fit",using:a.callback}}},_positionTail:function(b){var c,d=this.$element.offset();if(a.isArray(this.options.pointAt))c={top:this.options.pointAt[1],left:this.options.pointAt[0],width:0,height:0};else{var e=a(b.target.element).offset();c={top:e.top,left:e.left,width:b.target.width,height:b.target.height}}c.top-=d.top+parseFloat(this.$element.css("borderTopWidth")),c.left-=d.left+parseFloat(this.$element.css("borderLeftWidth"));var f,g,h,i;switch(this.options.pointFrom){case"top":case"bottom":i=this._cachedTailDimensions.topBottom.width,g=c.left+c.width/2-i/2,"bottom"==b.vertical?(f="arrow-down",h=c.top-this._cachedTailDimensions.topBottom.height):(f="arrow-up",h=c.top+c.height);break;case"left":case"right":i=this._cachedTailDimensions.leftRight.width,h=c.top+c.height/2-this._cachedTailDimensions.leftRight.height/2,"left"==b.horizontal?(f="arrow-left",g=c.left+c.width):(f="arrow-right",g=c.left-i)}this._$tail.css({top:h,left:g}).removeClass("arrow-up arrow-down arrow-left arrow-right").addClass(f)},_show:function(){this.$element.show().prop("aria-hidden",!1),this._position(),this.options.preventAutoHide||a("body").fipo("tap.popover-hide-"+this.uuid,"click.popover-hide-"+this.uuid,function(b){var c=this.$element.get(0);b.target===c||a.contains(c,b.target)||(this.hide(),a("body").off(".popover-hide-"+this.uuid))}.bind(this))},_hide:function(){this.$element.hide().prop("aria-hidden",!0),a("body").off(".popover-hide-"+this.uuid)},_setContent:function(){"string"==typeof this.options.content&&(this.$element.html(this.options.content),this._$tail&&this.$element.append(this._$tail),this._position())},setPosition:function(a){this.set("pointAt",a)}}),CUI.util.plugClass(CUI.Popover),a(function(){a("body").fipo("tap.popover.data-api","click.popover.data-api",'[data-toggle="popover"]',function(){var b=a(this),c=CUI.util.getDataTarget(b);c=c&&c.length>0?c:b.next(".popover");var d=c.popover(a.extend({pointAt:b},c.data(),b.data())).data("popover");d.toggleVisibility()}).on("click.popover.data-api",'[data-toggle="popover"]',!1)})}(window.jQuery),function(a){CUI.DropdownList=new Class({toString:"DropdownList",extend:CUI.Widget,construct:function(){var b=a('<div class="dropdown-container">'),c=this.options.positioningElement?this.options.positioningElement:this.$element;c.after(b),c.detach(),b.append(c),this.containerElement=b,this.$element.on("change:options change:optionRenderer",function(a){a.widget===this&&this.update()}.bind(this)),this.$element.on("keydown","",this._keyPressed.bind(this)),this.$element.on("blur","",function(){return this.preventHiding?(this.preventHiding=!1,void 0):(this.hide(),void 0)}.bind(this))},defaults:{positioningElement:null,position:"below",autoPosition:!0,optionRenderer:null,options:["Apples","Pears","Bananas","Strawberries"],cssClass:null,visible:!1,scrollBuffer:10,loadingIndicator:"<div class='wait'></div>",noWidth:!1},listElement:null,containerElement:null,currentIndex:-1,preventHiding:!1,show:function(){this._unrender(),this.currentIndex=-1,this.$element.focus(),this._render()},hide:function(a){return a>0?setTimeout(this._unrender.bind(this),a):(this._unrender(),null)},isVisible:function(){return this.options.visible},toggle:function(){return this.isVisible()?this.hide():this.show()},update:function(){this.listElement&&(this._unrender(),this._render())},addItems:function(b){var c=this.listElement.find("li").not(".loading-indicator").length;if(this.listElement){var d=this.listElement.find("ul");a.each(b,function(b,e){var f=this.options.optionRenderer?this.options.optionRenderer(b,e):a("<span>"+e.toString()+"</span>"),g=a('<li data-id="'+(c+b)+'">');b===this.currentIndex&&g.addClass("selected");var h=this.options.getOptionClassAttribute(b);h&&g.addClass(h),g.append(f),d.append(g),this.options.options.push(e)}.bind(this))}},getNumberOfItems:function(){var a=this.listElement.find("li").not(".loading-indicator").length;return a},addLoadingIndicator:function(){this.listElement&&this.listElement.find("ul").append(a("<li>"+this.options.loadingIndicator+"</li>").addClass("loading-indicator"))},removeLoadingIndicator:function(){this.listElement&&this.listElement.find(".loading-indicator").remove()},_keyPressed:function(b){var c=b.keyCode;if(this.listElement){var d=this.currentIndex;if(38===c&&(b.preventDefault(),d>0?d--:d=this.listElement.find("li").length-1),40===c&&(b.preventDefault(),d<this.listElement.find("li").length-1?d++:d=0),27===c)return b.preventDefault(),this.hide(),void 0;if((13===c||20===c)&&(b.preventDefault(),d>=0))return this._triggerSelect(d,b),void 0;this.currentIndex=d;var e=this.listElement.find("li");if(e.removeClass("selected"),d>=0){var f=a(e[d]);f.addClass("selected"),this._updateScrollPosition(d)}}},_updateScrollPosition:function(a){var b=this.listElement.find(".autocomplete-results").children(":nth-child("+(a+1)+")");if(this.listElement.length&&b.length){var c=b.position().top,d=this.listElement.scrollTop(),e=0;c+b.height()>this.listElement.height()?(e=d,e+=c+b.outerHeight(),e-=this.listElement.height(),this.listElement.scrollTop(e)):0>c&&(e=d,e+=c,this.listElement.scrollTop(e))}},_unrender:function(){this.listElement&&(this.listElement.remove(),this.listElement=null),this.containerElement.removeClass("dropdown-visible"),this.options.visible=!1},_render:function(){var b,c=this.options.options;if(0!==c.length){var d=a("<ul></ul>");this.options.cssClass&&d.addClass(this.options.cssClass),a.each(c,function(b,c){var e=this.options.optionRenderer?this.options.optionRenderer(b,c):a("<span>"+c.toString()+"</span>"),f=a('<li data-id="'+b+'">');b===this.currentIndex&&f.addClass("selected");var g=this.options.getOptionClassAttribute?this.options.getOptionClassAttribute(b):void 0;g&&f.addClass(g),f.append(e),d.append(f)}.bind(this)),d.on("click","li:not(.loading-indicator)",function(b){b.preventDefault(),this._triggerSelect(a(b.target).closest("li").attr("data-id"),b)}.bind(this));var e=this.options.positioningElement?this.options.positioningElement:this.$element,f=a('<div class="dropdown-list">');f.append(d),this.listElement=d=f,d.css({top:0,left:0,visibility:"hidden",display:"block"}).appendTo(document.body),this.options.noWidth||d.css("width",e.outerWidth(!1)+"px"),b=this._calcPosition(),d.css({top:b.top+"px",left:b.left+"px",visibility:"visible"}),this.containerElement.addClass("dropdown-visible"),d.on("scroll","",function(){this._listScrolled()}.bind(this)),d.on("mousedown","",function(a){a.preventDefault(),a.stopPropagation()}.bind(this)),this.options.visible=!0}},_calcPosition:function(){var b=this.options.positioningElement?this.options.positioningElement:this.$element,c=b.offset().top+b.outerHeight(),d=b.offset().top-this.listElement.outerHeight(),e={left:b.offset().left,top:c},f=c+this.listElement.outerHeight()-a(window).scrollTop()<a(window).height(),g=d>a(window).scrollTop(),h=c+this.listElement.outerHeight()<a(document).height(),i=d>0;return e.top="above"===this.options.position?d:c,this.options.autoPosition&&("above"!==this.options.position||g?"below"!==this.options.position||f||(e.top=g||!h&&i?d:c):e.top=f||!i&&h?c:d),e},_listScrolled:function(){this._reachedListBottom()&&this._triggerScrolledBottom()},_reachedListBottom:function(){var a=this.listElement,b=this.listElement.find("ul");return b.height()-a.height()<=a.scrollTop()+this.options.scrollBuffer},_triggerSelect:function(b,c){this.$element.focus();var d=a.Event("dropdown-list:select",{selectedIndex:b,selectedValue:this.options.options[b],source:this,originalEvent:c});this.$element.trigger(d)},_triggerScrolledBottom:function(){var b=a.Event("dropdown-list:scrolled-bottom");this.$element.trigger(b)}}),CUI.util.plugClass(CUI.DropdownList)}(window.jQuery),function(a){CUI.Dropdown=new Class({toString:"Dropdown",extend:CUI.Widget,construct:function(){this.options.autocompleteCallback&&(this.options.editable=!0),this._render(),this._isMobile()&&!this.options.editable?this._initForMobile():this._initForDesktop();var a=this.$element.find(">div>button");a.length>0&&void 0===a.attr("type")&&a[0].setAttribute("type","button")},defaults:{options:[],multiple:!1,placeholder:"Select",disabled:!1,editable:!1,hasError:!1,noWidth:!1,expandwidth:!1,position:"below",autoPosition:!0},dropdownList:null,autocompleteList:null,syncSelectElement:null,buttonElement:null,positioningElement:null,inputElement:null,hasFocus:!1,_initForMobile:function(){this.$element.addClass("mobile"),this.buttonElement.on("click",function(){this._openSelectInput()}.bind(this)),this.$element.find("select").on("change",function(){this._update(!0)}.bind(this)),this._placeSelect()},_initForDesktop:function(){var a;this.dropdownList=new CUI.DropdownList({element:this.buttonElement,positioningElement:this.positioningElement,position:this.options.position,autoPosition:this.options.autoPosition,options:this.options.options,optionRenderer:this._optionRenderer.bind(this),getOptionClassAttribute:this._getOptionClassAttribute.bind(this),noWidth:this.options.noWidth}),this.options.editable?this.autocompleteList=new CUI.DropdownList({element:this.inputElement,positioningElement:this.positioningElement,position:this.options.position,autoPosition:this.options.autoPosition,options:this.options.options,optionRenderer:this._optionRendererAutocomplete.bind(this),getOptionClassAttribute:this._getOptionClassAttribute.bind(this),noWidth:this.options.noWidth,cssClass:"autocomplete-results"}):this.options.expandwidth&&(0!==this.options.options.length&&(a=this._getTextWidthFromOptions(this.options.options)),this.buttonElement.width(a)),this.buttonElement.on("dropdown-list:select",this._processSelect.bind(this)),this.buttonElement.on("mousedown","",function(a){a.preventDefault(),null!==this.autocompleteList?this._adjustAutocompleter():this.dropdownList.toggle()}.bind(this)),this.buttonElement.on("mouseup","",function(a){a.preventDefault()}.bind(this)),this.inputElement.on("click","",function(){null!==this.autocompleteList&&this._adjustAutocompleter()}.bind(this)),this.inputElement.on("input","",function(){null!==this.autocompleteList&&this._adjustAutocompleter({toggleList:!1})}.bind(this)),this.inputElement.on("dropdown-list:select","",function(a){this._processSelect(a)}.bind(this)),this.$element.children().on("focus","",function(){this.hasFocus=!0,this._update()}.bind(this)),this.$element.children().on("blur","",function(){this.hasFocus=!1,this._update()}.bind(this)),this.$element.find("select").on("change",function(){this._update(!0)}.bind(this))},_placeSelect:function(){var a=this.$element.find("select").first();a.css({position:"absolute",left:0,top:0,right:0,bottom:0,width:"auto",height:"auto"})},_openSelectInput:function(){var a=this.$element.find("select")[0];if(document.createEvent){var b=document.createEvent("MouseEvents");b.initMouseEvent("mousedown",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),a.dispatchEvent(b)}else a.fireEvent&&a.fireEvent("onmousedown")},_getTextWidthFromOptions:function(b){function c(a,b){return a.text(b),a.width()}var d,e={position:"absolute",visibility:"hidden",width:"auto",height:"auto"},f=a(this.buttonText).clone().css(e).empty().appendTo(a(this.buttonElement)),g=0;return 0!==b.length&&a.each(b,function(){d=c(f,this),g=d>g?d:g}),f.remove(),g+=parseInt(this.buttonText.css("padding-left"),10)+parseInt(this.buttonText.css("padding-right"),10),g+=parseInt(this.buttonText.css("margin-left"),10)+parseInt(this.buttonText.css("margin-right"),10),g+=parseInt(this.buttonText.css("borderLeftWidth"),10)+parseInt(this.buttonText.css("borderRightWidth"),10)},_adjustAutocompleter:function(b){var c=this.inputElement.val(),d={toggleList:!0},e=a.extend(d,b),f=function(a){this.autocompleteList.set({options:a}),e.toggleList?this.autocompleteList.toggle():this.autocompleteList.show()}.bind(this);if(this.options.autocompleteCallback)this.options.autocompleteCallback(f,c);else{var g=[];a.each(this.options.options,function(a,b){b.toLowerCase().indexOf(c.toLowerCase(),0)>=0&&g.push(b)}),f(g,c)}},_optionRenderer:function(b,c){var d=a("<span>"+c+"</span>");if(this.options.multiple){var e=a('<div class="checkbox">');this.syncSelectElement&&a(this.syncSelectElement.find("option").get(b)).attr("selected")&&e.addClass("checked"),d.prepend(e)}return d},_optionRendererAutocomplete:function(b,c){var d=this.inputElement.val(),e=c.toLowerCase().indexOf(d.toLowerCase());return e>=0&&(c=c.substr(0,e)+"<em>"+c.substr(e,d.length)+"</em>"+c.substr(e+d.length)),a("<span>"+c+"</span>")},_getOptionClassAttribute:function(b){return this.syncSelectElement?a(this.syncSelectElement.find("option").get(b)).data("itemclass"):""},_processSelect:function(b){if(this.syncSelectElement){var c=b.selectedValue,d=null;if(b.source===this.autocompleteList?(this.syncSelectElement.find("option").each(function(){a(this).attr("value")===c&&(d=a(this))}),null===d&&(d=a("<option>"),d.attr("value",c).text(c),this.syncSelectElement.append(d)),this.autocompleteList.hide()):(d=a(this.syncSelectElement.find("option").get(b.selectedIndex)),c=d.attr("value")),this.options.multiple){var e=this.syncSelectElement.val();null===e&&(e=[]),e.indexOf(c)>=0?e.splice(e.indexOf(c),1):e.push(c),this.syncSelectElement.val(e),this.dropdownList.update()}else this.syncSelectElement.val(c),this.dropdownList.hide();this.syncSelectElement.change()}this._update(!0)},_render:function(){if(this._readDataFromMarkup(),"DIV"!==this.$element.get(0).tagName){var b=a("<div></div>");this.$element.after(b),this.$element.detach(),b.append(this.$element),this.$element=b}this._createMissingElements(),this.buttonElement=this.$element.find("button"),this.syncSelectElement=this.$element.find("select"),this.inputElement=this.$element.find("input"),this.positioningElement=this.options.editable?this.$element:this.buttonElement,this.options.editable||(this.buttonText=a(this.buttonElement).wrapInner("<span />").find("span")),this.inputElement.attr("name")||this.inputElement.attr("name",this.syncSelectElement.attr("name")+".edit"),this.syncSelectElement.attr("multiple")&&(this.options.multiple=!0),this.$element.addClass("dropdown"),this.options.editable&&this.$element.addClass("dropdown-editable"),this.$element.find("select option").length>0&&0===this.options.options.length&&(this.options.options=[],this.$element.find("select option").each(function(b,c){this.options.options.push(a(c).html())}.bind(this))),this.options.multiple?this.syncSelectElement.attr("multiple","multiple"):this.syncSelectElement.removeAttr("multiple","multiple"),this.options.placeholder&&(this.options.editable?this.buttonElement.text(this.options.placeholder):this.buttonText.text(this.options.placeholder),this.inputElement.attr("placeholder",this.options.placeholder)),this._update(!0)},_readDataFromMarkup:function(){this.$element.attr("disabled")&&(this.options.disabled=!0),this.$element.attr("data-disabled")&&(this.options.disabled=!0),this.$element.attr("multiple")&&(this.options.multiple=!0),this.$element.attr("data-multiple")&&(this.options.multiple=!0),this.$element.attr("placeholder")&&(this.options.placeholder=this.$element.attr("placeholder")),this.$element.attr("data-placeholder")&&(this.options.placeholder=this.$element.attr("data-placeholder")),this.$element.attr("data-editable")&&(this.options.editable=!0),this.$element.attr("data-error")&&(this.options.hasError=!0),this.$element.hasClass("error")&&(this.options.hasError=!0),this.$element.attr("data-nowidth")&&(this.options.noWidth=!0),this.$element.attr("data-expandwidth")&&(this.options.expandwidth=!0)},_createMissingElements:function(){if(0===this.$element.find("button").length){var b=a("<button/>",{text:this.options.placeholder,type:"button"});b.addClass("dropdown"),this.$element.append(b)}if(this.options.editable&&0===this.$element.find("input").length){var c=a('<input type="text">');this.$element.prepend(c)}if(0===this.$element.find("select").length){var d=a("<select>");this.$element.append(d)}},_update:function(a){if(a&&this.syncSelectElement&&!this.options.multiple){var b=this.syncSelectElement.find("option:selected");if(b){var c=(b.index(),b.text()),d=b.html();this.inputElement.length>0?this.inputElement.val(c).trigger("change"):this.buttonText.html(d)}}this.options.disabled?(this.buttonElement.attr("disabled","disabled"),this.inputElement.attr("disabled","disabled")):(this.buttonElement.removeAttr("disabled"),this.inputElement.removeAttr("disabled")),this.hasFocus?this.$element.addClass("focus"):this.$element.removeClass("focus"),this.options.hasError?this.$element.addClass("error"):this.$element.removeClass("error")},_isMobile:function(){return"object"==typeof window.ontouchstart}}),CUI.util.plugClass(CUI.Dropdown),CUI.options.dataAPI&&a(document).on("cui-contentloaded.data-api",function(b){a("[data-init~=dropdown]",b.target).dropdown()})}(window.jQuery),function(a){CUI.Filters=new Class({toString:"Filters",extend:CUI.Widget,construct:function(){for(this.selectedIndices=[],this.createdIndices=[],this.options.autocompleteCallback?this.usingExternalData=!0:this.options.autocompleteCallback=this._defaultAutocompleteCallback.bind(this),this.options.optionRenderer||(this.options.optionRenderer=CUI.Filters.defaultOptionRenderer),this._readDataFromMarkup(),this.options.stacking&&(this.options.multiple=!0),this._render(),this.options.optionDisplayStrings.length>this.options.options.length&&(this.options.optionDisplayStrings=this.options.optionDisplayStrings.slice(0,this.options.options.length));this.options.optionDisplayStrings.length<this.options.options.length;)this.options.optionDisplayStrings.push(this.options.options[this.options.optionDisplayStrings.length]);this.dropdownList=new CUI.DropdownList({element:this.inputElement,positioningElement:this.options.stacking?this.$element:this.inputElement,position:this.options.position,autoPosition:this.options.autoPosition,cssClass:"autocomplete-results"}),this._addEventListeners()},defaults:{autocompleteCallback:null,optionRenderer:null,options:[],optionDisplayStrings:[],multiple:!1,delay:200,highlight:!0,stacking:!1,placeholder:null,allowCreate:!1,icons:null,iconSize:"small",infiniteLoad:!1,maxLoadingItems:20,hasError:!1,position:"below",autoPosition:!0},dropdownList:null,syncSelectElement:null,inputElement:null,typeTimeout:null,selectedIndex:-1,selectedIndices:null,createdIndices:null,triggeredBackspace:!1,usingExternalData:!1,selectedValue:null,isLoadingExternal:!1,loadedEverything:!1,setSelectedIndex:function(a){-1>a||a>=this.options.options.length||(this.inputElement.attr("value",""),this.selectedIndex=a,this.options.multiple&&a>=0&&this.selectedIndices.indexOf(1*a)<0&&this.selectedIndices.push(1*a),this.options.multiple||(this.selectedIndices=a>=0?[a]:[]),this._update())},removeSelectedIndex:function(a){var b=this.selectedIndices.indexOf(1*a);0>b||(this.selectedIndices.splice(b,1),this._update())},getSelectedIndex:function(){return this.selectedIndex},setSelectedIndices:function(a){this.selectedIndices=a.slice(0),this._update()},getSelectedIndices:function(){return this.selectedIndices.slice(0)},_addEventListeners:function(){this.$element.on("change:disabled",this._update.bind(this)),this.$element.on("change:placeholder",this._update.bind(this)),this.$element.on("change:options",this._changeOptions.bind(this)),this.$element.on("input","input",function(){this.options.disabled||(this.typeTimeout&&clearTimeout(this.typeTimeout),this.typeTimeout=setTimeout(this._inputChanged.bind(this),this.options.delay))}.bind(this)),this.$element.on("click touchend","input",function(){this.options.disabled||(this.inputElement.focus(),this._inputChanged())}.bind(this)),this.$element.on("blur","input",function(){if(!this.options.disabled){this.typeTimeout&&clearTimeout(this.typeTimeout),this.typeTimeout=null,!this.options.multiple&&this.selectedIndex>=0&&(""===this.inputElement.attr("value")?this.setSelectedIndex(-1):this._update());var a=this.options.hasError||!this.options.multiple&&this.inputElement.val().length>0&&this.selectedIndex<0;this.$element.toggleClass("error",a)}}.bind(this)),this.$element.on("keydown","input",this._keyPressed.bind(this)),this.$element.on("keyup","input",this._keyUp.bind(this)),this.dropdownList.on("dropdown-list:select","",function(b){this.options.infiniteLoad&&(this.loadedEverything=!1),this.dropdownList.hide(200),this.usingExternalData&&(this._createNewOption(b.selectedValue.toString(),b.selectedValue.toString(),!0),this._update());var c=a.inArray(b.selectedValue.toString(),this.options.options);this.setSelectedIndex(1*c)}.bind(this)),this.options.infiniteLoad&&this.dropdownList.on("dropdown-list:scrolled-bottom","",function(){if(!this.isLoadingExternal&&!this.loadedEverything){this.isLoadingExternal=!0,this.dropdownList.addLoadingIndicator();var b=this.dropdownList.getNumberOfItems(),c=this.inputElement.attr("value");this.options.autocompleteCallback(a.proxy(this._appendLoadedData,this),c,b,this.options.maxLoadingItems)}}.bind(this)),this.$element.on("click","[data-dismiss=filter]",function(b){if(!this.options.disabled){var c=a(b.target).closest("[data-id]");return this.removeSelectedIndex(c.attr("data-id")),!1}}.bind(this)),this.$element.on("input","input",function(){this.options.disabled||this._correctInputFieldWidth()}.bind(this)),this.$element.on("focus","input",function(a){this.options.disabled||(this.$element.addClass("focus"),a.preventDefault())}.bind(this)),this.$element.on("blur","input",function(){this.options.disabled||this.$element.removeClass("focus")}.bind(this))},_changeOptions:function(a){a.widget===this&&(this.selectedIndex=-1,this.selectedIndices=[],this.createdIndices=[],this._update())},_render:function(){var b;"SELECT"===this.$element.get(0).tagName&&(b=a("<div></div>"),this.$element.after(b),this.$element.detach(),b.append(this.$element),this.$element=b),"INPUT"===this.$element.get(0).tagName&&(b=a("<div></div>"),this.$element.after(b),this.$element.detach(),b.prepend(this.$element),this.$element=b),this.$element.find("select option").length>0&&0===this.options.options.length&&(this.options.options=[],this.options.optionDisplayStrings=[],this.$element.find("select option").each(function(b,c){this.options.options.push(a(c).val()),this.options.optionDisplayStrings.push(a.trim(a(c).text())),a(c).attr("selected")&&(this.selectedIndices.push(b),this.selectedIndex=b)}.bind(this))),this._createMissingElements(),this.syncSelectElement=this.$element.find("select"),this.inputElement=this.$element.find("input"),this.$element.addClass("filters"),this.$element.removeClass("focus"),this.options.placeholder||(this.options.placeholder=this.inputElement.attr("placeholder")),this.options.name&&this.syncSelectElement.attr("name",this.options.name),this.options.stacking?this.$element.addClass("stacking"):this.$element.removeClass("stacking"),this._update()},_createMissingElements:function(){if(0===this.$element.find("select").length&&this.$element.append(a("<select "+(this.options.multiple?"multiple":"")+"></select>")),0===this.$element.find("input").length&&this.$element.prepend(a('<input type="text">')),this.$element.find("select option").length<this.options.options.length)for(var b=this.$element.find("select option").length;b<this.options.options.length;b++){var c=this.options.options[b],d=this.options.optionDisplayStrings[b]||this.options.options[b],e=a("<option></option>");e.text(d),e.attr("value",c),this.$element.find("select").append(e)}},_readDataFromMarkup:function(){this.$element.attr("multiple")&&(this.options.multiple=!0),this.$element.attr("data-multiple")&&(this.options.multiple=!0),this.$element.attr("data-stacking")&&(this.options.stacking=!0),this.$element.attr("placeholder")&&(this.options.placeholder=this.$element.attr("placeholder")),this.$element.attr("data-placeholder")&&(this.options.placeholder=this.$element.attr("data-placeholder")),this.$element.attr("disabled")&&(this.options.disabled=!0),this.$element.hasClass("error")&&(this.options.hasError=!0),this.$element.find("input").hasClass("error")&&(this.options.hasError=!0),this.$element.attr("data-disabled")&&(this.options.disabled=!0),"create"===this.$element.attr("data-allow")&&(this.options.allowCreate=!0),this.$element.attr("data-option-renderer")&&(this.options.optionRenderer=CUI.Filters[this.$element.attr("data-option-renderer")+"OptionRenderer"],this.options.optionRenderer||(this.options.optionRenderer=CUI.Filters.defaultOptionRenderer))},_update:function(){if(this.options.placeholder&&this.inputElement.attr("placeholder",this.options.placeholder),this.options.disabled?(this.$element.addClass("disabled"),this.inputElement.attr("disabled","disabled")):(this.$element.removeClass("disabled"),this.inputElement.removeAttr("disabled")),!this.options.multiple){if(this.syncSelectElement&&this.syncSelectElement.find("option:selected").removeAttr("selected"),this.selectedIndex>=0){this.syncSelectElement&&a(this.syncSelectElement.find("option").get(this.selectedIndex)).attr("selected","selected");var b=this.options.options[this.selectedIndex];this.options.optionDisplayStrings[this.selectedIndex]&&(b=this.options.optionDisplayStrings[this.selectedIndex]),this.inputElement.attr("value",b)}else this.inputElement.attr("value","");return this.$element.find("select").change(),void 0}if(this.syncSelectElement){this.syncSelectElement.find("option:selected").removeAttr("selected");for(var c=0;c<this.selectedIndices.length;c++){var d=this.selectedIndices[c];a(this.syncSelectElement.find("option").get(d)).attr("selected","selected")}}var e=a('<ul class="tags"></ul>');a.each(this.selectedIndices,function(b,c){var d=this.options.options[c],f=this.options.optionRenderer.bind(this)(c,d,!1,!1),g=a('<li data-id="'+c+'"><button data-dismiss="filter">&times;</button></li>');e.append(g),g.append(f)}.bind(this)),this.$element.find("ul").remove(),e.children().length>0&&(this.options.stacking?this.$element.prepend(e):this.$element.append(e)),this._correctInputFieldWidth(),this.$element.find("select").change()},_keyUp:function(a){var b=a.keyCode;8===b&&(this.triggeredBackspace=!1)},_keyPressed:function(a){var b=a.keyCode;if(8===b&&(this.triggeredBackspace===!1&&0===this.inputElement.attr("value").length&&this.options.multiple&&this.selectedIndices.length>0&&(a.preventDefault(),this.removeSelectedIndex(this.selectedIndices[this.selectedIndices.length-1]),this._inputChanged()),this.triggeredBackspace=!0),this.dropdownList.isVisible())13===b&&this.dropdownList.currentIndex<0&&(this.dropdownList.hide(),a.preventDefault());else if(40===b&&(this._inputChanged(),a.preventDefault()),13===b){var c=this.inputElement.val();c.length>0&&(this._createNewOption(c,c,!1),a.preventDefault())}},_createNewOption:function(b,c,d){var e=-1;if(a.each(this.options.options,function(a,c){this.options.optionDisplayStrings[a]===b&&(e=a),c===b&&(e=a)}.bind(this)),e>=0)return this.setSelectedIndex(e),void 0;if(this.options.allowCreate||d){var f=this.options.options.length;if(this.options.options.push(b),this.options.optionDisplayStrings.push(c),this.syncSelectElement){var g=a("<option></option>");g.text(c),g.attr("value",b),d||g.attr("data-new","true"),this.syncSelectElement.append(g)}d||this.createdIndices.push(f),this.setSelectedIndex(f)}},_correctInputFieldWidth:function(){if(this.options.stacking){var b=this.inputElement,c=b.attr("value")||"";0===c.length&&(c=b.attr("placeholder"));var d=["font-family","font-weight","font-style","font-size","letter-spacing","line-height","text-transform"],e=a('<div style="position: absolute; display: none;"></div>');a.each(d,function(a,c){e.css(c,b.css(c))}),e.text(c),a("body").append(e);var f=e.width()+25;e.remove();var g=parseFloat(b.css("margin-left"))+parseFloat(b.css("margin-right")),h=0===this.selectedIndices.length;(h||f>this.$element.width()-g)&&(f=this.$element.width()-g),b.width(f)}},_inputChanged:function(){this.options.infiniteLoad&&(this.loadedEverything=!1);var b=this.inputElement.attr("value");this.options.autocompleteCallback(a.proxy(this._showAutocompleter,this),b,0,this.options.infiniteLoad?this.options.maxLoadingItems:500)},_appendLoadedData:function(a){return this.dropdownList.removeLoadingIndicator(),0===a.length?(this.loadedEverything=!0,this.isLoadingExternal=!1,void 0):(this.dropdownList.addItems(a),this.isLoadingExternal=!1,void 0)},_showAutocompleter:function(b){if(this.dropdownList.hide(),this.options.multiple){var c=[];a.each(b,function(b,d){var e=a.inArray(d,this.options.options);this.selectedIndices.indexOf(e)>=0||c.push(d)}.bind(this)),b=c}if(0!==b.length){var d=function(b,c){return this.options.optionRenderer.bind(this)(b,c,this.options.highlight,!a.isEmptyObject(this.options.icons))};this.dropdownList.set("optionRenderer",d.bind(this)),this.dropdownList.set("options",b),this.dropdownList.show()
}},_defaultAutocompleteCallback:function(b,c){var d=[];a.each(this.options.options,function(a,b){var e=b;this.options.optionDisplayStrings[a]&&(e=this.options.optionDisplayStrings[a]),e.toLowerCase().indexOf(c.toLowerCase(),0)>=0&&d.push(b)}.bind(this)),b(d,c)},_buildIcon:function(a,b,c){return"url"===a?'<i class="'+c+' icon-inline-bg-image" style="background-image: url('+b+')">icon</i>':"cuiIcon"===a?'<i class="'+b+" "+c+'">'+b.split("icon-")[1]+"</i>":void 0}}),CUI.util.plugClass(CUI.Filters),a(document).on("cui-contentloaded.data-api",function(b){a("[data-init~=filters]",b.target).filters()}),CUI.Filters.defaultOptionRenderer=function(b,c,d,e){var f=a.inArray(c,this.options.options),g=c;this.options.optionDisplayStrings[f]&&(g=this.options.optionDisplayStrings[f]);var h=this.inputElement.val();if(d){var i=g.toLowerCase().indexOf(h.toLowerCase());i>=0&&(g=g.substr(0,i)+"<em>"+g.substr(i,h.length)+"</em>"+g.substr(i+h.length))}if(this.createdIndices.indexOf(f)>=0&&(g+="&nbsp;*"),e){var j;if("undefined"!=typeof(j=this.options.icons[c])){var k=/^icon-/i.test(j)?"cuiIcon":"url";g=this._buildIcon(k,j,this.options.iconSize)+g}}return a("<span>"+g+"</span>")},CUI.Filters.cqTagOptionRenderer=function(b,c,d){function e(b){return a("<div>").text(b).html()}var f=a.inArray(c,this.options.options),g=c;this.options.optionDisplayStrings[f]&&(g=this.options.optionDisplayStrings[f]);var h=this.inputElement.val(),i=g.split(":");i.length<2&&(i[1]="");var j=i[0],k=i[1],l=k.split("/");g=j+": ";for(var m=0;m<l.length;m++){var n=l[m];if(d){var o=n.toLowerCase().indexOf(h.toLowerCase());n=o>=0?e(n.substr(0,o))+"<em>"+e(n.substr(o,h.length))+"</em>"+e(n.substr(o+h.length)):e(n)}else n=e(n);m>0&&(g+=" / "),m===l.length-1&&(n="<b>"+n+"</b>"),g+=n}return this.createdIndices.indexOf(f)>=0&&(g+="&nbsp;*"),a("<span>"+g+"</span>")}}(window.jQuery),function(a,b,c){CUI.Slider=new Class({toString:"Slider",extend:CUI.Widget,construct:function(){var b=this,c=this.$element.attr("id"),d=this.$element.children("fieldset"),e=d.children("legend"),f=[];this._readOptions(),c||(c=CUI.util.getNextId(),this.$element.attr("id",c)),this._renderMissingElements(),d.length>0&&(this.$element.append(d.contents(":not(legend)")),this._group=a("<div/>",{role:"group","class":"sliderfieldset"}),b.$element.wrap(this._group),e.length>0&&(this._grouplegend=a("<label/>").append(e.contents()),a.each(e.prop("attributes"),function(){b._grouplegend.attr(this.name,this.value)}),this._grouplegend.attr("id")||this._grouplegend.attr("id",c+"-legend"),this._group.attr("aria-labelledby",this._grouplegend.attr("id")),d.replaceWith(this._grouplegend),e=this._grouplegend.insertBefore(this.$element))),this.$inputs=this.$element.find("input"),this.$inputs.each(function(d){var g=a(this),h=g.attr("id");h||(g.attr("id",c+"-input"+d),h=g.attr("id")),g.attr("aria-labelledby")||g.attr("aria-labelledby","");var i=b.$element.find('label[for="'+h+'"]');e&&-1===g.attr("aria-labelledby").indexOf(e.attr("id"))&&g.attr("aria-labelledby",e.attr("id")+(g.attr("aria-labelledby").length?" ":"")+g.attr("aria-labelledby")),i.length>0&&(i.not(g.parent()).insertBefore(b.$element),i.each(function(c){a(this).attr("id")||a(this).attr("id",h+"-label"+c),-1===g.attr("aria-labelledby").indexOf(h+"-label"+c)&&g.attr("aria-labelledby",(g.attr("aria-labelledby").length?" ":"")+h+"-label"+c),CUI.util.isTouch||a(this).fipo("touchstart","mousedown",function(){b.$handles.eq(c).focus()}.bind(this))})),g.parent().is("label")&&(i=g.parent(),i.attr("id")||i.attr("id",h+"-label"),i.attr("for")||i.attr("for",h),g.insertAfter(i),e&&i.addClass("hidden-accessible"),i.insertBefore(b.$element)),i.length&&-1===g.attr("aria-labelledby").indexOf(i.attr("id"))&&g.attr("aria-labelledby",g.attr("aria-labelledby")+(g.attr("aria-labelledby").length?" ":"")+i.attr("id")),0===i.length&&g.attr("aria-labelledby").length>0&&(i=a("#"+g.attr("aria-labelledby").split(" ")[0])),0===g.attr("aria-labelledby").length&&g.removeAttr("aria-labelledby"),g.is("[step]")||g.attr("step",b.options.step),g.is("[min]")||g.attr("min",b.options.min),g.is("[max]")||g.attr("max",b.options.max),g.is("[value]")?f.push(g.attr("value")):(g.attr({value:b.options.value,"aria-valuetext":b.options.valuetextFormatter(b.options.value)}),f.push(b.options.value)),0===d&&(g.is(":disabled")?(b.options.disabled=!0,b.$element.addClass("disabled")):b.options.disabled&&(g.attr("disabled","disabled"),b.$element.addClass("disabled"))),CUI.util.isTouch?(g.on("change",function(){b.options.disabled||g.val()!==b.values[d]&&b.setValue(g.val(),d)}.bind(this)),g.on("focus",function(a){b._focus(a)}.bind(this)),g.on("blur",function(a){b._blur(a)}.bind(this))):(g.attr({"aria-hidden":!0,tabindex:-1,hidden:"hidden"}),0===d&&(i&&i.on("click",function(a){b.options.disabled||b._clickLabel(a)}.bind(this)),e&&e.on("click",function(a){b.options.disabled||b._clickLabel(a)}.bind(this))))}),b.values=f,"vertical"===this.options.orientation&&(this.isVertical=!0),this.$element.fipo("touchstart","mousedown",function(a){this._mouseDown(a)}.bind(this)),this.$element.on("change:value",this._processValueChanged.bind(this)),this.$element.on("change:disabled",this._processDisabledChanged.bind(this)),this.$element.on("change:min",this._processMinMaxStepChanged.bind(this)),this.$element.on("change:max",this._processMinMaxStepChanged.bind(this)),this.$element.on("change:step",this._processMinMaxStepChanged.bind(this)),this._render()},defaults:{step:"1",min:"1",max:"100",value:"1",orientation:"horizontal",slide:!1,disabled:!1,tooltips:!1,tooltipFormatter:function(a){return a.toString()},valuetextFormatter:function(a){return a.toString()},ticks:!1,filled:!1,bound:!1},values:[],$inputs:null,$ticks:null,$fill:null,$handles:null,$tooltips:null,isVertical:!1,draggingPosition:-1,_readOptions:function(){this.$element.hasClass("vertical")&&(this.options.orientation="vertical",this.isVertical=!0),this.$element.hasClass("tooltips")&&(this.options.tooltips=!0),this.$element.hasClass("ticked")&&(this.options.ticks=!0),this.$element.hasClass("filled")&&(this.options.filled=!0),this.$element.data("slide")&&(this.options.slide=!0),this.$element.hasClass("bound")&&(this.options.bound=!0)},setValue:function(a,b){b=b||0,this._updateValue(b,a,!0),this._moveHandles(),this.options.filled&&this._updateFill()},_renderMissingElements:function(){if(!this.$element.find("input").length){var b,c=this,d=a.isArray(this.options.value)?this.options.value:[this.options.value];a.each(d,function(d,e){b=a("<input>"),b.attr({type:"range",min:c.options.min,max:c.options.max,step:c.options.step,value:e}).val(e),c.$element.append(b)})}if(!this.$element.find("div.clickarea").length){var e=a('<div class="clickarea">');this.$element.prepend(e)}this.$element.toggleClass("slider",!0),this.$element.toggleClass("vertical","vertical"===this.options.orientation),this.$element.toggleClass("tooltips",this.options.tooltips),this.$element.toggleClass("ticked",this.options.ticks),this.$element.toggleClass("filled",this.options.filled)},_processValueChanged:function(){var b=this,c=a.isArray(this.options.value)?this.options.value:[this.options.value];a.each(c,function(a,c){b._updateValue(a,c,!0)}),this._moveHandles(),this.options.filled&&this._updateFill()},_processMinMaxStepChanged:function(){var b=this;this.$element.find("input").attr("min",this.options.min),this.$element.find("input").attr("max",this.options.max),this.$element.find("input").attr("step",this.options.step),a.each(this.values,function(a,c){b._updateValue(a,c,!0)}),this.options.ticks&&(this.$element.find(".ticks").remove(),this._buildTicks()),this.options.filled&&(this.$element.find(".fill").remove(),this._buildFill()),this._moveHandles(),this.options.filled&&this._updateFill()},_processDisabledChanged:function(){this.options.disabled?(this.$inputs.attr("disabled","disabled"),this.$handles.each(function(){a(this).removeClass("focus"),a(this).parent().removeClass("focus")}),CUI.util.isTouch&&this.$handles.attr("aria-disabled",!0).removeAttr("tabindex")):(this.$inputs.removeAttr("disabled"),CUI.util.isTouch&&this.$handles.removeAttr("aria-disabled").attr("tabindex",0)),this.$element.toggleClass("disabled",this.options.disabled)},_render:function(){var b=this,c=b.$inputs.map(function(){return a(this).attr("max")});b.options.max=Math.max.apply(null,c.toArray());var d=b.$inputs.map(function(){return a(this).attr("min")});b.options.min=Math.min.apply(null,d.toArray());var e=b.$inputs.map(function(){return a(this).attr("step")});b.options.step=Math.min.apply(null,e.toArray()),b.options.ticks&&b._buildTicks(),b.options.filled&&b._buildFill(),b._buildHandles()},_buildTicks:function(){var b=this,c=a("<div></div>").addClass("ticks");this.$element.prepend(c);for(var d=Math.round((b.options.max-b.options.min)/b.options.step)-1,e=b.isVertical?b.$element.height():b.$element.width(),f=0;d>f;f++){var g=(f+1)*(e/(d+1)),h=g/e*100,i=a("<div></div>").addClass("tick").css(b.isVertical?"bottom":"left",h+"%");c.append(i)}b.$ticks=c.find(".tick"),b.options.filled&&b._coverTicks()},_buildFill:function(){var b=this;if(this.$fill=a("<div></div>").addClass("fill"),0!==b.values.length){var c,d;b.values.length<2?(c=(b.values[0]-b.options.min)/(b.options.max-b.options.min)*100,this.$fill.css(b.isVertical?"height":"width",c+"%")):(c=(this._getLowestValue()-b.options.min)/(b.options.max-b.options.min)*100,d=(this._getHighestValue()-this._getLowestValue())/(b.options.max-b.options.min)*100,this.$fill.css(b.isVertical?"height":"width",d+"%").css(b.isVertical?"bottom":"left",c+"%"))}this.$element.prepend(this.$fill),b.options.filled=!0},_buildHandles:function(){var b=this;b.$inputs.each(function(c){var d=a(this).wrap("<div></div>").parent().addClass("value"),e=(b.values[c]-b.options.min)/(b.options.max-b.options.min)*100,f=a("<div></div>").addClass("handle").css(b.isVertical?"bottom":"left",e+"%").attr({role:"slider",id:a(this).attr("id")+"-handle","aria-valuemin":b.options.min,"aria-valuemax":b.options.max,"aria-valuenow":b.values[c],"aria-valuetext":b.options.valuetextFormatter(b.values[c])});if(a(this).css(b.isVertical?"bottom":"left",e+"%"),a(d).append(f),b.options.tooltips){var g=a("<output>"+a(this).attr("value")+"</output>").addClass("tooltip").addClass(b.isVertical?"arrow-left":"arrow-bottom").attr({id:a(this).attr("id")+"-tooltip","for":a(this).attr("id")});f.append(g)}if(a(this).attr("aria-labelledby")&&f.attr("aria-labelledby",a(this).attr("aria-labelledby")),b.$inputs.length>1&&a(this).attr("aria-labelledby"))for(var h,i=a(this).attr("aria-labelledby").split(" "),j=0;j<i.length;j++)h=a("#"+i[j]),j>0&&(h.removeAttr("for"),f.prepend(h));CUI.util.isTouch?(f.attr("aria-hidden",!0),a(this).attr("tabindex",0).removeAttr("aria-hidden").removeAttr("hidden")):(f.on("focus",function(a){b._focus(a)}.bind(this)),f.on("blur",function(a){b._blur(a)}.bind(this)),f.on("keydown",function(a){b._keyDown(a)}.bind(this)),f.attr("tabindex",0),a(this).attr({"aria-hidden":!0,tabindex:-1,hidden:"hidden"})),b.options.disabled&&f.attr("aria-disabled",!0).removeAttr("tabindex")}),b.$handles=b.$element.find(".handle"),b.$tooltips=b.$element.find(".tooltip")},_handleClick:function(a){if(this.options.disabled)return!1;var b=this,d=a.pageX,e=a.pageY;if("touchstart"===a.type){var f=a.originalEvent.touches.length>0?a.originalEvent.touches:a.originalEvent.changedTouches;d=f[0].pageX,e=f[0].pageY}if(d!==c&&e!==c){var g=b._findNearestHandle(d,e),h=b._getValueFromCoord(d,e,!0);isNaN(h)||(b._updateValue(g,h),b._moveHandles(),b.options.filled&&b._updateFill()),CUI.util.isTouch||("mousedown"===a.type&&b.$handles.eq(g).data("mousedown",!0),b.$handles.eq(g).focus())}},_findNearestHandle:function(b,c){var d=this,e=999999,f=0;return d.$handles.each(function(g){var h=a(this).offset().left,i=a(this).offset().top,j=a(this).width(),k=a(this).height(),l=Math.abs(b-(h+j/2));"vertical"===d.options.orientation&&(l=Math.abs(c-(i+k/2))),e>l&&(e=l,f=g)}),f},_focus:function(b){if(this.options.disabled)return!1;var c=this,d=a(b.target),e=d.closest(".value"),f=e.find(".handle");f.data("mousedown")||(c.$element.addClass("focus"),e.addClass("focus"),f.addClass("focus"))},_blur:function(b){if(this.options.disabled)return!1;var c=this,d=a(b.target),e=d.closest(".value"),f=e.find(".handle");c.$element.removeClass("focus"),e.removeClass("focus"),f.removeClass("focus").removeData("mousedown")},_keyDown:function(b){if(!this.options.disabled){var c=this,d=a(b.target),e=d.closest(".value").find("input"),f=c.$inputs.index(e),g=Number(e.val()),h=Number(c.options.step),i=Number(c.options.min),j=Number(c.options.max),k=Math.max(h,Math.round((j-i)/10));switch(d.removeData("mousedown"),c._focus(b),b.keyCode){case 40:case 37:g-=h,b.preventDefault();break;case 38:case 39:g+=h,b.preventDefault();break;case 33:g+=k-g%k,b.preventDefault();break;case 34:g-=k-(g%k===0?0:k-g%k),b.preventDefault();break;case 35:g=j,b.preventDefault();break;case 36:g=i,b.preventDefault()}g!==Number(e.val())&&(c.setValue(g,f),e.change())}},_mouseDown:function(c){if(this.options.disabled)return!1;c.preventDefault();var d,e=this;return this.draggingPosition=-1,this.$handles.each(function(a,b){b===c.target&&(e.draggingPosition=a)}.bind(this)),this.$tooltips.each(function(a,b){b===c.target&&(e.draggingPosition=a)}.bind(this)),this.draggingPosition<0?(this._handleClick(c),void 0):(d=this.$handles.eq(this.draggingPosition),d.addClass("dragging"),this.$element.closest("body").addClass("slider-dragging-cursorhack"),a(b).fipo("touchmove.slider","mousemove.slider",this._handleDragging.bind(this)),a(b).fipo("touchend.slider","mouseup.slider",this._mouseUp.bind(this)),d===document.activeElement||CUI.util.isTouch||("mousedown"===c.type&&d.data("mousedown",!0),d.focus()),void 0)},_handleDragging:function(a){var b=a.pageX,c=a.pageY;if(a.originalEvent.targetTouches){var d=a.originalEvent.targetTouches.item(0);b=d.pageX,c=d.pageY}this._updateValue(this.draggingPosition,this._getValueFromCoord(b,c)),this._moveHandles(),this.options.filled&&this._updateFill(),a.preventDefault()},_mouseUp:function(){this.$handles.eq(this.draggingPosition).removeClass("dragging"),this.$element.closest("body").removeClass("slider-dragging-cursorhack"),this.draggingPosition=-1,a(b).unbind("mousemove.slider touchmove.slider"),a(b).unbind("mouseup.slider touchend.slider")},_clickLabel:function(){this.$handles.eq(0)[0].focus()},_updateValue:function(a,b,c){var d=this;(d.$inputs.eq(a).attr("value")!==b.toString()||d.values[a]!==b.toString())&&(b>this.options.max&&(b=this.options.max),b<this.options.min&&(b=this.options.min),(0===a||1===a)&&(2===d.$inputs.length&&this.options.bound&&(0===a?(b=Math.min(b,Number(d.$inputs.eq(1).val())),d.$inputs.eq(1).attr({min:b}),d.$inputs.eq(a).attr({max:d.$inputs.eq(1).val()}),d.$handles.eq(1).attr({"aria-valuemin":b}),d.$handles.eq(a).attr({"aria-valuemax":d.$inputs.eq(1).val()})):(b=Math.max(b,Number(d.$inputs.eq(0).val())),d.$inputs.eq(0).attr({max:b}),d.$inputs.eq(a).attr({min:d.$inputs.eq(0).val()}),d.$handles.eq(0).attr({"aria-valuemax":b}),d.$handles.eq(a).attr({"aria-valuemin":d.$inputs.eq(0).val()}))),d.values[a]=b.toString(),d.$inputs.eq(a).val(b).attr({value:b,"aria-valuetext":d.options.valuetextFormatter(b)}),d.$handles.eq(a).attr({"aria-valuenow":b,"aria-valuetext":d.options.valuetextFormatter(b)}),c||setTimeout(function(){d.$inputs.eq(a).change()},1)))},_moveHandles:function(){var b=this;this.$handles.each(function(c){var d=(b.values[c]-b.options.min)/(b.options.max-b.options.min)*100,e=b.$inputs.eq(c);"vertical"===b.options.orientation?b.options.slide?(a(this).stop().animate({bottom:d+"%"}),e.stop().animate({bottom:d+"%"})):(a(this).css("bottom",d+"%"),e.css("bottom",d+"%")):b.options.slide?(a(this).stop().animate({left:d+"%"}),e.stop().animate({left:d+"%"})):(a(this).css("left",d+"%"),e.css("left",d+"%")),b.options.tooltips&&b.$tooltips.eq(c).html(b.options.tooltipFormatter(b.values[c]))})},_updateFill:function(){var a,b=this;if(0!==b.values.length)if(2===b.values.length){a=(b._getLowestValue()-b.options.min)/(b.options.max-b.options.min)*100;var c=(b._getHighestValue()-b.options.min)/(b.options.max-b.options.min)*100,d=c-a;"vertical"===b.options.orientation?b.options.slide?b.$fill.stop().animate({bottom:a+"%",height:d+"%"}):b.$fill.css("bottom",a+"%").css("height",d+"%"):b.options.slide?b.$fill.stop().animate({left:a+"%",width:d+"%"}):b.$fill.css("left",a+"%").css("width",d+"%")}else a=(b.values[0]-b.options.min)/(b.options.max-b.options.min)*100,"vertical"===b.options.orientation?b.options.slide?b.$fill.stop().animate({height:a+"%"}):b.$fill.css("height",a+"%"):b.options.slide?b.$fill.stop().animate({width:a+"%"}):b.$fill.css("width",a+"%");b.options.ticks&&b._coverTicks()},_coverTicks:function(){var b=this;b.$ticks.each(function(){var c=b._getValueFromCoord(a(this).offset().left,a(this).offset().top);2===b.values.length?c>b._getLowestValue()&&c<b._getHighestValue()?a(this).hasClass("covered")||a(this).addClass("covered"):a(this).removeClass("covered"):c<b._getHighestValue()?a(this).hasClass("covered")||a(this).addClass("covered"):a(this).removeClass("covered")})},_getValueFromCoord:function(a,b,c){var d,e,f,g=this,h=g.$element.offset();if("vertical"===g.options.orientation){var i=g.$element.height();d=(h.top+i-b)/i}else{var j=g.$element.width();d=(a-h.left)/j}if(c&&(0>d||d>1))return 0/0;var k=1*g.options.min+(g.options.max-g.options.min)*d;return k>=g.options.max?g.options.max:k<=g.options.min?g.options.min:(f=(k-g.options.min)%g.options.step,e=2*Math.abs(f)>=g.options.step?k-f+1*g.options.step:k-f)},_getHighestValue:function(){return Math.max.apply(null,this.values)},_getLowestValue:function(){return Math.min.apply(null,this.values)}}),CUI.util.plugClass(CUI.Slider),CUI.options.dataAPI&&a(document).on("cui-contentloaded.data-api",function(b){a(".slider[data-init~='slider']",b.target).slider()})}(jQuery,this),function(a){CUI.LabeledSlider=new Class({toString:"LabeledSlider",extend:CUI.Slider,alternating:!1,construct:function(){this.$element.addClass("labeled-slider")},_getTickLabel:function(a){var b=this.$element.find("ul.tick-labels li").eq(a);return b.html()},_buildTicks:function(){var b=this;this.$element.hasClass("label-alternating")&&(this.alternating=!0);var c=a("<div></div>").addClass("ticks");this.$element.prepend(c);var d=Math.ceil((b.options.max-b.options.min)/b.options.step)-1,e=b.isVertical?b.$element.height():b.$element.width(),f=e/(d+1);this.alternating&&(f*=2);for(var g=0;d>g;g++){var h=e*(g+1)/(d+1),i=a("<div></div>").addClass("tick").css(b.isVertical?"bottom":"left",h+"px");c.append(i);var j="tick-label-"+g,k=a("<div></div").addClass("tick-label "+j);b.isVertical||(h-=f/2),k.css(b.isVertical?"bottom":"left",h+"px"),b.isVertical||k.css("width",f+"px"),b.alternating&&!b.isVertical&&g%2===1&&(k.addClass("alternate"),i.addClass("alternate")),k.append(b._getTickLabel(g)),c.append(k)}b.$ticks=c.find(".tick"),b.options.filled&&b._coverTicks()}}),CUI.util.plugClass(CUI.LabeledSlider),CUI.options.dataAPI&&a(document).on("cui-contentloaded.data-api",function(b){a(".slider[data-init~='labeled-slider']",b.target).labeledSlider()})}(window.jQuery),function(a){function b(a){return 10>a?"0"+a:a}function c(a,b,c){void 0!==a&&(c[b]=a)}function d(a,b,c){c[b]=a?!0:!1}function e(a,b,c){c[b]=a||c[b]}function f(a,b,c){void 0!==a&&(c[b]=1*a)}function g(a){return a?moment([a.year(),a.month(),a.date()]):null}function h(a,b,c){return null===b&&null===c?!0:null===b?c>=a:null===c?a>=b:a>=b&&c>=a}function i(a,b){return a&&b?a.year()===b.year()&&a.month()===b.month()&&a.date()===b.date():void 0}var j=0;CUI.Datepicker=new Class({toString:"Datepicker",extend:CUI.Widget,defaults:{monthNames:null,dayNames:null,format:null,type:"date",selectedDateTime:null,startDay:0,disabled:!1,displayedFormat:null,storedFormat:null,headFormat:"MMMM YYYY",forceHTMLMode:!1,required:!1,hasError:!1,minDate:null,maxDate:null},displayDateTime:null,pickerShown:!1,construct:function(){this.guid=j+=1,this._readOptionsFromMarkup(),this._parseOptions(),this._setupMomentJS(),this._adjustMarkup(),this._findElements(),this._constructPopover(),this._initialize()},_readOptionsFromMarkup:function(){var b=this.options,g=this.$element;g.hasClass("error")&&(b.hasError=!0);var h=a(g.find("input").filter("[type^=date],[type=time]"));0!==h.length&&(b.type=h.attr("type")),[["disabled","disabled",d],["required","required",d],["displayed-format","displayedFormat",c],["stored-format","storedFormat",c],["force-html-mode","forceHTMLMode",c],["day-names","dayNames",e],["month-names","monthNames",e],["head-format","headFormat",e],["start-day","startDay",f],["min-date","minDate",c],["max-date","maxDate",c]].map(function(a){var c=a[0],d=a[1],e=a[2];e(g.data(c),d,b)})},_parseOptions:function(){var a=this.options;a.monthNames=a.monthNames||CUI.Datepicker.monthNames,a.dayNames=a.dayNames||CUI.Datepicker.dayNames,a.isDateEnabled="date"===a.type||"datetime"===a.type||"datetime-local"===a.type,a.isTimeEnabled="time"===a.type||"datetime"===a.type||"datetime-local"===a.type;var b=document.createElement("input");b.setAttribute("type",a.type),a.supportsInputType="text"!==b.type,null!==a.minDate&&(a.minDate="today"===a.minDate?moment().startOf("day"):moment(a.minDate,m).isValid()?moment(a.minDate,m):null),null!==a.maxDate&&(a.maxDate="today"===a.maxDate?moment().startOf("day"):moment(a.maxDate,m).isValid()?moment(a.maxDate,m):null),a.storedFormat=a.storedFormat||("time"===a.type?n:o),a.displayedFormat=a.displayedFormat||("time"===a.type?n:p),a.useNativeControls=a.forceHTMLMode,!a.forceHTMLMode&&l&&a.supportsInputType&&(a.useNativeControls=!0),a.useNativeControls&&(a.displayedFormat="date"===a.type?m:"time"===a.type?n:o)},_setupMomentJS:function(){this.options.language=q+(new Date).getTime(),moment.lang(this.options.language,{months:this.options.monthNames,weekdaysMin:this.options.dayNames})},_adjustMarkup:function(){var b=this.$element;if(b.addClass("datepicker"),this.options.useNativeControls)this.$popover=[];else{0===b.find("input").not("[type=hidden]").length&&b.append(r),0===b.find("button").length&&b.append(s);var c="popguid"+this.guid,d="#"+c+".popover";this.$popover=a("body").find(d),0===this.$popover.length&&(a("body").append(u.replace("%ID%",c)),this.$popover=a("body").find(d),this.options.isDateEnabled&&this.$popover.find(".inner").append(t))}if(0===b.find("input[type=hidden]").length&&b.append('<input type="hidden">'),!b.find("input[type=hidden]").attr("name")){var e=b.find("input").not("[type=hidden]").attr("name");b.find("input[type=hidden]").attr("name",e),b.find("input").not("[type=hidden]").removeAttr("name")}var f=b.find(">button");void 0===f.attr("type")&&f[0].setAttribute("type","button")},_findElements:function(){this.$input=this.$element.find("input").not("[type=hidden]"),this.$hiddenInput=this.$element.find("input[type=hidden]"),this.$openButton=this.$element.find("button")},_constructPopover:function(){this.$popover.length&&(this.popover=new k({$element:this.$popover,$trigger:this.$openButton,options:this.options,setDateTimeCallback:this._popoverSetDateTimeCallback.bind(this),hideCallback:this._popoverHideCallback.bind(this)}))},_initialize:function(){this.options.useNativeControls?this.displayDateTime=this.options.selectedDateTime=moment(this.$input.val(),this.options.displayedFormat):this._switchInputTypeToText(this.$input),this.options.disabled||(this.$openButton.on("click",this._clickHandler.bind(this)),this.$input.on("change"+(l?" blur":""),this._inputChangedHandler.bind(this))),this.options.selectedDateTime||this._readInputVal([this.options.storedFormat,this.options.displayedFormat]),this._setDateTime(this.options.selectedDateTime,!0)},_readInputVal:function(a){var b=this.$input.eq(0).val(),c=moment(b,a||this.options.displayedFormat);c&&c.isValid()||(c=moment(b)),this.displayDateTime=this.options.selectedDateTime=c},_updateState:function(){this.options.disabled?(this.$element.find("input,button").attr("disabled","disabled"),this._hidePicker()):this.$element.find("input,button").removeAttr("disabled"),this.options.hasError||!this.options.selectedDateTime&&this.options.required||this.options.selectedDateTime&&!this.options.selectedDateTime.isValid()?this.$element.addClass("error"):this.$element.removeClass("error")},_popoverSetDateTimeCallback:function(){this._setDateTime.apply(this,arguments),this.options.isTimeEnabled===!1&&this._hidePicker()},_popoverHideCallback:function(){this.pickerShown=!1},_switchInputTypeToText:function(a){var b=a.detach().attr("type","text");this.$element.prepend(b)},_openNativeInput:function(){this.$input.trigger("tap")},_clickHandler:function(){if(this.pickerShown)this._hidePicker();else{var a=this;setTimeout(function(){a._openPicker()},100)}},_inputChangedHandler:function(){if(!this.options.disabled){var a=moment(this.$input.val(),this.options.displayedFormat);this.options.hasError=null===a||h(a,this.options.minDate,this.options.maxDate)?!1:!0,this._setDateTime(a,!0)}},_keyPress:function(){this.pickerShown},_openPicker:function(){this.options.useNativeControls?this._openNativeInput():(this._readInputVal(),this._showPicker())},_showPicker:function(){this.pickerShown||(this.$element.addClass("focus"),this.popover.show(this.displayDateTime),this.pickerShown=!0)},_hidePicker:function(){this.pickerShown&&(this.$element.removeClass("focus"),this.popover.hide(),this.pickerShown=!1)},_setDateTime:function(a,b){this.options.selectedDateTime=this.displayDateTime=a,a?a.isValid()&&this.$input.val(a.lang(this.options.language).format(this.options.displayedFormat)):this.$input.val("");var c=a&&a.isValid()?a.lang("en").format(this.options.storedFormat):"";this.$hiddenInput.val(c),this._updateState(),b||this.$input.trigger("change"),this.$hiddenInput.trigger("change")}}),CUI.Datepicker.monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"],CUI.Datepicker.dayNames=["Su","Mo","Tu","We","Th","Fr","Sa"],CUI.util.plugClass(CUI.Datepicker),CUI.options.dataAPI&&a(document).on("cui-contentloaded.data-api",function(b){a("[data-init~=datepicker]",b.target).datepicker()});var k=new Class({toString:"Popover",extend:Object,construct:function(a){this.$element=a.$element,this.options=a.options,this.setDateTimeCallback=a.setDateTimeCallback,this.hideCallback=a.hideCallback,this.$element.popover(),this.popover=this.$element.data("popover"),this.popover.set({pointAt:a.$trigger,pointFrom:"bottom"}),this._setupListeners()},show:function(a){this.displayDateTime=a,this._renderCalendar(),this.options.isTimeEnabled&&this._renderTime(),this.popover.show()},hide:function(){this.popover.hide()},_setupListeners:function(){this.popover.on("hide",this._popupHideHandler.bind(this)),this.$element.find(".calendar").on("swipe",this._swipeHandler.bind(this)),this.$element.on("mousedown",".next-month",this._mouseDownNextHandler.bind(this)),this.$element.on("mousedown",".prev-month",this._mouseDownPrevHandler.bind(this)),this.options.isTimeEnabled&&(this.$element.on("selected",".hour,.minute",this._dropdownChangedHandler.bind(this)),this.$element.on("change",".hour,.minute",this._dropdownChangedHandler.bind(this)))},_popupHideHandler:function(){this.hideCallback()},_swipeHandler:function(a){var b=a.direction,c=this.displayDateTime.year(),d=this.this.displayDateTime.month();"left"===b?(this.displayDateTime=g(moment([c,d+1,1])),this._renderCalendar("left")):"right"===b&&(this.displayDateTime=g(moment([c,d-1,1])),this._renderCalendar("right"))},_mouseDownNextHandler:function(a){a.preventDefault(),this.displayDateTime&&(this.displayDateTime=g(moment([this.displayDateTime.year(),this.displayDateTime.month()+1,1])),this._renderCalendar("left"))},_mouseDownPrevHandler:function(a){a.preventDefault(),this.displayDateTime&&(this.displayDateTime=g(moment([this.displayDateTime.year(),this.displayDateTime.month()-1,1])),this._renderCalendar("right"))},_dropdownChangedHandler:function(){var a=this._getHoursFromDropdown(),b=this._getMinutesFromDropdown();this.options.selectedDateTime||(this.options.selectedDateTime=moment());var c=this.options.selectedDateTime.hours(a).minutes(b);this.setDateTimeCallback(c)},_tableMouseDownHandler:function(b){b.preventDefault();var c=moment(a(b.target).data("date"),o);if(this.options.isTimeEnabled){var d=this._getHoursFromDropdown(),e=this._getMinutesFromDropdown();c.hours(d).minutes(e)}this.setDateTimeCallback(c),this._renderCalendar()},_renderCalendar:function(a){var b=this.displayDateTime;b&&b.isValid()||(this.displayDateTime=b=moment());var c=b.year(),d=b.month()+1,e=this._renderOneCalendar(d,c),f=this.$element.find(".calendar");e.on("mousedown","a",this._tableMouseDownHandler.bind(this)),f.find("table").length>0&&a?this._slideCalendar(e,"left"===a):(f.find("table").remove(),f.find(".sliding-container").remove(),f.find(".calendar-body").append(e))},_renderOneCalendar:function(b,c){var d=moment([c,b-1,1]).lang(this.options.language).format(this.options.headFormat),e=a('<div class="calendar-header"><h2>'+d+"</h2></div>").append(a('<button class="next-month"></button>')).append(a('<button class="prev-month"></button>')),f=this.$element.find(".calendar"),g=f.find(".calendar-header");g.length>0?g.replaceWith(e):f.prepend(e);var j=a("<table>");j.data("date",c+"/"+b);for(var k="<tr>",l=null,m=0;7>m;m++){l=(m+this.options.startDay)%7;var n=this.options.dayNames[l];k+="<th><span>"+n+"</span></th>"}k+="</tr>",j.append("<thead>"+k+"</thead>");var p=moment([c,b-1,1]),q=(p.day()-this.options.startDay)%7;0>q&&(q+=7),k="";for(var r=moment(),s=0;6>s;s++){k+="<tr>";for(var t=0;7>t;t++){l=7*s+t-q+1;var u=moment([c,b-1,l]),v=u.month()+1===parseFloat(b),w="";i(u,r)&&(w+=" today"),i(u,this.options.selectedDateTime)&&(w+=" selected"),k+=v&&h(u,this.options.minDate,this.options.maxDate)?'<td class="'+w+'"><a href="#" data-date="'+u.lang(this.options.language).format(o)+'">'+u.date()+"</a></td>":'<td class="'+w+'"><span>'+u.date()+"</span></td>"}k+="</tr>"}return j.append("<tbody>"+k+"</tbody>"),j},_slideCalendar:function(b,c){this.$element.find(".sliding-container table").stop(!0,!0),this.$element.find(".sliding-container").remove();var d=this.$element.find("table"),e=d.width(),f=d.height(),g=a('<div class="sliding-container">');g.css({display:"block",position:"relative",width:e+"px",height:f+"px",overflow:"hidden"}),this.$element.find(".calendar-body").append(g),g.append(d).append(b),d.css({position:"absolute",left:0,top:0}),d.after(b),b.css({position:"absolute",left:c?e:-e,top:0}),d.animate({left:c?-e:e},A,function(){d.remove()}),b.animate({left:0},A,function(){0!==g.parents().length&&(b.css({position:"relative",left:0,top:0}),b.detach(),this.$element.find(".calendar-body").append(b),g.remove())}.bind(this))},_renderTime:function(){for(var c=this.options.selectedDateTime,d=a(v),e=a("<select></select>"),f=0;24>f;f++){var g=a("<option>"+b(f)+"</option>");c&&f===c.hours()&&g.attr("selected","selected"),e.append(g)}for(var h=a(w).append(e),i=a("<select></select>"),j=0;60>j;j++){var k=a("<option>"+b(j)+"</option>");c&&j===c.minutes()&&k.attr("selected","selected"),i.append(k)}var l=a(x).append(i);a(h).css(y),a(h).find("select").css(z),a(l).css(y),a(l).find("select").css(z),d.append(h,a("<span>:</span>"),l),0===this.$element.find(".time").length?this.$element.find(".inner").append(d):this.$element.find(".time").empty().append(d.children()),a(h).select(),a(l).select()},_getHoursFromDropdown:function(){return parseInt(this.$element.find(".time .hour select").val(),10)},_getMinutesFromDropdown:function(){return parseInt(this.$element.find(".time .minute select").val(),10)}}),l=navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/iPhone|iPad|iPod/i),m="YYYY-MM-DD",n="HH:mm",o="YYYY-MM-DD[T]HH:mmZ",p="YYYY-MM-DD HH:mm",q="coralui_",r='<input type="text">',s='<button class="icon-calendar small"><span>Datepicker</span></button>',t=['<div class="calendar">','<div class="calendar-header"></div>','<div class="calendar-body"></div>',"</div>"].join(""),u=['<div class="datepicker popover" style="display:none" id="%ID%">','<div class="inner"></div>',"</div>"].join(""),v="<div class='time'><i class='icon-clock small'></i></div>",w='<div class="select hour"><button></button></div>',x='<div class="select minute"><button>Single Select</button></div>',y={position:"relative"},z={position:"absolute",left:"1.5rem",top:"1rem"},A=400
}(window.jQuery),function(a){CUI.Pulldown=new Class({toString:"Pulldown",extend:CUI.Widget,defaults:{pulldownSize:0},timeout:null,popoverShown:!1,construct:function(){this._readDataFromMarkup();var a=this.$element.find("a").first(),b=this.$element.find(".popover").first();a.on("click",function(a){a.preventDefault(),this.togglePopover(),this._keepFocus()}.bind(this)),b.on("click",function(){this._keepFocus()}.bind(this)),a.on("blur",function(){this.timeout=setTimeout(function(){this.timeout=null,this.hidePopover()}.bind(this),200)}.bind(this)),b.fipo("tap","click","ul > li > a",function(){var a=this;setTimeout(function(){a.hidePopover()},500)}.bind(this))},_readDataFromMarkup:function(){this.$element.data("pulldownSize")&&(this.options.pulldownSize=1*this.$element.data("pulldownSize"))},_keepFocus:function(){var a=this.$element.find("a").first();a.is(".disabled, [disabled]")||(clearTimeout(this.timeout),this.timeout=null,a.focus())},togglePopover:function(){this.popoverShown?this.hidePopover():this.$element.find("a").first().is(".disabled, [disabled]")||this.showPopover()},showPopover:function(){this._placePopover(),this.$element.find(".popover").show(),this.popoverShown=!0},hidePopover:function(){this.$element.find(".popover").hide(),this.popoverShown=!1},setDisabled:function(a){a===!0?(this.$element.find("a").first().addClass("disabled"),this.hidePopover()):this.$element.find("a").first().removeClass("disabled")},_placePopover:function(){var b,c,d,e=this.$element.find("a").first(),f=this.$element.find(".popover"),g=e.position(),h=Math.max(e.width()+22,f.width()),i={width:h,height:e.height()};f.hasClass("alignleft")?(b=g.top+i.height,c=-30,d=30-h):(b=g.top+i.height+15,c=g.left+e.width()-i.width+5,d=i.width-30),f.css({top:b,left:c,width:i.width});var j=f.find("ul").first();if(this.options.pulldownSize>0){var k=0;j.find("li:lt("+this.options.pulldownSize+")").each(function(){k+=a(this).outerHeight()+a(this).find("a").first().outerHeight()}),j.css("max-height",k)}}}),CUI.util.plugClass(CUI.Pulldown),CUI.options.dataAPI&&a(document).on("cui-contentloaded.data-api",function(b){a("[data-init~=pulldown]",b.target).pulldown()})}(window.jQuery),function(a){CUI.Sticky=new Class({toString:"Sticky",extend:CUI.Widget,construct:function(){this.$element.addClass("sticky"),this.wrapper=a("<div>").addClass("sticky-wrapper"),this.$element.wrapAll(this.wrapper),this.wrapper=this.$element.parent(),this.wrapper.height(this.$element.outerHeight(!0)),this.scrollingElement=this.$element.parents(".sticky-container"),0===this.scrollingElement.length&&(this.scrollingElement=a(document),this.pageScroll=!0),this.scrollingElement.on("scroll",this._fixElementPosition.bind(this)),a(window).on("resize",this._fixElementPosition.bind(this))},_fixElementPosition:function(){var a=this.wrapper.offset().top,b=this.pageScroll?this.scrollingElement.scrollTop():this.scrollingElement.offset().top,c=this._getStickPosition(),d=this.wrapper.position().left,e=this.wrapper.width();if(b>a-c){if(!this.pageScroll){var f=this.scrollingElement.position();c+=f.top,d+=f.left,this.$element.detach(),this.scrollingElement.after(this.$element)}this.$element.css({position:this.pageScroll?"fixed":"absolute",top:c+"px",left:d,width:e+"px"})}else this.pageScroll||(this.$element.detach(),this.wrapper.append(this.$element)),this.$element.css({position:"",top:"",left:"",width:e+"px"})},_getStickPosition:function(){var b=this.wrapper.offset().top,c=0;return this.scrollingElement.find(".sticky-wrapper").each(function(d,e){a(e).offset().top<b&&(c+=a(e).outerHeight(!0))}.bind(this)),c},scrollingElement:null,pageScroll:!1,wrapper:null}),CUI.util.plugClass(CUI.Sticky),CUI.options.dataAPI&&a(document).on("cui-contentloaded.data-api",function(b){a(".sticky,[data-init=sticky]",b.target).sticky()})}(window.jQuery),function(a){var b="grid",c="list",d="single",e="multiple",f={itemSelector:"article",headerSelector:"header",dataContainer:"grid-0",enableImageMultiply:!0,view:{selectedItem:{list:{cls:"selected"},grid:{cls:"selected"}},selectedItems:{list:{selector:"article.selected"},grid:{selector:"article.selected"}}},controller:{selectElement:{list:"article > i.select",grid:"article"},moveHandleElement:{list:"article > i.move"},targetToItem:{list:function(a){return a.closest("article")},grid:function(a){return a.closest("article")},header:function(a){return a.closest("header")}},gridSelect:{cls:"selection-mode"},selectAll:{selector:"header > i.select",cls:"selected"},sort:{columnSelector:".label > *"}}},g=function(a){return a.jquery?a.data("cardView-item"):a},h={equals:function(a,b){return a.length===b.length&&a.length===a.filter(b).length},getWidget:function(b){var c;return b.length>0&&(c=a(b[0]).data("cardView")),c},mixObjects:function(a,b){if(void 0===a)return b;var c={};for(var d in b)if(void 0!==a[d]){var e=a[d];"object"!=typeof a[d]||a[d]instanceof String||(e=this.mixObjects(a[d],b[d])),c[d]=e}else c[d]=b[d];return c},resolve:function(b,c){var d=[];return b.each(function(){d.push.apply(d,c(a(this)).toArray())}),a(d)},multiplyImages:function(b,c){function d(){f>g&&(e(b[g]),g++,setTimeout(d,0))}function e(b){var d=b.naturalWidth,f=b.naturalHeight;if(0===d&&0===f)return window.setTimeout(function(){e(b)},200),void 0;var g=a("<canvas width='"+d+"' height='"+f+"'></canvas>")[0],h=g.getContext("2d");h.drawImage(b,0,0,d,f);for(var i=h.getImageData(0,0,d,f),j=i.data,k=0,l=j.length;l>k;k+=4)j[k]*=c[0],j[k+1]*=c[1],j[k+2]*=c[2];h.putImageData(i,0,0),a("<img class='"+b.className+" multiplied' width='"+d+"' height='"+f+"' src='"+g.toDataURL("image/png")+"'/>").insertBefore(b)}b=b.filter(function(){var b=a(this);return!b.is(".multiplied")&&!b.prev().is(".multiplied")&&b.is(":visible")});var f=b.length,g=0;d()}},i=new Class({$el:null,$containerEl:null,stepSize:0,iid:void 0,autoMoveOffset:0,maxScrollTop:0,construct:function(a,b,c){this.$el=a,this.stepSize=b,this.$containerEl=this._getScrollingContainer(a);var d=this.$containerEl[0];this.maxScrollTop=Math.max(d.scrollHeight-d.clientHeight,0),this.autoMoveFn=c},_getScrollingContainer:function(b){for(;b.length>0&&!b.is("body");){var c=b.css("overflowY"),d=b.css("position");if(("auto"===c||"visible"===c)&&"absolute"===d)return b;b=b.parent()}return a(window)},_execute:function(){var a=this.$containerEl[0],b=a.clientHeight,c=a.scrollTop,d=this.$el.offset().top-this.$containerEl.offset().top,e=d+this.$el.height(),f=!1;return 0>=d?c>0&&(c-=this.stepSize,this.autoMoveOffset=-this.stepSize,0>c&&(c=0),a.scrollTop=c,f=!0):e>=b&&c<this.maxScrollTop&&(c+=this.stepSize,this.autoMoveOffset=this.stepSize,c>this.maxScrollTop&&(c=this.maxScrollTop),a.scrollTop=c,f=!0),f},_autoMove:function(){if(this.autoMoveOffset&&this.autoMoveFn){var a=this.$el.offset(),b=a.top+this.autoMoveOffset;this.autoMoveFn(a.left,b)}},check:function(){var a=this;this.stop();var b=this._execute();b&&(this.iid=window.setTimeout(function(){a.iid=void 0,a._autoMove()},50))},stop:function(){void 0!==this.iid&&(window.clearTimeout(this.iid),this.autoMoveOffset=0,this.iid=void 0)}}),j=new Class({$listEl:null,$itemEl:null,$items:null,$doc:null,$oldBefore:null,dragCls:null,fixHorizontalPosition:!1,autoScroller:null,construct:function(a){var b=this;this.$listEl=a.$listEl,this.$itemEl=a.$itemEl,this.$items=a.$items,this.dragCls=a.dragCls,this.fixHorizontalPosition=a.fixHorizontalPosition!==!1,this.autoScroller=a.autoScrolling?new i(this.$itemEl,8,function(a,c){b._autoMove(a,c)}):void 0},_getEventCoords:function(a){return a.originalEvent.touches?a.originalEvent.touches.length>0?{x:a.originalEvent.touches[0].pageX,y:a.originalEvent.touches[0].pageY}:a.originalEvent.changedTouches.length>0?{x:a.originalEvent.changedTouches[0].pageX,y:a.originalEvent.changedTouches[0].pageY}:{x:a.pageX,y:a.pageY}:{x:a.pageX,y:a.pageY}},_limit:function(a,b){b<this.listOffset.left&&(b=this.listOffset.left),a<this.listOffset.top&&(a=this.listOffset.top);var c=b+this.size.width,d=a+this.size.height,e=this.listOffset.left+this.listSize.width,f=this.listOffset-a+this.listSize.height;return c>e&&(b=e-this.size.width),d>f&&(a=f-this.size.height),this.fixHorizontalPosition&&(b=this.listOffset.left),{top:a,left:b}},_getEventPos:function(a){var b=this._getEventCoords(a);return{x:b.x-this.delta.left,y:b.y-this.delta.top}},_adjustPosition:function(a,b){this.$itemEl.offset(this._limit(b,a)),this.autoScroller&&this.autoScroller.check()},_changeOrderIfRequired:function(){for(var b=this.$itemEl.offset(),c=b.left+this.size.width/2,d=b.top+this.size.height/2,e=null,f=!1,g=0;g<this.$items.length;g++){var i=a(this.$items[g]);if(!h.equals(i,this.$itemEl)){var j=i.offset(),k=i.width(),l=i.height(),m=j.top+l;if(c>=j.left&&c<j.left+k&&d>=j.top&&m>d){f=d-j.top>m-d,e=i;break}}}if(e){var n=this.$itemEl.offset();f?e.before(this.$itemEl):e.after(this.$itemEl),this.$itemEl.offset(n)}},_autoMove:function(a,b){this._adjustPosition(a,b),this._changeOrderIfRequired()},start:function(b){this.$oldPrev=this.$itemEl.prev(),this.$oldNext=this.$itemEl.next();var c=this._getEventCoords(b);this.dragCls&&this.$itemEl.addClass(this.dragCls);var d=this;this.$doc=a(document),this.$doc.fipo("touchmove.listview.drag","mousemove.listview.drag",function(a){d.move(a)}),this.$doc.fipo("touchend.listview.drag","mouseup.listview.drag",function(a){d.end(a)}),this.offset=this.$itemEl.offset(),this.delta={left:c.x-this.offset.left,top:c.y-this.offset.top},this.size={width:this.$itemEl.width(),height:this.$itemEl.height()},this.listOffset=this.$listEl.offset(),this.listSize={width:this.$listEl.width(),height:this.$listEl.height()},b.stopPropagation(),b.preventDefault()},move:function(a){var b=this._getEventPos(a);this._adjustPosition(b.x,b.y),this._changeOrderIfRequired(),a.stopPropagation(),a.preventDefault()},end:function(b){var c=this._getEventPos(b);this._adjustPosition(c.x,c.y),this.dragCls&&this.$itemEl.removeClass(this.dragCls),this.autoScroller&&this.autoScroller.stop(),this.$itemEl.css("position",""),this.$itemEl.css("top",""),this.$itemEl.css("left",""),this.$doc.off("touchmove.listview.drag"),this.$doc.off("mousemove.listview.drag"),this.$doc.off("touchend.listview.drag"),this.$doc.off("mouseup.listview.drag");var d=this.$itemEl.prev(),e=this.$itemEl.next();this.$itemEl.trigger(a.Event("item-moved",{newPrev:d,newNext:e,oldPrev:this.$oldPrev,oldNext:this.$oldNext,hasMoved:!h.equals(d,this.$oldPrev)})),b.stopPropagation(),b.preventDefault()}}),k=new Class({$itemEl:null,construct:function(a){this.$itemEl=a,this.reference()},getItemEl:function(){return this.$itemEl},reference:function(){this.$itemEl.data("cardView-item",this)}}),l=new Class({$headerEl:null,itemRef:null,construct:function(a,b){this.$headerEl=a,this.itemRef=b},getHeaderEl:function(){return this.$headerEl},getItemRef:function(){return this.itemRef},setItemRef:function(a){this.itemRef=a}}),m=new Class({construct:function(a){this.model=a.model,this.comparators=a.comparators,this.selectors=a.selectors,this.columnElement=a.columnElement,this.headerElement=a.columnElement.closest(this.selectors.headerSelector);var b=this.model.getHeaderForEl(this.headerElement);if(this.items=this.model.getItemsForHeader(b),this.isReverse=this.columnElement.hasClass("sort-asc"),this.toNatural=this.columnElement.hasClass("sort-desc"),this.fromNatural=!this.headerElement.hasClass("sort-mode"),this.comparator=null,this.comparators)for(var c in this.comparators)this.columnElement.is(c)&&(this.comparator=this.comparators[c]);this.comparator||(this.comparator=this._readComparatorFromMarkup())},_readComparatorFromMarkup:function(){var a=this.columnElement.data("sort-selector"),b=this.columnElement.data("sort-attribute"),c=this.columnElement.data("sort-type"),d=this.columnElement.data("ignorecase");return a||b?new CUI.CardView.DefaultComparator(a,b,c,d):null},_adjustMarkup:function(){this.fromNatural&&this.headerElement.addClass("sort-mode"),this.toNatural&&this.headerElement.removeClass("sort-mode"),this.headerElement.find(this.selectors.controller.sort.columnSelector).removeClass("sort-asc sort-desc"),this.columnElement.removeClass("sort-desc sort-asc"),this.toNatural||this.columnElement.addClass(this.isReverse?"sort-desc":"sort-asc");var b=this.toNatural;a.each(this.items,function(){this.getItemEl().find(".move").toggle(b)})},sort:function(){if(this.comparator||this.toNatural){this._adjustMarkup();var b=this.items.slice();if(this.comparator){this.comparator.setReverse(this.isReverse);var c=this.comparator.getCompareFn();this.toNatural||b.sort(c)}var d=this.headerElement;a.each(this.items,function(){this.getItemEl().detach()});for(var e=0;e<b.length;e++){var f=b[e].getItemEl();d.after(f),d=f}}}}),n=new Class({$el:null,items:null,headers:null,selectors:null,construct:function(b,c){this.$el=b,this.items=[],this.selectors=c;for(var d=this.$el.find(c.itemSelector),e=d.length,f=0;e>f;f++)this.items.push(new k(a(d[f])));this.headers=[];for(var g=this.$el.find(c.headerSelector),h=g.length,i=0;h>i;i++){var j=a(g[i]),m=j.nextAll(c.itemSelector),n=m.length>0?this.getItemForEl(a(m[0])):void 0;this.headers.push(new l(j,n))}},initialize:function(){var a=this;this.$el.on("item-moved",this.selectors.itemSelector,function(b){b.hasMoved&&a._reorder(b)})},_reorder:function(b){var c,d=this.getItemForEl(a(b.target)),e=this.getItemForEl(b.newPrev),f=!1;if(!e&&(c=this.getHeaderForEl(b.newPrev))){f=!0;var g=this.getItemIndex(c.getItemRef());g>0&&(e=this.getItemAt(g-1))}var h=this.getItemIndex(d);this.items.splice(h,1);var i=this._getHeaderByItemRef(d);i&&i.setItemRef(this.getItemAt(h));var j=e?this.getItemIndex(e)+1:0;this.items.splice(j,0,d),f&&c.setItemRef(d)},getItemCount:function(){return this.items.length},getItemAt:function(a){return this.items[a]},getItemIndex:function(a){for(var b=0;b<this.items.length;b++)if(a===this.items[b])return b;return-1},getItemForEl:function(a){for(var b=this.items.length,c=0;b>c;c++){var d=this.items[c];if(h.equals(d.getItemEl(),a))return d}return void 0},insertItemAt:function(b,c,d){a.isArray(b)||(b=b.toArray());for(var e=b.length-1;e>=0;e--){var f=b[e];f.jquery||(f=a(f));var g,i=new k(f);void 0===c||null===c?(this.items.push(i),c=this.items.length-1):(g=this.items[c],this.items.splice(c,0,i));for(var j={item:g,mode:"item"},l=this.headers.length,m=0;l>m;m++){var n=this.headers[m];if(n.getItemRef()===g){if(d){j={item:n,mode:"header"};break}n.setItemRef(i)}}this.$el.trigger(a.Event("change:insertitem",{insertPoint:j,followupItem:g,item:i,pos:c,widget:h.getWidget(this.$el),moreItems:e>0}))}},getHeaderCount:function(){return this.headers.length},getHeaderAt:function(a){return this.headers[a]},getHeaders:function(){var a=[];return a.push.apply(a,this.headers),a},getHeaderForEl:function(a){for(var b=this.headers.length,c=0;b>c;c++){var d=this.headers[c];if(h.equals(d.getHeaderEl(),a))return d}return void 0},_getHeaderByItemRef:function(a){for(var b=0;b<this.headers.length;b++)if(this.headers[b].getItemRef()===a)return this.headers[b];return void 0},getItemsForHeader:function(a){for(var b=a.getItemRef(),c=this.headers.length,d=this.items.length,e=[],f=!1,g=0;d>g;g++){var h=this.items[g];if(f){for(var i=0;c>i;i++)if(this.headers[i].getItemRef()===h){f=!1;break}if(!f)break;e.push(h)}else h===b&&(f=!0,e.push(b))}return e},fromItemElements:function(b){var c=[];return b.each(function(){var b=a(this).data("cardView-item");b&&c.push(b)}),c},reference:function(){for(var a=this.items.length,b=0;a>b;b++)this.items[b].reference()},removeAllItemsSilently:function(){this.items.length=0;for(var a=0;a<this.headers.length;a++)this.headers[a].setItemRef(void 0)}}),o=new Class({$el:null,selectors:null,construct:function(a,b){this.$el=a,this.selectors=b},initialize:function(){var a=this;this.$el.on("change:displayMode",function(b){var c=b.oldValue,d=b.value;a.cleanupAfterDisplayMode(c),a.prepareDisplayMode(d)}),this.$el.on("change:insertitem",function(b){a._onItemInserted(b)}),this.$el.reflow({small:function(a,b){return a.width()>40*b.rem()&&a.width()<50*b.rem()},xsmall:function(a,b){return a.width()>30*b.rem()&&a.width()<40*b.rem()},xxsmall:function(a,b){return a.width()<30*b.rem()}})},_onItemInserted:function(a){var d=this.$el;this.selectors.dataContainer&&(d=d.find("."+this.selectors.dataContainer));var e=a.item.getItemEl(),f=a.followupItem;switch(this.getDisplayMode()){case c:if(f){var g=a.insertPoint,i=g.item,j="item"===g.mode?i.getItemEl():i.getHeaderEl();j.before(e)}else d.append(e);break;case b:if(!a.moreItems){var k=h.getWidget(this.$el);k._restore(),k.layout()}}},getDisplayMode:function(){return h.getWidget(this.$el).getDisplayMode()},setSelectionState:function(a,c){var d=this.getDisplayMode(),e=this.selectors.view.selectedItem[d],f=a.getItemEl();e.selector&&(f=f.find(e.selector)),"selected"===c?(f.addClass(e.cls),d===b&&this._drawSelectedGrid(a)):"unselected"===c&&f.removeClass(e.cls)},getSelectionState:function(a){var b=this.selectors.view.selectedItem[this.getDisplayMode()],c=a.getItemEl();b.selector&&(c=c.find(b.selector));for(var d=b.cls.split(" "),e=0;e<d.length;e++)if(!c.hasClass(d[e]))return"unselected";return"selected"},getSelectedItems:function(){var a=this.selectors.view.selectedItems[this.getDisplayMode()],b=this.$el.find(a.selector);return a.resolver&&(b=a.resolver(b)),b},restore:function(b,c){var d=a("<div class='"+this.selectors.dataContainer+"'>");this.$el.empty(),this.$el.append(d);for(var e=b.getItemCount(),f=0;e>f;f++)d.append(b.getItemAt(f).getItemEl());if(c)for(var g=b.getHeaderCount(),h=0;g>h;h++){var i=b.getHeaderAt(h),j=i.getHeaderEl(),k=i.getItemRef();k?k.getItemEl().before(j):d.append(j)}},prepareDisplayMode:function(a){a===b&&this._drawAllSelectedGrid()},cleanupAfterDisplayMode:function(){},_drawImage:function(b){if(0!==b.length){if(void 0===this._colorFloat){var c=b.closest("a").css("background-color");this._colorFloat=a.map(c.match(/(\d+)/g),function(a){return a/255})}h.multiplyImages(b,this._colorFloat)}},_drawAllSelectedGrid:function(){if(this.selectors.enableImageMultiply){var b=this,c=this.selectors.view.selectedItems.grid.selector+" img",d=a(c);this._drawImage(d),d.load(function(){b._drawImage(a(this))})}},_drawSelectedGrid:function(b){if(this.selectors.enableImageMultiply){var c=this,d=b.getItemEl().find("img");this._drawImage(d),d.load(function(){c._drawImage(a(this))})}},removeAllItemsSilently:function(){this.$el.find(this.selectors.itemSelector).remove()}}),p=new Class({$el:null,selectors:null,comparators:null,selectionModeCount:null,_listSelect:!1,construct:function(a,b,c){this.$el=a,this.selectors=b,this.comparators=c,this.selectionModeCount=e},initialize:function(){this.setDisplayMode(this.$el.hasClass("list")?c:b);var d=this;this.$el.fipo("tap.cardview.select","click.cardview.select",this.selectors.controller.selectElement.list,function(a){var b=h.getWidget(d.$el);if(b.getDisplayMode()===c){var e=g(d.getItemElFromEvent(a));b.toggleSelection(e)&&(a.stopPropagation(),a.preventDefault()),"tap"===a.type&&(d._listSelect=!0)}}),this.$el.fipo("tap.cardview.select","click.cardview.select",this.selectors.controller.selectElement.grid,function(a){var c=h.getWidget(d.$el);if(c.getDisplayMode()===b&&c.isGridSelectionMode()){var e=g(d.getItemElFromEvent(a));c.toggleSelection(e)&&(a.stopPropagation(),a.preventDefault())}}),this.$el.fipo("tap.cardview.selectall","click.cardview.selectall",this.selectors.controller.selectAll.selector,function(b){var e=h.getWidget(d.$el);if(e.getDisplayMode()===c){var f=d.selectors.controller.selectAll.cls,g=d.selectors.controller.targetToItem.header(a(b.target)),i=e.getModel().getHeaderForEl(g);g.hasClass(f)?e.deselectAll(i):e.selectAll(i)}}),this.$el.fipo("tap.cardview.sort","click.cardview.sort",this.selectors.headerSelector+" "+this.selectors.controller.sort.columnSelector,function(b){var c=h.getWidget(d.$el),e=c.getModel(),f=a.Event("sortstart");if(a(b.target).trigger(f),!f.isDefaultPrevented()){var g=new m({model:e,columnElement:a(b.target),comparators:d.comparators,selectors:d.selectors});g.sort(),f=a.Event("sortend"),a(b.target).trigger(f)}}),this.$el.on("selectstart.cardview",this.selectors.headerSelector+" "+this.selectors.controller.sort.columnSelector,function(a){a.preventDefault()}),this.$el.finger("click.cardview.select",this.selectors.controller.selectElement.grid,function(a){var c=h.getWidget(d.$el),e=c.getDisplayMode();e===b&&c.isGridSelectionMode()&&(a.stopPropagation(),a.preventDefault())});var e=this.selectors.controller.selectElement.listNavElement||this.selectors.controller.selectElement.grid;this.$el.finger("click.cardview.select",e,function(a){var b=h.getWidget(d.$el),e=b.getDisplayMode();e===c&&d._listSelect&&(a.stopPropagation(),a.preventDefault()),d._listSelect=!1}),this.$el.fipo("touchstart.cardview.reorder","mousedown.cardview.reorder",this.selectors.controller.moveHandleElement.list,function(b){var c=d.getItemElFromEvent(b),e=new j({$listEl:d.$el,$itemEl:c,$items:a(d.selectors.itemSelector),dragCls:"dragging",autoScrolling:!0});e.start(b)}),this.$el.on("change:selection",function(a){a.moreSelectionChanges||d._adjustSelectAllState(a.widget)}),this.$el.on("change:insertitem",function(a){a.moreItems||d._adjustSelectAllState(a.widget)})},_adjustSelectAllState:function(a){for(var b=this.selectors.controller.selectAll.cls,c=a.getHeaderSelectionState(),d=c.headers,e=d.length,f=0;e>f;f++){var g=d[f],h=g.header.getHeaderEl();g.hasUnselected?h.removeClass(b):h.addClass(b)}},getItemElFromEvent:function(b){var c=a(b.target),d=this.selectors.controller.targetToItem[this.getDisplayMode()];return a.isFunction(d)?d(c):c.find(d)},isGridSelect:function(){var a=this.selectors.controller.gridSelect,b=this.$el;return a.selector&&(b=b.find(a.selector)),b.hasClass(a.cls)},setGridSelect:function(b){if(this.isGridSelect()!==b){var c=this.selectors.controller.gridSelect,d=this.$el;c.selector&&(d=d.find(c.selector)),b?d.addClass(c.cls):(d.removeClass(c.cls),h.getWidget(d).clearSelection()),this.$el.trigger(a.Event("change:gridSelect",{widget:this.$el.data("cardView"),oldValue:!b,value:b}))}},getDisplayMode:function(){return this.$el.hasClass("list")?c:this.$el.hasClass("grid")?b:null},isColumnSorted:function(){return"list"==this.getDisplayMode()&&this.$el.find(this.selectors.headerSelector).filter(".sort-mode").length>0},setDisplayMode:function(d){var e=this.getDisplayMode();if(e!==d){var f=h.getWidget(this.$el);switch(f._restore(d===c),d){case b:if(this.$el.removeClass("list"),this.$el.addClass("grid"),null!==e){var g=f.getSelection();this.setGridSelect(g.length>0),f.layout()}break;case c:this.$el.cuigridlayout("destroy"),this.$el.removeClass("grid"),this.$el.addClass("list")}this.$el.trigger(a.Event("change:displayMode",{widget:this.$el.data("cardView"),oldValue:e,value:d}))}},getSelectionModeCount:function(){return this.selectionModeCount},setSelectionModeCount:function(a){this.selectionModeCount=a}}),q=new Class({$el:null,selectors:null,comparators:null,model:null,view:null,controller:null,construct:function(a,b){this.selectors=a,this.comparators=b},initialize:function(a){this.$el=a,this.setModel(new n(a,this.selectors)),this.setView(new o(a,this.selectors)),this.setController(new p(a,this.selectors,this.comparators)),this.model.initialize(),this.view.initialize(),this.controller.initialize()},setModel:function(a){this.model=a},getModel:function(){return this.model},setView:function(a){this.view=a},getView:function(){return this.view},setController:function(a){this.controller=a},getController:function(){return this.controller},isSelected:function(a){var b=this.view.getSelectionState(a);return"selected"===b},setSelected:function(a,b){var c=b?"selected":"unselected";this.view.setSelectionState(a,c)},getSelection:function(a){var b=this.view.getSelectedItems();return a===!0&&(b=this.model.fromItemElements(b)),b},getDisplayMode:function(){return this.controller.getDisplayMode()},isColumnSorted:function(){return this.controller.isColumnSorted()},setDisplayMode:function(a){this.controller.setDisplayMode(a)},isGridSelectionMode:function(){return this.controller.isGridSelect()},setGridSelectionMode:function(a){this.controller.setGridSelect(a)},getSelectionModeCount:function(){return this.controller.getSelectionModeCount()},setSelectionModeCount:function(a){this.controller.setSelectionModeCount(a)},_restore:function(a){this.view.restore(this.model,a),this.model.reference()},removeAllItems:function(){var a=h.getWidget(this.$el);a.clearSelection(),this.model.removeAllItemsSilently(),this.view.removeAllItemsSilently()}});CUI.CardView=new Class({toString:"CardView",extend:CUI.Widget,adapter:null,construct:function(a){var b=h.mixObjects(a.selectorConfig,f),c=a.comparators||null;this.adapter=new q(b,c),this.adapter.initialize(this.$element),this.layout(a.gridSettings)},getModel:function(){return this.adapter.getModel()},setModel:function(a){this.adapter.setModel(a)},isSelected:function(a){return this.adapter.isSelected(a)},getDisplayMode:function(){return this.adapter.getDisplayMode()},isColumnSorted:function(){return this.adapter.isColumnSorted()},setColumnSortable:function(){},isColumnSortable:function(){},setDisplayMode:function(a){this.adapter.setDisplayMode(a)},isGridSelectionMode:function(){return this.adapter.isGridSelectionMode()},setGridSelectionMode:function(a){this.adapter.setGridSelectionMode(a)},toggleGridSelectionMode:function(){this.setGridSelectionMode(!this.isGridSelectionMode())},getSelectionModeCount:function(){return this.adapter.getSelectionModeCount()},setSelectionModeCount:function(a){this.adapter.setSelectionModeCount(a)},select:function(b,c){b=g(b);var e=this.adapter.isSelected(b);e||(this.getSelectionModeCount()===d&&this.getSelection().length>0&&this.clearSelection(),this.adapter.setSelected(b,!0),this.$element.trigger(a.Event("change:selection",{widget:this,item:b,isSelected:!0,moreSelectionChanges:c===!0})))},deselect:function(b,c){b=g(b);var d=this.adapter.isSelected(b);d&&(this.adapter.setSelected(b,!1),this.$element.trigger(a.Event("change:selection",{widget:this,item:b,isSelected:!1,moreSelectionChanges:c})))},toggleSelection:function(b,c){b=g(b);var e=a.Event("beforeselect",{selectionCancelled:!1,stopEvent:!1,item:b,cancelSelection:function(a){this.selectionCancelled=!0,this.stopEvent=a===!0}});if(this.$element.trigger(e),e.selectionCancelled)return e.stopEvent;var f=this.isSelected(b);return!f&&this.getSelectionModeCount()===d&&this.getSelection().length>0&&this.clearSelection(),this.adapter.setSelected(b,!f),this.$element.trigger(a.Event("change:selection",{widget:this,item:b,isSelected:!f,moreSelectionChanges:c})),!0},getSelection:function(a){return this.adapter.getSelection(a===!0)},clearSelection:function(){for(var a=this.getSelection(!0),b=a.length,c=b-1,d=0;b>d;d++)this.deselect(a[d],c>d)},_headerSel:function(b,c,d){var e=this.adapter.getModel();null==b&&(b=e.getHeaders()),a.isArray(b)||(b=[b]);for(var f=b.length,g=0;f>g;g++){var h=b[g];h.jquery&&(h=e.getHeaderForEl(h));for(var i=e.getItemsForHeader(h),j=i.length,k=0;j>k;k++)c.call(this,i[k],!d(k,i))}},selectAll:function(a){if(this.getSelectionModeCount()===e){var b=this;this._headerSel(a,this.select,function(a,c){for(++a;a<c.length;a++)if(!b.isSelected(c[a]))return!1;return!0})}},deselectAll:function(a){var b=this;this._headerSel(a,this.deselect,function(a,c){for(++a;a<c.length;a++)if(b.isSelected(c[a]))return!1;return!0})},getHeaderSelectionState:function(){for(var a=this.getModel(),b=null,c={selected:[],hasUnselected:!1,headers:[]},d=a.getHeaderCount(),e=a.getItemCount(),f=0;e>f;f++){for(var g=a.getItemAt(f),h=0;d>h;h++){var i=a.getHeaderAt(h);if(i.getItemRef()===g){b={header:i,selected:[],hasUnselected:!1},c.headers.push(b);break}}this.isSelected(g)?null!==b?b.selected.push(g):c.selected.push(g):null!==b?b.hasUnselected=!0:c.hasUnselected=!0}return c},layout:function(a){this.getDisplayMode()===b&&(this.$element.data("cuigridlayout")&&this.$element.cuigridlayout("destroy"),this.$element.cuigridlayout(a))},relayout:function(){this.getDisplayMode()===b&&this.$element.cuigridlayout("layout")},_restore:function(a){this.adapter._restore(a)},append:function(a){this.adapter.getModel().insertItemAt(a,null,!1)},prepend:function(a){this.adapter.getModel().insertItemAt(a,0,!1)},removeAllItems:function(){this.adapter.removeAllItems(),this.getDisplayMode()===b&&this.relayout(),this.$element.trigger(a.Event("change:removeAll",{widget:this}))}}),CUI.CardView.DefaultComparator=new Class({construct:function(a,b,c,d){this.selector=a,this.attribute=b,this.ignoreCase=d,this.isNumeric="numeric"==c,this.reverseMultiplier=1},setReverse:function(a){this.reverseMultiplier=a?-1:1},compare:function(a,b){var c=a.getItemEl(),d=b.getItemEl(),e=this.selector?c.find(this.selector):c,f=this.selector?d.find(this.selector):d,g="",h="";return this.attribute?"data-"==this.attribute.substr(0,5)?(g=e.data(this.attribute.substr(5)),h=f.data(this.attribute.substr(5))):(g=e.attr(this.attribute),h=f.attr(this.attribute)):(g=this.ignoreCase?e.text().toLowerCase():e.text(),h=this.ignoreCase?f.text().toLowerCase():f.text()),this.isNumeric&&(g=1*g,h=1*h,isNaN(g)&&(g=0),isNaN(h)&&(h=0)),g>h?1*this.reverseMultiplier:h>g?-1*this.reverseMultiplier:0},getCompareFn:function(){return this.compare.bind(this)}}),CUI.CardView.DISPLAY_GRID=b,CUI.CardView.DISPLAY_LIST=c,CUI.CardView.SELECTION_MODE_COUNT_SINGLE="single",CUI.CardView.SELECTION_MODE_COUNT_MULTI="multiple",CUI.CardView.get=function(a){var b=h.getWidget(a);return b||(b=h.getWidget(a.cardView())),b},CUI.util.plugClass(CUI.CardView),CUI.options.dataAPI&&a(function(){for(var b=a("body").find('[data-toggle="cardview"]'),c=0;c<b.length;c++){var d=a(b[c]);d.data("cardview")||d.cardView()}})}(window.jQuery),function(a){CUI.PathBrowser=new Class({toString:"PathBrowser",extend:CUI.Widget,construct:function(){for(this.options.autocompleteCallback||(this.options.autocompleteCallback=this._defaultAutocompleteCallback.bind(this)),this.options.optionRenderer||(this.options.optionRenderer=CUI.PathBrowser.defaultOptionRenderer),this._render();this.options.optionDisplayStrings.length<this.options.options.length;)this.options.optionDisplayStrings.push(this.options.options[this.options.optionDisplayStrings.length]);this.dropdownList=new CUI.DropdownList({element:this.inputElement,positioningElement:this.inputElement,position:this.options.position,autoPosition:this.options.autoPosition,cssClass:"autocomplete-results"}),this.$element.on("change:disabled",this._update.bind(this)),this.$element.on("change:placeholder",this._update.bind(this)),this.$element.on("change:options",this._changeOptions.bind(this)),this.$element.on("input","input",function(){this.options.disabled||(this.typeTimeout&&clearTimeout(this.typeTimeout),this.typeTimeout=setTimeout(this._inputChanged.bind(this),this.options.delay))}.bind(this)),this.$element.on("blur","input",function(){this.options.disabled||(this.typeTimeout&&clearTimeout(this.typeTimeout),this.typeTimeout=null,this.selectedIndex>=0&&(""===this.inputElement.attr("value")?this.setSelectedIndex(-1):this._update()))}.bind(this)),this.$element.on("keydown","input",this._keyPressed.bind(this)),this.$element.on("keyup","input",this._keyUp.bind(this)),this.dropdownList.on("dropdown-list:select","",function(a){this.dropdownList.hide(200),this.setSelectedIndex(1*a.selectedValue)}.bind(this)),CUI.util.isTouch||(this.$element.on("focus","input",function(){this.options.disabled||this.$element.addClass("focus")}.bind(this)),this.$element.on("blur","input",function(){this.options.disabled||this.$element.removeClass("focus")}.bind(this)),this.$element.on("click touchend","input",function(){this.options.disabled||(this.inputElement.focus(),this._inputChanged())}.bind(this)))},defaults:{autocompleteCallback:null,options:[],optionDisplayStrings:[],optionLoader:null,optionLoaderRoot:null,optionValueReader:null,optionTitleReader:null,showTitles:!0,rootPath:"/content",delay:200,placeholder:null,optionRenderer:null,position:"below",autoPosition:!0},dropdownList:null,syncSelectElement:null,inputElement:null,typeTimeout:null,selectedIndex:-1,triggeredBackspace:!1,setSelectedIndex:function(a){-1>a||a>=this.options.options.length||(this.selectedIndex=a,this._update())
},getSelectedIndex:function(){return this.selectedIndex},_changeOptions:function(a){a.widget===this&&(this.selectedIndex=-1,this._update())},_render:function(){this._readDataFromMarkup();var b;"SELECT"===this.$element.get(0).tagName&&(b=a("<div></div>"),this.$element.after(b),this.$element.detach(),b.append(this.$element),this.$element=b),"INPUT"===this.$element.get(0).tagName&&(b=a("<div></div>"),this.$element.after(b),this.$element.detach(),b.prepend(this.$element),this.$element=b),this.$element.find("select option").length>0&&0===this.options.options.length&&(this.options.options=[],this.options.optionDisplayStrings=[],this.$element.find("select option").each(function(b,c){this.options.options.push(a(c).val()),this.options.optionDisplayStrings.push(a.trim(a(c).text())),a(c).attr("selected")&&(this.selectedIndex=b)}.bind(this))),this._createMissingElements(),this.syncSelectElement=this.$element.find("select"),this.inputElement=this.$element.find("input"),this.$element.addClass("pathbrowser"),this.$element.removeClass("focus"),this.options.placeholder||(this.options.placeholder=this.inputElement.attr("placeholder")),this.options.name&&this.syncSelectElement.attr("name",this.options.name),this._update()},_createMissingElements:function(){0===this.$element.find("select").length&&this.$element.append(a("<select></select>")),0===this.$element.find("input").length&&this.$element.prepend(a("<input/>",{type:"text"}))},_readDataFromMarkup:function(){this.$element.attr("placeholder")&&(this.options.placeholder=this.$element.attr("placeholder")),this.$element.attr("data-placeholder")&&(this.options.placeholder=this.$element.attr("data-placeholder")),(this.$element.attr("disabled")||this.$element.attr("data-disabled"))&&(this.options.disabled=!0),this.$element.attr("data-option-renderer")&&(this.options.optionRenderer=CUI.PathBrowser[this.$element.attr("data-option-renderer")+"OptionRenderer"]),this.$element.attr("data-root-path")&&(this.options.rootPath=this.$element.attr("data-root-path"));var a=CUI.util.buildFunction(this.$element.attr("data-option-loader"),["path","callback"]);a&&(this.options.optionLoader=a.bind(this)),this.$element.attr("data-option-loader-root")&&(this.options.optionLoaderRoot=this.$element.attr("data-option-loader-root"));var b=CUI.util.buildFunction(this.$element.attr("data-option-value-reader"),["object"]);b&&(this.options.optionValueReader=b.bind(this));var c=CUI.util.buildFunction(this.$element.attr("data-option-title-reader"),["object"]);c&&(this.options.optionTitleReader=c.bind(this))},_update:function(){if(this.options.placeholder&&this.inputElement.attr("placeholder",this.options.placeholder),this.options.disabled?(this.$element.addClass("disabled"),this.inputElement.attr("disabled","disabled")):(this.$element.removeClass("disabled"),this.inputElement.removeAttr("disabled")),this.syncSelectElement&&this.syncSelectElement.find("option:selected").removeAttr("selected"),this.selectedIndex>=0){this.syncSelectElement&&a(this.syncSelectElement.find("option").get(this.selectedIndex)).attr("selected","selected");var b=this.options.options[this.selectedIndex];if(b&&0!==b.indexOf("/")){var c="",d=this.inputElement.attr("value").lastIndexOf("/");d>=0&&(c=this.inputElement.attr("value").substring(0,d+1)),b=c+b}this._setInputValue(b,!0)}else this._setInputValue("")},_setInputValue:function(a,b){a&&(this.inputElement.attr("value",a),b&&this.inputElement.is(":focus")&&CUI.util.selectText(this.inputElement,a.length))},_keyUp:function(a){var b=a.keyCode;8===b&&(this.triggeredBackspace=!1)},_keyPressed:function(a){var b=a.keyCode;this.dropdownList.isVisible()||40===b&&(this._inputChanged(),a.preventDefault())},_inputChanged:function(){var a=this,b=this.inputElement.val();b.length>0?this.options.autocompleteCallback(b).done(function(b){a._showAutocompleter(b)}).fail(function(){}):this.dropdownList.hide()},_showAutocompleter:function(a){if(this.dropdownList.hide(),0!==a.length){var b=function(a,b){return this.options.optionRenderer.bind(this)(a,b)};this.dropdownList.set("optionRenderer",b.bind(this)),this.dropdownList.set("options",a),this.dropdownList.show()}},_defaultAutocompleteCallback:function(b){var c=this,d=a.Deferred();if(/^\//.test(b)&&/\/$/.test(b)&&c.options.optionLoader){var e=!1;"/"===b?c.options.rootPath&&(b=c.options.rootPath.replace(/\/$/,""),""!==b?e=!0:b="/"):b=b.replace(/\/$/,""),e&&c._setInputValue(b+"/");var f={loadOptions:c.options.optionLoader},g=a.Deferred();g.promise(f),f.done(function(e){a.isFunction(e.promise)?e.done(function(a){c._rebuildOptions(d,b,a)}):c._rebuildOptions(d,b,e)});var h=f.loadOptions(b,function(a){g.resolve(a)});h&&g.resolve(h)}else d.resolve(c._filterOptions(b));return d.promise()},_rebuildOptions:function(b,c,d){var e=this,f=CUI.util.getNested(d,e.options.optionLoaderRoot);if(f){var g=[],h=[];a.each(f,function(a,b){var c;c=e.options.optionValueReader?e.options.optionValueReader(b):"object"==typeof b?b.path:b,g.push(c);var d="";e.options.optionTitleReader?d=e.options.optionTitleReader(b):"object"==typeof b&&(d=b.title),h.push(d)}.bind(e)),e.options.options=g,e.options.optionDisplayStrings=h;var i=e._filterOptions(c);b.resolve(i)}else b.reject()},_filterOptions:function(){var b=[];return a.each(this.options.options,function(a){b.push(a)}.bind(this)),b}}),CUI.util.plugClass(CUI.PathBrowser),CUI.options.dataAPI&&a(document).on("cui-contentloaded.data-api",function(b){a("[data-init~='pathbrowser']",b.target).pathBrowser()}),CUI.PathBrowser.defaultOptionRenderer=function(b,c){var d=this.options.options[c];if(0===d.indexOf("/")){var e=d.lastIndexOf("/");d=d.substring(e+1)}var f="pathbrowser-autocomplete-item-value",g="";return this.options.showTitles&&this.options.optionDisplayStrings[c]&&this.options.optionDisplayStrings[c].length>0&&(f+=" pathbrowser-autocomplete-item-value-with-title",g+='<div class="pathbrowser-autocomplete-item-title">'+this.options.optionDisplayStrings[c]+"</div>"),a('<div class="'+f+'">'+d+"</div>"+g)}}(window.jQuery),function(a){CUI.Wizard=new Class({toString:"Wizard",extend:CUI.Widget,construct:function(){this.$nav=this.$element.find("nav").first(),this.$back=this.$nav.find("button").first(),this.$next=this.$nav.find("button").last(),this.$pageOverview=this.$nav.find("ol").last(),this.$element.data("hide-steps")===!0&&this.$pageOverview.addClass("hidden"),void 0===this.$back.attr("type")&&this.$back[0].setAttribute("type","button"),void 0===this.$next.attr("type")&&this.$next[0].setAttribute("type","button"),this.$nav.addClass("toolbar"),this.$back.addClass("left"),this.$next.addClass("right"),this.$pageOverview.addClass("center"),this.$nav.find("li").first().append('<div class="lead-fill"></div>'),this.$next.click(this._onNextClick.bind(this)),this.$back.click(this._onBackClick.bind(this)),this._updateDefault(),setTimeout(function(){this.changePage(1)}.bind(this),1)},defaults:{nextDisabled:!1,backDisabled:!1,nextLabel:"next",backLabel:"back",onPageChanged:null,onFinish:null,onLeaving:null,onNextButtonClick:null,onBackButtonClick:null},changePage:function(a){if(!(1>a||a>this.$nav.find("li").length)){this.pageNumber=a;var b=this.pageNumber-1,c=this.getCurrentPage();this.$nav.find("li").removeClass("stepped"),this.$nav.find("li:lt("+b+")").addClass("stepped"),this.$nav.find("li.active").removeClass("active"),this.$nav.find("li:eq("+b+")").addClass("active"),this.$element.find(">section.active").removeClass("active"),this.$element.find(">section:eq("+b+")").addClass("active"),this._updateButtons(),this._fireCallback("onPageChanged"),"object"==typeof this.options.onPageChanged&&this._dataExists(c,"wizardPageCallback")&&"function"==typeof this.options.onPageChanged[c.data("wizardPageCallback")]&&this.options.onPageChanged[c.data("wizardPageCallback")](c)}},getCurrentPageNumber:function(){return this.pageNumber},getCurrentPage:function(){return this.getPage(this.pageNumber)},getPage:function(a){return this.$element.find(">section:eq("+(parseFloat(a)-1)+")")},getPageNav:function(a){return this.$element.find(">nav li:eq("+(parseFloat(a)-1)+")")},setNextButtonLabel:function(a){this.$next.text(a)},setBackButtonLabel:function(a){this.$back.text(a)},setNextButtonDisabled:function(a){this.$next.attr("disabled",a)},setBackButtonDisabled:function(a){this.$back.attr("disabled",a)},activatePage:function(a){this.getPage(a).removeClass("wizard-hidden-step"),this.getPageNav(a).removeClass("wizard-hidden-step")},deactivatePage:function(a){this.getPage(a).addClass("wizard-hidden-step"),this.getPageNav(a).addClass("wizard-hidden-step")},_onNextClick:function(){var a=this._fireCallback("onNextButtonClick");if(a!==!1){var b=this._getNextPageNumber();null!=b?this.changePage(b):this._fireCallback("onFinish")}},_onBackClick:function(){var a=this._fireCallback("onBackButtonClick");if(a!==!1){var b=this._getPreviousPageNumber();null!=b?this.changePage(b):this._fireCallback("onLeaving")}},_getNextPageNumber:function(){var a=this.getCurrentPageNumber();return this._getRelativeNextPageNumber(a)},_getRelativeNextPageNumber:function(b){if(b<this.$nav.find("li").length){var c=b+1,d=this.getPage(c);return a(d).hasClass("wizard-hidden-step")?this._getRelativeNextPageNumber(c):c}return null},_getPreviousPageNumber:function(){var a=this.getCurrentPageNumber();return this._getRelativePreviousPageNumber(a)},_getRelativePreviousPageNumber:function(b){if(b>1){var c=b-1,d=this.getPage(c);return a(d).hasClass("wizard-hidden-step")?this._getRelativePreviousPageNumber(c):c}return null},_updateButtons:function(){var a=this.getCurrentPage();this.setNextButtonLabel(this._dataExists(a,"nextLabel")?a.data("nextLabel"):this.options.nextLabel),this.setBackButtonLabel(this._dataExists(a,"backLabel")?a.data("backLabel"):this.options.backLabel),this.setNextButtonDisabled(this._dataExists(a,"nextDisabled")?a.data("nextDisabled"):this.options.nextDisabled),this.setBackButtonDisabled(this._dataExists(a,"backDisabled")?a.data("backDisabled"):this.options.backDisabled)},_fireCallback:function(a){return"function"==typeof this.options[a]?this.options[a]():void 0},_dataExists:function(a,b){return void 0!==a.data(b)},_updateDefault:function(){this.options.nextDisabled=this.$next.is("[disabled]"),this.options.backDisabled=this.$back.is("[disabled]"),this.options.nextLabel=this.$next.text(),this.options.backLabel=this.$back.text()}}),CUI.util.plugClass(CUI.Wizard),CUI.options.dataAPI&&a(document).on("cui-contentloaded.data-api",function(b){a("[data-init~=wizard]",b.target).wizard()})}(window.jQuery),function(a){function b(a){return a.filter("[data-action=prev], [data-action=cancel]").first().addClass("hidden").clone().addClass("left").each(e)}function c(a){return a.filter("[data-action=next]").first().addClass("hidden").clone().addClass("primary right").each(e)}function d(a){return a.filter("[data-action=cancel]").first().clone().addClass("quiet right").each(e)}function e(b,c){a(c).removeClass("hidden").not("button").toggleClass("button",!0)}function f(e){var f=e.children(".step"),g=e.children(".toolbar");0===g.length&&e.prepend(function(){g=a('<nav class="toolbar"><ol class="center"></ol></nav>');var b=g.children("ol");return f.map(function(){return a("<li />").text(a(this).data("stepTitle")||this.title).get(0)}).appendTo(b),g}),g.toggleClass("theme-dark",!0),g.find("> ol > li").first().addClass("active");var h=f.first().find(".flexwizard-control");g.prepend(function(){return b(h)}).append(function(){return c(h).add(d(h).toggleClass("hidden",!0))})}function g(b,c,d){var e=a("<li />").text(c.data("stepTitle")||c.attr("title")),f=b.children(".step").index(d);b.find("> .toolbar > ol > li").eq(f).after(e),d.after(c)}function h(a){0!==a.length&&(a.addClass("active").removeClass("stepped"),a.prevAll("li").addClass("stepped").removeClass("active"),a.nextAll("li").removeClass("active stepped"))}function i(a,b,c){0!==b.length&&(c&&c.removeClass("active"),b.toggleClass("active",!0),a.trigger("flexwizard-stepchange",[b,c]))}function j(a,d){var e,f,g=a.children("nav"),j=a.children(".step.active"),k=g.children("ol").children("li.active");switch(d){case"prev":e=j.prev(".step"),f=k.prev("li");break;case"next":e=j.next(".step"),f=k.next("li");break;case"cancel":return}if(0!==e.length){var l=e.find(".flexwizard-control");b(l).replaceAll(g.children(".left")),c(l).replaceAll(g.children(".right:not([data-action=cancel])")),g.children(".right[data-action=cancel]").toggleClass("hidden",0===e.prev(".step").length),h(f),i(a,e,j)}}CUI.FlexWizard=new Class({toString:"FlexWizard",extend:CUI.Widget,construct:function(){var b=this.$element;f(b),b.on("click",".flexwizard-control",function(){j(b,a(this).data("action"))}),i(b,b.children(".step").first())},add:function(b,c){var d=this.$element;return void 0===c?(this.addAfter(b,d.children(".step").last()),void 0):(b.jquery||(b=a(b)),b.toggleClass("step",!0),g(d,b,d.children(".step").eq(c)),void 0)},addAfter:function(b,c){var d=this.$element;b.jquery||(b=a(b)),c.jquery||(c=a(c)),b.toggleClass("step",!0),g(d,b,c)}}),CUI.util.plugClass(CUI.FlexWizard),CUI.options.dataAPI&&a(document).on("cui-contentloaded.data-api",function(b){a("[data-init~=flexwizard]",b.target).flexWizard()})}(window.jQuery),function(a){CUI.FileUpload=new Class({toString:"FileUpload",extend:CUI.Widget,construct:function(){this._render(),this.inputElement.on("change",function(a){this.options.disabled||this._onFileSelectionChange(a)}.bind(this))},defaults:{name:"file",placeholder:null,uploadUrl:null,uploadUrlBuilder:null,disabled:!1,multiple:!1,sizeLimit:null,mimeTypes:[],autoStart:!1,fileNameParameter:null,useHTML5:!0,dropZone:null,events:{}},inputElement:null,$spanElement:null,fileNameElement:null,uploadQueue:[],_render:function(){var b=this;if("INPUT"===this.$element.get(0).tagName){var c=this.$element.attr("class"),d=a("<span/>",{"class":c});this.$element.removeAttr("class"),this.$element.after(d),this.$element.detach(),d.prepend(this.$element),this.$element=d}if(this.$spanElement=this.$element.is("span")?this.$element:this.$element.find("span"),this.inputElement=this.$element.find("input[type='file']"),this._readDataFromMarkup(),CUI.util.HTTP.html5UploadSupported()||(this.options.useHTML5=!1),this._createMissingElements(),this.$element.addClass("fileupload"),this.$element.removeClass("focus"),this.inputElement.attr("title")&&this.$element.prepend(a("<label/>",{"for":b.options.name}).html(this.inputElement.attr("title"))),this.options.events&&"object"==typeof this.options.events)for(var e in this.options.events)this._registerEventHandler(e,this.options.events[e]);this.options.dropZone=this.options.useHTML5?this._registerDropZone():null,this.options.placeholder||(this.options.placeholder=this.inputElement.attr("placeholder")),this.options.autoStart&&this._registerEventHandler("fileselected",function(a){a.fileUpload.uploadFile(a.item)}),this.options.uploadUrlBuilder&&(this.options.uploadUrl=this.options.uploadUrlBuilder(this)),(!this.options.uploadUrl||/\$\{.+\}/.test(this.options.uploadUrl))&&(this.options.disabled=!0),this._update()},_registerDropZone:function(){var b=this;if(b.options.dropZone){try{b.options.dropZone=a(b.options.dropZone)}catch(c){delete b.options.dropZone}b.options.dropZone&&b.options.dropZone.on("dragover",function(a){return b._isActive()&&(b.isDragOver=!0,a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),b.$element.trigger({type:"dropzonedragover",originalEvent:a,fileUpload:b})),!1}).on("dragleave",function(a){return b._isActive()&&(a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),b.isDragOver=!1,window.setTimeout(function(){b.isDragOver||b.$element.trigger({type:"dropzonedragleave",originalEvent:a,fileUpload:b})},1)),!1}).on("drop",function(a){if(b._isActive()){a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault();var c=a.originalEvent.dataTransfer.files;b.$element.trigger({type:"dropzonedrop",originalEvent:a,files:c,fileUpload:b}),b._onFileSelectionChange(a,c)}return!1})}},_registerEventHandler:function(a,b){this.$element.on(a,b)},_createMissingElements:function(){var b=this,c=b.options.useHTML5&&b.options.multiple;0===b.inputElement.length?(b.inputElement=a("<input/>",{type:"file",name:b.options.name,multiple:c}),b.$element.prepend(b.inputElement)):b.inputElement.attr("multiple",c)},_readDataFromMarkup:function(){var b=this;this.inputElement.attr("name")&&(this.options.name=this.inputElement.attr("name")),this.inputElement.attr("placeholder")&&(this.options.placeholder=this.inputElement.attr("placeholder")),this.inputElement.data("placeholder")&&(this.options.placeholder=this.inputElement.data("placeholder")),(this.inputElement.attr("disabled")||this.inputElement.data("disabled"))&&(this.options.disabled=!0),(this.inputElement.attr("multiple")||this.inputElement.data("multiple"))&&(this.options.multiple=!0),this.inputElement.data("uploadUrl")&&(this.options.uploadUrl=this.inputElement.data("uploadUrl")),this.inputElement.data("uploadUrlBuilder")&&(this.options.uploadUrlBuilder=CUI.util.buildFunction(this.inputElement.data("uploadUrlBuilder"),["fileUpload"])),this.inputElement.data("mimeTypes")&&(this.options.mimeTypes=this.inputElement.data("mimeTypes")),this.inputElement.data("sizeLimit")&&(this.options.sizeLimit=this.inputElement.data("sizeLimit")),this.inputElement.data("autoStart")&&(this.options.autoStart=!0),this.inputElement.data("usehtml5")&&(this.options.useHTML5=this.inputElement.data("usehtml5")===!0),this.inputElement.data("dropzone")&&(this.options.dropZone=this.inputElement.data("dropzone")),this.inputElement.data("fileNameParameter")&&(this.options.fileNameParameter=this.inputElement.data("fileNameParameter")),a.each(this.inputElement.get(0).attributes,function(a,c){var d=/^data-event-(.*)$/.exec(c.name);if(d&&d.length>1){var e=CUI.util.buildFunction(c.value,["event"]);e&&(b.options.events[d[1]]=e.bind(b))}})},_update:function(){this.options.placeholder&&this.inputElement.attr("placeholder",this.options.placeholder),this.options.disabled?(this.$element.addClass("disabled"),this.inputElement.attr("disabled","disabled")):(this.$element.removeClass("disabled"),this.inputElement.removeAttr("disabled"))},_onFileSelectionChange:function(a,b){var c=0,d=0;if(this.options.useHTML5){b=b||a.target.files;for(var e=0;e<b.length;e++)this._addFile(b[e])?c++:d++}else this._addFile(a.target)?c++:d++;this.$element.trigger({type:"filelistprocessed",addedCount:c,rejectedCount:d,fileUpload:this})},_addFile:function(b){var c,d,e=this;if(this.options.useHTML5?(c=b.name,d=b.type):(c=a(b).attr("value")||b.value,d=CUI.FileUpload.MimeTypes.getMimeTypeFromFileName(c)),-1!==c.lastIndexOf("\\")&&(c=c.substring(c.lastIndexOf("\\")+1)),e.options.fileNameParameter&&!this.options.autoStart&&(e.fileNameElement||(e.fileNameElement=a('input[name="'+e.options.fileNameParameter+'"]'),0===e.fileNameElement.length&&(e.fileNameElement=a("<input/>",{type:"hidden",name:e.options.fileNameParameter}),e.fileNameElement.appendTo(e.$element))),e.fileNameElement.val(c)),!e._getQueueItemByFileName(c)){var f={fileName:c};return this.options.useHTML5&&(f.file=b,f.fileSize=b.size,e.options.sizeLimit&&b.size>e.options.sizeLimit)?(e.$element.trigger({type:"filerejected",item:f,message:"File is too big",fileUpload:e}),!1):e._checkMimeTypes(d)?(e.uploadQueue.push(f),e.$element.trigger({type:"queuechanged",item:f,operation:"ADD",queueLength:e.uploadQueue.length,fileUpload:e}),e.$element.trigger({type:"fileselected",item:f,fileUpload:e}),!0):(e.$element.trigger({type:"filerejected",item:f,message:"File mime type is not allowed",fileUpload:e}),!1)}return!1},_checkMimeTypes:function(a){function b(a,b){var c=/(.+)\/(.+)$/,d=/\.(.+)$/,e=/.*/,f=!1;return"*"===b||".*"===b||"*/*"===b?f=!0:a&&a.match(c)?b.match(c)?f=a===b:b.match(d)?f=a===CUI.FileUpload.MimeTypes[b]:b.match(e)&&(f=a.split("/")[0]===b):f=!1,f}var c,d=this.options.mimeTypes.length;if(0===d)return!0;for(c=0;d>c;c+=1)if(b(a,this.options.mimeTypes[c]))return!0;return!1},_getQueueIndex:function(b){var c=-1;return a.each(this.uploadQueue,function(a,d){return d.fileName===b?(c=a,!1):void 0}),c},_getQueueItem:function(a){return a>-1?this.uploadQueue[a]:null},_getQueueItemByFileName:function(a){return this._getQueueItem(this._getQueueIndex(a))},uploadFile:function(b){var c=this;if(c.options.useHTML5){b.xhr=new XMLHttpRequest,b.xhr.addEventListener("loadstart",function(a){c._onUploadStart(a,b)},!1),b.xhr.addEventListener("load",function(a){c._onUploadLoad(a,b)},!1),b.xhr.addEventListener("error",function(a){c._onUploadError(a,b)},!1),b.xhr.addEventListener("abort",function(a){c._onUploadCanceled(a,b)},!1);var d=b.xhr.upload;d.addEventListener("progress",function(a){c._onUploadProgress(a,b)},!1);var e=b.file,f=b.fileName;if(window.FormData){var g=new FormData;c.options.fileNameParameter?(g.append(c.inputElement.attr("name"),e),g.append(c.options.fileNameParameter||"fileName",f)):g.append(f,e),g.append("_charset_","utf-8"),b.xhr.open("POST",c.options.uploadUrl+"?:ck="+(new Date).getTime(),!0),b.xhr.send(g)}else b.xhr.open("PUT",c.options.uploadUrl+"/"+f,!0),b.xhr.send(e)}else{var h=a(document.body),i="upload-"+(new Date).getTime(),j=a("<iframe/>",{name:i});j.addClass("fileupload").appendTo(h);var k=a("<form/>",{method:"post",enctype:"multipart/form-data",action:c.options.uploadUrl,target:i});k.addClass("fileupload").appendTo(h);var l=a("<input/>",{type:"hidden",name:"_charset_",value:"utf-8"});k.prepend(l),this.options.fileNameParameter&&(this.fileNameElement=a("<input/>",{type:"hidden",name:this.options.fileNameParameter,value:b.fileName}),k.prepend(this.fileNameElement)),j.one("load",function(){var a=this.contentWindow.document.body.innerHTML;c.inputElement.prependTo(c.$spanElement),k.remove(),j.remove(),c.$element.trigger({type:"fileuploadload",item:b,content:a,fileUpload:c})}),c.inputElement.prependTo(k),k.submit()}},cancelUpload:function(a){a.xhr.abort()},_onUploadStart:function(a,b){this.$element.trigger({type:"fileuploadstart",item:b,originalEvent:a,fileUpload:this})},_onUploadProgress:function(a,b){this.$element.trigger({type:"fileuploadprogress",item:b,originalEvent:a,fileUpload:this})},_onUploadLoad:function(a,b){var c=a.target;4===c.readyState&&this._internalOnUploadLoad(a,b,c.status,c.responseText)},_internalOnUploadLoad:function(a,b,c,d){CUI.util.HTTP.isOkStatus(c)?this.$element.trigger({type:"fileuploadsuccess",item:b,originalEvent:a,fileUpload:this}):this.$element.trigger({type:"fileuploaderror",item:b,originalEvent:a,message:d,fileUpload:this}),this.fileNameElement&&this.fileNameElement.remove(),this.uploadQueue.splice(this._getQueueIndex(b.fileName),1),this.$element.trigger({type:"queuechanged",item:b,operation:"REMOVE",queueLength:this.uploadQueue.length,fileUpload:this})},_onUploadError:function(a,b){this.$element.trigger({type:"fileuploaderror",item:b,originalEvent:a,fileUpload:this})},_onUploadCanceled:function(a,b){this.$element.trigger({type:"fileuploadcanceled",item:b,originalEvent:a,fileUpload:this})},_isActive:function(){return!this.inputElement.is(":disabled")}}),CUI.util.plugClass(CUI.FileUpload),CUI.options.dataAPI&&a(document).on("cui-contentloaded.data-api",function(b){a("[data-init~='fileupload']",b.target).fileUpload()})}(window.jQuery),function(){CUI.FileUpload.MimeTypes={".3dm":"x-world/x-3dmf",".3dmf":"x-world/x-3dmf",".a":"application/octet-stream",".aab":"application/x-authorware-bin",".aam":"application/x-authorware-map",".aas":"application/x-authorware-seg",".abc":"text/vnd.abc",".acgi":"text/html",".afl":"video/animaflex",".ai":"application/postscript",".aif":"audio/x-aiff",".aifc":"audio/x-aiff",".aiff":"audio/x-aiff",".aim":"application/x-aim",".aip":"text/x-audiosoft-intra",".ani":"application/x-navi-animation",".aos":"application/x-nokia-9000-communicator-add-on-software",".aps":"application/mime",".arc":"application/octet-stream",".arj":"application/octet-stream",".art":"image/x-jg",".asf":"video/x-ms-asf",".asm":"text/x-asm",".asp":"text/asp",".asx":"video/x-ms-asf-plugin",".au":"audio/x-au",".avi":"video/x-msvideo",".avs":"video/avs-video",".bcpio":"application/x-bcpio",".bin":"application/x-macbinary",".bm":"image/bmp",".bmp":"image/x-windows-bmp",".boo":"application/book",".book":"application/book",".boz":"application/x-bzip2",".bsh":"application/x-bsh",".bz":"application/x-bzip",".bz2":"application/x-bzip2",".c":"text/x-c",".c++":"text/plain",".cat":"application/vnd.ms-pki.seccat",".cc":"text/x-c",".ccad":"application/clariscad",".cco":"application/x-cocoa",".cdf":"application/x-netcdf",".cer":"application/x-x509-ca-cert",".cha":"application/x-chat",".chat":"application/x-chat",".class":"application/x-java-class",".com":"text/plain",".conf":"text/plain",".cpio":"application/x-cpio",".cpp":"text/x-c",".cpt":"application/x-cpt",".crl":"application/pkix-crl",".crt":"application/x-x509-user-cert",".csh":"text/x-script.csh",".css":"text/css",".cxx":"text/plain",".dcr":"application/x-director",".deepv":"application/x-deepv",".def":"text/plain",".der":"application/x-x509-ca-cert",".dif":"video/x-dv",".dir":"application/x-director",".dl":"video/x-dl",".doc":"application/msword",".dot":"application/msword",".dp":"application/commonground",".drw":"application/drafting",".dump":"application/octet-stream",".dv":"video/x-dv",".dvi":"application/x-dvi",".dwf":"model/vnd.dwf",".dwg":"image/x-dwg",".dxf":"image/x-dwg",".dxr":"application/x-director",".el":"text/x-script.elisp",".elc":"application/x-elc",".env":"application/x-envoy",".eps":"application/postscript",".es":"application/x-esrehber",".etx":"text/x-setext",".evy":"application/x-envoy",".exe":"application/octet-stream",".f":"text/x-fortran",".f77":"text/x-fortran",".f90":"text/x-fortran",".fdf":"application/vnd.fdf",".fif":"image/fif",".fli":"video/x-fli",".flo":"image/florian",".flx":"text/vnd.fmi.flexstor",".fmf":"video/x-atomic3d-feature",".for":"text/x-fortran",".fpx":"image/vnd.net-fpx",".frl":"application/freeloader",".funk":"audio/make",".g":"text/plain",".g3":"image/g3fax",".gif":"image/gif",".gl":"video/x-gl",".gsd":"audio/x-gsm",".gsm":"audio/x-gsm",".gsp":"application/x-gsp",".gss":"application/x-gss",".gtar":"application/x-gtar",".gz":"application/x-gzip",".gzip":"multipart/x-gzip",".h":"text/x-h",".hdf":"application/x-hdf",".help":"application/x-helpfile",".hgl":"application/vnd.hp-hpgl",".hh":"text/x-h",".hlb":"text/x-script",".hlp":"application/x-winhelp",".hpg":"application/vnd.hp-hpgl",".hpgl":"application/vnd.hp-hpgl",".hqx":"application/x-mac-binhex40",".hta":"application/hta",".htc":"text/x-component",".htm":"text/html",".html":"text/html",".htmls":"text/html",".htt":"text/webviewhtml",".htx":"text/html",".ice":"x-conference/x-cooltalk",".ico":"image/x-icon",".idc":"text/plain",".ief":"image/ief",".iefs":"image/ief",".iges":"model/iges",".igs":"model/iges",".ima":"application/x-ima",".imap":"application/x-httpd-imap",".inf":"application/inf",".ins":"application/x-internett-signup",".ip":"application/x-ip2",".isu":"video/x-isvideo",".it":"audio/it",".iv":"application/x-inventor",".ivr":"i-world/i-vrml",".ivy":"application/x-livescreen",".jam":"audio/x-jam",".jav":"text/x-java-source",".java":"text/x-java-source",".jcm":"application/x-java-commerce",".jfif":"image/pjpeg",".jfif-tbnl":"image/jpeg",".jpe":"image/pjpeg",".jpeg":"image/pjpeg",".jpg":"image/pjpeg",".jps":"image/x-jps",".js":"application/x-javascript",".jut":"image/jutvision",".kar":"music/x-karaoke",".ksh":"text/x-script.ksh",".la":"audio/x-nspaudio",".lam":"audio/x-liveaudio",".latex":"application/x-latex",".lha":"application/x-lha",".lhx":"application/octet-stream",".list":"text/plain",".lma":"audio/x-nspaudio",".log":"text/plain",".lsp":"text/x-script.lisp",".lst":"text/plain",".lsx":"text/x-la-asf",".ltx":"application/x-latex",".lzh":"application/x-lzh",".lzx":"application/x-lzx",".m":"text/x-m",".m1v":"video/mpeg",".m2a":"audio/mpeg",".m2v":"video/mpeg",".m3u":"audio/x-mpequrl",".man":"application/x-troff-man",".map":"application/x-navimap",".mar":"text/plain",".mbd":"application/mbedlet",".mc$":"application/x-magic-cap-package-1.0",".mcd":"application/x-mathcad",".mcf":"text/mcf",".mcp":"application/netmc",".me":"application/x-troff-me",".mht":"message/rfc822",".mhtml":"message/rfc822",".mid":"x-music/x-midi",".midi":"x-music/x-midi",".mif":"application/x-mif",".mime":"www/mime",".mjf":"audio/x-vnd.audioexplosion.mjuicemediafile",".mjpg":"video/x-motion-jpeg",".mm":"application/x-meme",".mme":"application/base64",".mod":"audio/x-mod",".moov":"video/quicktime",".mov":"video/quicktime",".movie":"video/x-sgi-movie",".mp2":"video/x-mpeq2a",".mp3":"video/x-mpeg",".mpa":"video/mpeg",".mpc":"application/x-project",".mpe":"video/mpeg",".mpeg":"video/mpeg",".mpg":"video/mpeg",".mpga":"audio/mpeg",".mpp":"application/vnd.ms-project",".mpt":"application/x-project",".mpv":"application/x-project",".mpx":"application/x-project",".mrc":"application/marc",".ms":"application/x-troff-ms",".mv":"video/x-sgi-movie",".my":"audio/make",".mzz":"application/x-vnd.audioexplosion.mzz",".nap":"image/naplps",".naplps":"image/naplps",".nc":"application/x-netcdf",".ncm":"application/vnd.nokia.configuration-message",".nif":"image/x-niff",".niff":"image/x-niff",".nix":"application/x-mix-transfer",".nsc":"application/x-conference",".nvd":"application/x-navidoc",".o":"application/octet-stream",".oda":"application/oda",".omc":"application/x-omc",".omcd":"application/x-omcdatamaker",".omcr":"application/x-omcregerator",".p":"text/x-pascal",".p10":"application/x-pkcs10",".p12":"application/x-pkcs12",".p7a":"application/x-pkcs7-signature",".p7c":"application/x-pkcs7-mime",".p7m":"application/x-pkcs7-mime",".p7r":"application/x-pkcs7-certreqresp",".p7s":"application/pkcs7-signature",".part":"application/pro_eng",".pas":"text/pascal",".pbm":"image/x-portable-bitmap",".pcl":"application/x-pcl",".pct":"image/x-pict",".pcx":"image/x-pcx",".pdb":"chemical/x-pdb",".pdf":"application/pdf",".pfunk":"audio/make.my.funk",".pgm":"image/x-portable-greymap",".pic":"image/pict",".pict":"image/pict",".pkg":"application/x-newton-compatible-pkg",".pko":"application/vnd.ms-pki.pko",".pl":"text/x-script.perl",".plx":"application/x-pixclscript",".pm":"text/x-script.perl-module",".pm4":"application/x-pagemaker",".pm5":"application/x-pagemaker",".png":"image/png",".pnm":"image/x-portable-anymap",".pot":"application/vnd.ms-powerpoint",".pov":"model/x-pov",".ppa":"application/vnd.ms-powerpoint",".ppm":"image/x-portable-pixmap",".pps":"application/vnd.ms-powerpoint",".ppt":"application/x-mspowerpoint",".ppz":"application/mspowerpoint",".pre":"application/x-freelance",".prt":"application/pro_eng",".ps":"application/postscript",".psd":"application/octet-stream",".pvu":"paleovu/x-pv",".pwz":"application/vnd.ms-powerpoint",".py":"text/x-script.phyton",".pyc":"applicaiton/x-bytecode.python",".qcp":"audio/vnd.qcelp",".qd3":"x-world/x-3dmf",".qd3d":"x-world/x-3dmf",".qif":"image/x-quicktime",".qt":"video/quicktime",".qtc":"video/x-qtc",".qti":"image/x-quicktime",".qtif":"image/x-quicktime",".ra":"audio/x-realaudio",".ram":"audio/x-pn-realaudio",".ras":"image/x-cmu-raster",".rast":"image/cmu-raster",".rexx":"text/x-script.rexx",".rf":"image/vnd.rn-realflash",".rgb":"image/x-rgb",".rm":"audio/x-pn-realaudio",".rmi":"audio/mid",".rmm":"audio/x-pn-realaudio",".rmp":"audio/x-pn-realaudio-plugin",".rng":"application/vnd.nokia.ringing-tone",".rnx":"application/vnd.rn-realplayer",".roff":"application/x-troff",".rp":"image/vnd.rn-realpix",".rpm":"audio/x-pn-realaudio-plugin",".rt":"text/vnd.rn-realtext",".rtf":"text/richtext",".rtx":"text/richtext",".rv":"video/vnd.rn-realvideo",".s":"text/x-asm",".s3m":"audio/s3m",".saveme":"application/octet-stream",".sbk":"application/x-tbook",".scm":"video/x-scm",".sdml":"text/plain",".sdp":"application/x-sdp",".sdr":"application/sounder",".sea":"application/x-sea",".set":"application/set",".sgm":"text/x-sgml",".sgml":"text/x-sgml",".sh":"text/x-script.sh",".shar":"application/x-shar",".shtml":"text/x-server-parsed-html",".sid":"audio/x-psid",".sit":"application/x-stuffit",".skd":"application/x-koan",".skm":"application/x-koan",".skp":"application/x-koan",".skt":"application/x-koan",".sl":"application/x-seelogo",".smi":"application/smil",".smil":"application/smil",".snd":"audio/x-adpcm",".sol":"application/solids",".spc":"text/x-speech",".spl":"application/futuresplash",".spr":"application/x-sprite",".sprite":"application/x-sprite",".src":"application/x-wais-source",".ssi":"text/x-server-parsed-html",".ssm":"application/streamingmedia",".sst":"application/vnd.ms-pki.certstore",".step":"application/step",".stl":"application/x-navistyle",".stp":"application/step",".sv4cpio":"application/x-sv4cpio",".sv4crc":"application/x-sv4crc",".svf":"image/x-dwg",".svr":"x-world/x-svr",".swf":"application/x-shockwave-flash",".t":"application/x-troff",".talk":"text/x-speech",".tar":"application/x-tar",".tbk":"application/x-tbook",".tcl":"text/x-script.tcl",".tcsh":"text/x-script.tcsh",".tex":"application/x-tex",".texi":"application/x-texinfo",".texinfo":"application/x-texinfo",".text":"text/plain",".tgz":"application/x-compressed",".tif":"image/x-tiff",".tiff":"image/x-tiff",".tr":"application/x-troff",".tsi":"audio/tsp-audio",".tsp":"audio/tsplayer",".tsv":"text/tab-separated-values",".turbot":"image/florian",".txt":"text/plain",".uil":"text/x-uil",".uni":"text/uri-list",".unis":"text/uri-list",".unv":"application/i-deas",".uri":"text/uri-list",".uris":"text/uri-list",".ustar":"multipart/x-ustar",".uu":"text/x-uuencode",".uue":"text/x-uuencode",".vcd":"application/x-cdlink",".vcs":"text/x-vcalendar",".vda":"application/vda",".vdo":"video/vdo",".vew":"application/groupwise",".viv":"video/vnd.vivo",".vivo":"video/vnd.vivo",".vmd":"application/vocaltec-media-desc",".vmf":"application/vocaltec-media-file",".voc":"audio/x-voc",".vos":"video/vosaic",".vox":"audio/voxware",".vqe":"audio/x-twinvq-plugin",".vqf":"audio/x-twinvq",".vql":"audio/x-twinvq-plugin",".vrml":"x-world/x-vrml",".vrt":"x-world/x-vrt",".vsd":"application/x-visio",".vst":"application/x-visio",".vsw":"application/x-visio",".w60":"application/wordperfect6.0",".w61":"application/wordperfect6.1",".w6w":"application/msword",".wav":"audio/x-wav",".wb1":"application/x-qpro",".wbmp":"image/vnd.wap.wbmp",".web":"application/vnd.xara",".wiz":"application/msword",".wk1":"application/x-123",".wmf":"windows/metafile",".wml":"text/vnd.wap.wml",".wmlc":"application/vnd.wap.wmlc",".wmls":"text/vnd.wap.wmlscript",".wmlsc":"application/vnd.wap.wmlscriptc",".word":"application/msword",".wp":"application/wordperfect",".wp5":"application/wordperfect6.0",".wp6":"application/wordperfect",".wpd":"application/x-wpwin",".wq1":"application/x-lotus",".wri":"application/x-wri",".wrl":"x-world/x-vrml",".wrz":"x-world/x-vrml",".wsc":"text/scriplet",".wsrc":"application/x-wais-source",".wtk":"application/x-wintalk",".xbm":"image/xbm",".xdr":"video/x-amt-demorun",".xgz":"xgl/drawing",".xif":"image/vnd.xiff",".xl":"application/excel",".xla":"application/x-msexcel",".xlb":"application/x-excel",".xlc":"application/x-excel",".xld":"application/x-excel",".xlk":"application/x-excel",".xll":"application/x-excel",".xlm":"application/x-excel",".xls":"application/x-msexcel",".xlt":"application/x-excel",".xlv":"application/x-excel",".xlw":"application/x-msexcel",".xm":"audio/xm",".xml":"text/xml",".xmz":"xgl/movie",".xpix":"application/x-vnd.ls-xpix",".xpm":"image/xpm",".x-png":"image/png",".xsr":"video/x-amt-showrun",".xwd":"image/x-xwindowdump",".xyz":"chemical/x-pdb",".z":"application/x-compressed",".zip":"multipart/x-zip",".zoo":"application/octet-stream",".zsh":"text/x-script.zsh"},CUI.FileUpload.MimeTypes.getMimeTypeFromFileName=function(a){var b=a.match(/.+(\..+)/);
return b?CUI.FileUpload.MimeTypes[b[1]]:void 0}}(window.jQuery),function(a){CUI.Toolbar=new Class({toString:"Toolbar",extend:CUI.Widget,construct:function(){var a=this.$element,b=a.closest(".content-header"),c=a.find(".left"),d=0!==a.find(".center").length,e=c.width();a.reflow({"break-lines":function(a,b){return d&&a.width()-2*e<16*b.rem()},"long-title":function(a,b){return d&&a.width()-2*e>40*b.rem()}},{applyClassToElement:b})}}),CUI.util.plugClass(CUI.Toolbar),CUI.options.dataAPI&&a(document).on("cui-contentloaded.data-api",function(b){a("[data-init~=toolbar]",b.target).toolbar()})}(window.jQuery),function(a){CUI.Tooltip=new Class({toString:"Tooltip",extend:CUI.Widget,construct:function(){if(this.options.target&&(this.options.target=a(this.options.target)),0===this.$element.length&&this.options.target&&(this.$element=a("<div>"),this.$element.insertAfter(this.options.target)),this.$element.addClass("tooltip"),this.$element.data("interactive")&&(this.options.interactive=!0,this.options.target||(this.options.target=this.$element.parent())),this.$element.data("target")&&(this.options.target=a(this.$element.data("target"))),this.options.arrow||(this.options.arrow="left",this.$element.hasClass("arrow-left")&&(this.options.arrow="left"),this.$element.hasClass("arrow-right")&&(this.options.arrow="right"),this.$element.hasClass("arrow-top")&&(this.options.arrow="top"),this.$element.hasClass("arrow-bottom")&&(this.options.arrow="bottom")),this.options.interactive&&(this.options.visible=!1),this.$element.toggleClass("hidden",!this.options.visible),this.$element.on("change:content",this._setContent.bind(this)),this.$element.on("change:type",this._setType.bind(this)),this.$element.on("change:arrow",this._setArrow.bind(this)),this.applyOptions(),this.reposition(),this.options.target&&this.options.target.data("tooltip",this),this.options.interactive&&this.options.target){var b=null;a(this.options.target).finger("touchstart.cui-tooltip",function(){b&&clearTimeout(b),this.show(),b=setTimeout(function(){this.hide()}.bind(this),3e3)}.bind(this));var c=!1;a(this.options.target).pointer("mouseover.cui-tooltip",function(){c&&clearTimeout(c),c=setTimeout(function(){this.show()}.bind(this),this.options.delay)}.bind(this)),a(this.options.target).pointer("mouseout.cui-tooltip",function(){c&&clearTimeout(c),this.hide()}.bind(this))}},defaults:{target:null,visible:!0,type:"default",interactive:!1,arrow:null,delay:500,distance:5},_types:["info","error","notice","success","inspect"],_arrows:["arrow-left","arrow-right","arrow-top","arrow-bottom"],applyOptions:function(){this._setContent(),this._setType(),this._setArrow()},_setType:function(){"string"==typeof this.options.type&&-1!==this._types.indexOf(this.options.type)&&(this.$element.removeClass(this._types.join(" ")),this.$element.addClass(this.options.type),this.reposition())},_setArrow:function(){"string"==typeof this.options.arrow&&-1!==this._arrows.indexOf("arrow-"+this.options.arrow)&&(this.$element.removeClass(this._arrows.join(" ")),this.$element.addClass("arrow-"+this.options.arrow),this.reposition())},_setContent:function(){"string"==typeof this.options.content&&(this.$element.html(this.options.content),this.reposition())},_show:function(){this.$element.hasClass("hidden")&&(this.$element.removeClass("hidden"),this.$element.css("display","none")),this.$element.fadeIn()},_hide:function(){return this.$element.fadeOut(400,function(){this.options.autoDestroy&&(this.$element.remove(),a(this.options.target).off(".cui-tooltip"),a(this.options.target).data("tooltip",null))}.bind(this)),this},reposition:function(b){if(this.options.target){b||setTimeout(function(){this.reposition(!0)}.bind(this),50),this.$element.detach().insertAfter(this.options.target),this.$element.css("position","absolute");var c=a(this.options.target),d=c.outerWidth(!0),e=c.outerHeight(!0),f=c.position().left,g=c.position().top+c.offsetParent().scrollTop(),h=this.$element.outerWidth(!0),i=this.$element.outerHeight(!0),j=0,k=0;return"left"===this.options.arrow&&(j=f+d+this.options.distance,k=g+(e-i)/2),"right"===this.options.arrow&&(j=f-h-this.options.distance,k=g+(e-i)/2),"bottom"===this.options.arrow&&(j=f+(d-h)/2,k=g-i-this.options.distance),"top"===this.options.arrow&&(j=f+(d-h)/2,k=g+e+this.options.distance),this.$element.css("left",j),this.$element.css("top",k),this}}}),CUI.util.plugClass(CUI.Tooltip),CUI.options.dataAPI&&(a(document).on("cui-contentloaded.data-api",function(b){a("[data-init~=tooltip]",b.target).tooltip()}),a(document).fipo("touchstart","mouseover","[data-init~=quicktip]",function(b){var c=a(this),d=c.data("tooltip");d||(new CUI.Tooltip({target:c,content:c.data("quicktip-content")||c.html(),type:c.data("quicktip-type"),arrow:c.data("quicktip-arrow"),interactive:!0,autoDestroy:!0}),c.trigger(b))}))}(window.jQuery),function(a){"use strict";function b(a){for(;;){var b=a.parent();if(0===b.length)return b;if(b.is("body"))return b;var c=b.css("overflow");if("hidden"===c||"auto"===c||"scroll"===c)return b;a=b}}function c(a){var b={};if(a.originalEvent){var c=a.originalEvent;c.changedTouches&&c.changedTouches.length>0&&(b=c.changedTouches[0]),c.touches&&c.touches.length>0&&(b=c.touches[0])}return{x:b.pageX||a.pageX,y:b.pageY||a.pageY}}function d(a,b,c){var d=c.offset();return a>=d.left&&a<d.left+c.outerWidth()&&b>=d.top&&b<d.top+c.outerHeight()}var e=".cui-dragaction";CUI.DragAction=new Class({construct:function(a,c,d,e,f){this.sourceElement=c,this.dragElement=d,this.container=b(d),this.containerHeight=this.container.get(0).scrollHeight,this.dropZones=e,this.axis=f,this.scrollZone=20,this.dragStart(a)},currentDragOver:null,dragStart:function(b){b.preventDefault();var d=this.dragElement.position(),f=c(b);this.dragElement.css({left:d.left,top:d.top,width:this.dragElement.width()+"px"}).addClass("dragging"),this.dragStart={x:f.x-d.left,y:f.y-d.top},a(document).fipo("touchmove"+e,"mousemove"+e,this.drag.bind(this)),a(document).fipo("touchend"+e,"mouseup"+e,this.dragEnd.bind(this)),this.sourceElement.trigger(this._createEvent("dragstart",b)),this.drag(b)},drag:function(a){a.preventDefault();var b=c(a);if(this.container.is("body"))b.y-this.container.scrollTop()<this.scrollZone&&this.container.scrollTop(b.y-this.scrollZone),b.y-this.container.scrollTop()>this.container.height()-this.scrollZone&&this.container.scrollTop(b.y-this.container.height()-this.scrollZone);else{var d=this.container.scrollTop(),e=this.container.offset().top+this.scrollZone;b.y<e&&this.container.scrollTop(this.container.scrollTop()-(e-b.y));var f=this.container.offset().top+this.container.height()-this.scrollZone;if(b.y>f){var g=Math.min(this.container.scrollTop()+(b.y-f),Math.max(this.containerHeight-this.container.height(),0));this.container.scrollTop(g)}var h=this.container.scrollTop();this.dragStart.y+=d-h}var i={};"horizontal"!==this.axis&&(i.top=b.y-this.dragStart.y),"vertical"!==this.axis&&(i.left=b.x-this.dragStart.x),this.dragElement.css(i),this.triggerDrag(a)},dragEnd:function(b){b.preventDefault(),this.dragElement.removeClass("dragging"),this.dragElement.css({top:"",left:"",width:""}),a(document).off(e),this.triggerDrop(b),this.currentDragOver&&a(this.currentDragOver).trigger(this._createEvent("dragleave",b)),this.sourceElement.trigger(this._createEvent("dragend",b))},triggerDrag:function(b){var c=this._getCurrentDropZone(b);return c===this.currentDragOver?(this.currentDragOver&&a(this.currentDragOver).trigger(this._createEvent("dragover",b)),void 0):(this.currentDragOver&&a(this.currentDragOver).trigger(this._createEvent("dragleave",b)),this.currentDragOver=c,this.currentDragOver&&a(this.currentDragOver).trigger(this._createEvent("dragenter",b)),void 0)},triggerDrop:function(a){var b=this._getCurrentDropZone(a);b&&b.trigger(this._createEvent("drop",a))},_getCurrentDropZone:function(b){var e=c(b),f=null;return a.each(this.dropZones,function(a,b){return d(e.x,e.y,b)?(f=b,!1):void 0}),f},_createEvent:function(a,b){var d=c(b),e=jQuery.Event(a);return e.pageX=d.x,e.pageY=d.y,e.sourceElement=this.sourceElement,e.item=this.dragElement,e}})}(jQuery),function(a){function b(a){return{l:a.offset().left,t:a.offset().top,w:a.outerWidth(),h:a.outerHeight()}}function c(a){var b={};if(a.originalEvent){var c=a.originalEvent;c.changedTouches&&c.changedTouches.length>0&&(b=a.originalEvent.changedTouches[0]),c.touches&&c.touches.length>0&&(b=a.originalEvent.touches[0])}var d=b.pageX||a.pageX,e=b.pageY||a.pageY;return{x:d,y:e}}var d="dropzone",e=[];CUI.DraggableList=new Class({toString:"DraggableList",extend:CUI.Widget,construct:function(){if(this.$element.addClass("draggable"),this.$element.data("allow")){var a=this.$element.data("allow").split(" ");jQuery.inArray("reorder",a)>=0&&(this.options.allowReorder=!0),jQuery.inArray("drag",a)>=0&&(this.options.allowDrag=!0),jQuery.inArray("drop",a)>=0&&(this.options.allowDrop=!0)}this.$element.data("closeable")&&(this.options.closeable=!0),this.$element.on("click",".close",this.close.bind(this)),this.$element.fipo("taphold","mousedown","li",this.dragStart.bind(this)),this.dropZone=this.$element.parent().is("."+d)?this.$element.parent():this.$element,this.$element.on("dragend",this.dragEnd.bind(this)),(this.options.allowDrop||this.options.allowReorder)&&(this.dropZone.on("dragenter",this.dragEnter.bind(this)),this.dropZone.on("dragover",this.dragOver.bind(this)),this.dropZone.on("dragleave",this.dragLeave.bind(this)),this.dropZone.on("drop",this.drop.bind(this))),this.options.allowDrop&&e.push(this.dropZone),this.$element.on("dragstart",function(a){a.preventDefault()})},defaults:{allowReorder:!1,allowDrag:!1,allowDrop:!1,closeable:!1},dropZone:null,dragStart:function(b){if(!a(b.target).hasClass("close")){b.preventDefault();var c=a(b.target).closest("li");c.prevAll().addClass("drag-before"),c.nextAll().addClass("drag-after"),this.$element.css({height:this.$element.height()+a(b.item).height()+"px"}),this.options.allowDrag?new CUI.DragAction(b,this.$element,c,e):new CUI.DragAction(b,this.$element,c,[this.dropZone],"vertical")}},dragEnd:function(){this.$element.css({height:""})},dragEnter:function(a){this.dropZone.addClass("drag-over"),this.options.allowReorder&&this.reorderPreview(a)},dragOver:function(a){this.options.allowReorder&&this.reorderPreview(a)},dragLeave:function(){this.dropZone.removeClass("drag-over"),this.$element.children().removeClass("drag-before drag-after")},drop:function(b){if(this.$element.css({height:""}),this.$element.is(b.sourceElement)&&this.options.allowReorder&&this.reorder(b,!1),!this.$element.is(b.sourceElement)&&this.options.allowDrop){var c=a(b.item);this.options.closeable&&0===c.find(".close").length?c.append('<button class="close">&times;</button>'):this.options.closeable||c.find(".close").remove(),this.options.allowReorder?this.reorder(b,c):this.$element.append(c)}this.$element.children().removeClass("drag-before drag-after")},reorderPreview:function(d){var e=c(d),f=e.x,g=e.y,h=b(this.$element);f<h.l||g<h.t||f>h.l+h.w||g>h.t+h.h?this.$element.children().removeClass("drag-after drag-before"):this.$element.children().each(function(){if(!a(this).is(".dragging")){var c=b(a(this)),d=g<c.t+c.h/2;a(this).toggleClass("drag-after",d),a(this).toggleClass("drag-before",!d)}})},reorder:function(b,c){var d=c?c:a(b.item),e=this.$element.children(".drag-after:first"),f=this.$element.children(".drag-before:last"),g=d.index();e.length>0&&d.insertBefore(e),f.length>0&&d.insertAfter(f),0===e.length&&0===f.length&&c&&this.$element.append(d);var h=d.index();if(g!=h||c){var i=jQuery.Event(c?"inserted":"reordered");return i.sourceElement=b.sourceElement,i.oldIndex=g,i.newIndex=h,i.item=d.get(0),this.$element.trigger(i),!0}return!1},close:function(b){if(this.options.closeable){b.preventDefault();var c=a(b.target).closest("li"),d=c.index();c.remove();var e=jQuery.Event("removed");e.sourceElement=this.$element.get(0),e.index=d,e.item=c.get(0),this.$element.trigger(e)}}}),CUI.util.plugClass(CUI.DraggableList),CUI.options.dataAPI&&a(document).on("cui-contentloaded.data-api",function(){a("[data-init~=draggable-list]").draggableList()})}(window.jQuery),function(a){CUI.CharacterCount=new Class({toString:"CharacterCount",extend:CUI.Widget,construct:function(){this.$element.attr("maxlength")&&(this.options.maxlength=this.$element.attr("maxlength")),this.$element.removeAttr("maxlength"),this.countElement=a("<span>").addClass("character-count"),this.$element.is("input")||(this.container=a("<div>").addClass("character-count-container"),this.$element.wrapAll(this.container)),this.$element.after(this.countElement),this.$element.on("input",this._render.bind(this)),this.$element.on("change:maxlength",this._render.bind(this)),this._render()},defaults:{maxlength:null},isTooLong:function(){var a=this.$element.is("input,textarea"),b=a?this.$element.val().length:this.$element.text().length,c=this.options.maxlength?b>this.options.maxlength:!1;return c},_render:function(){var a=this.$element.is("input,textarea"),b=a?this.$element.val().length:this.$element.text().length,c=this.isTooLong();this.$element.toggleClass("error",c),this.countElement.toggleClass("negative",c),this.countElement.text(this.options.maxlength?this.options.maxlength-b:b)}}),CUI.util.plugClass(CUI.CharacterCount),a(document).on("cui-contentloaded.data-api",function(b){a("[data-init~=character-count]",b.target).characterCount()})}(window.jQuery),function(a){CUI.Accordion=new Class({toString:"Accordion",extend:CUI.Widget,construct:function(){if(this.isAccordion=!this.$element.hasClass("collapsible")&&"collapsible"!==this.$element.data("init"),this.isAccordion&&this.$element.addClass("accordion"),this.isAccordion){var a=this.$element.children(".active").index();this.options.active!==!1&&(a=this.options.active),this.$element.children().each(function(b,c){this._initElement(c,b!=a)}.bind(this))}else this._initElement(this.$element,!(this.options.active||this.$element.hasClass("active")));this._setListeners(),this._makeAccessible(),this._updateDOMForDisabled()},defaults:{active:!1,disabled:!1},isAccordion:!1,_setListeners:function(){this.$element.on("click","h3",this._toggle.bind(this)),this.$element.on("change:active",this._changeActive.bind(this)),this.$element.on("selectstart","h3",function(a){a.preventDefault()}),this.on("change:disabled",function(){this._updateDOMForDisabled()}.bind(this))},_updateDOMForDisabled:function(){this.options.disabled?this.$element.addClass("disabled").attr("aria-disabled",!0):this.$element.removeClass("disabled").attr("aria-disabled",!1)},_toggle:function(b){if(!this.options.disabled){var c=a(b.target).closest(".collapsible"),d=c.hasClass("active"),e=d?!1:this.isAccordion?c.index():!0;this.setActive(e)}},_changeActive:function(){if(this.isAccordion){if(this._collapse(this.$element.children(".active")),this.options.active!==!1){var a=this.$element.children().eq(this.options.active);this._expand(a)}}else this.options.active?this._expand(this.$element):this._collapse(this.$element)},setActive:function(a){this.options.active=a,this._changeActive()},_initElement:function(b,c){0===a(b).find("h3").length&&a(b).prepend("<h3>&nbsp;</h3>"),0===a(b).find("h3 i").length&&a(b).find("h3").prepend("<i></i>"),a(b).addClass("collapsible");var d=a(b).find("h3"),e=a("<div></div>").toggle(!c),f=d.find("i");a(b).wrapInner(e),d.prependTo(b),c?(a(b).removeClass("active"),a(b).height(d.height()),f.removeClass("icon-chevrondown").addClass("icon-chevronup")):(a(b).addClass("active"),a(b).css("height","auto"),f.removeClass("icon-chevronup").addClass("icon-chevrondown"))},_collapse:function(a){a.find("h3 i").removeClass("icon-chevrondown").addClass("icon-chevronup"),a.animate({height:a.find("h3").height()},"fast",function(){a.removeClass("active"),a.find("div[aria-expanded]").hide()});var b=a.find("h3"),c=b.next("div[aria-expanded]");this.isAccordion?b.attr({tabindex:b.is(document.activeElement)?0:-1,"aria-selected":!1}):b.attr({"aria-expanded":!1}),c.attr({"aria-hidden":!0,"aria-expanded":!1})},_expand:function(a){a.addClass("active"),a.find("h3 i").removeClass("icon-chevronup").addClass("icon-chevrondown");var b=this._calcHeight(a);a.animate({height:b},"fast",function(){a.css("height","auto")});var c=a.find("h3"),d=c.next("div[aria-expanded]");this.isAccordion?c.attr({tabindex:0,"aria-selected":!0}):c.attr({"aria-expanded":!0}),d.attr({"aria-hidden":!1,"aria-expanded":!0}).show()},_calcHeight:function(b){var c=a(b).clone(),d=c.find("div[aria-expanded]");d.show(),c.css({display:"block",position:"absolute",top:"-10000px",width:b.width(),height:"auto"}),a("body").append(c);var e=c.height();return c.remove(),e},_makeAccessible:function(){var b,c,d,e,f,g="accordion-"+(new Date).getTime()+"-";this.isAccordion?(this.$element.attr({role:"tablist"}),this.$element.children(".collapsible").each(function(b,c){var d=a(c),e=d.find("h3:first"),f=d.hasClass("active"),h=g+"panel-"+b,i=e.next("div");d.attr({role:"presentation"}),e.attr({role:"tab",id:e.attr("id")||g+"tab-"+b,"aria-controls":h,"aria-selected":f,tabindex:f?0:-1}),i.attr({role:"tabpanel",id:h,"aria-labelledby":e.attr("id"),"aria-expanded":f,"aria-hidden":!f})})):(g="collapsible-"+(new Date).getTime()+"-",b=this.$element,c=b.find("h3:first"),e=b.hasClass("active"),f=g+"panel",d=c.next("div"),c.attr({role:"button",id:c.attr("id")||g+"heading","aria-controls":f,"aria-expanded":e,tabindex:0}),d.attr({id:f,"aria-labelledby":c.attr("id"),"aria-expanded":e,"aria-hidden":!e})),this.$element.on("keydown",":focusable",this._onKeyDown.bind(this)),this.$element.on("focusin.accordion",":focusable",this._onFocusIn.bind(this)),this.$element.on("focusout.accordion","h3:focusable",this._onFocusOut.bind(this)),this.$element.on("touchstart.accordion, mousedown.accordion","h3:focusable",this._onMouseDown.bind(this))},_onKeyDown:function(b){var c=a(b.currentTarget).closest(".collapsible"),d=c.find("h3:first"),e=a(b.currentTarget).is(d),f=!0;switch(b.which){case 13:case 32:e?d.trigger("click"):f=!1;break;case 33:case 37:case 38:e&&this.isAccordion||33===b.which&&(b.metaKey||b.ctrlKey)?0===c.prev().find("h3:first").focus().length&&this.$element.find(".collapsible:last h3:first").focus():e||!b.metaKey&&!b.ctrlKey?f=!1:d.focus();break;case 34:case 39:case 40:e&&this.isAccordion?0===c.next().find("h3:first").focus().length&&this.$element.find(".collapsible:first h3:first").focus():e||34!==b.which||!b.metaKey&&!b.ctrlKey?f=!1:d.focus();break;case 36:e&&this.isAccordion?this.$element.find(".collapsible:first h3:first").focus():f=!1;break;case 35:e&&this.isAccordion?this.$element.find(".collapsible:last h3:first").focus():f=!1;break;default:f=!1}f===!0&&b.preventDefault()},_onFocusIn:function(b){var c=a(b.currentTarget).closest(".collapsible"),d=c.find("h3:first"),e=a(b.currentTarget).is(d);e&&(this.isAccordion&&this.$element.find(".collapsible h3[role=tab]").attr("tabindex",-1),d.data("collapsible-mousedown")?d.removeData("collapsible-mousedown"):c.addClass("focus")),d.attr("tabindex",0)},_onFocusOut:function(b){var c=a(b.currentTarget).closest(".collapsible"),d=c.find("h3:first"),e=a(b.currentTarget).is(d);e&&c.removeClass("focus").removeData("collapsible-mousedown")},_onMouseDown:function(b){var c=a(b.currentTarget).closest(".collapsible"),d=c.find("h3:first"),e=a(b.currentTarget).is(d);e&&d.data("collapsible-mousedown",!0)}}),CUI.util.plugClass(CUI.Accordion),a(document).on("cui-contentloaded.data-api",function(){a("[data-init~=accordion],[data-init~=collapsible]").accordion()})}(window.jQuery),function(a){CUI.Tour=new Class({toString:"Tour",extend:CUI.Widget,construct:function(){this.$slides=this.$element.find(".tour-slide"),this.$navigation=this.$element.find("nav"),this.$skip=this.$navigation.find("button.skip"),this.$done=this.$navigation.find("button.done"),this.$prev=this.$navigation.find("a.prev"),this.$next=this.$navigation.find("a.next"),this.$control=this.$navigation.find(".control"),this.$current=this.$element.find(".tour-slide.active"),this.$current=this.$current.length>0?this.$current:this.$element.find(".tour-slide:eq(0)").addClass("active"),this._setCircleNav(this.$current),this._toggleButtons(this.$current),this._bindControls(),this.$element.hasClass("show")&&(this.options.autoshow=!0),this.options.autoshow&&this.show()},defaults:{autoshow:!1,backdrop:"static"},_toggleButtons:function(a){this.$skip.removeClass("show"),this.$done.removeClass("show"),this.$prev.removeClass("hide"),this.$next.removeClass("hide"),a.hasClass("first")?(this.$skip.addClass("show"),this.$prev.addClass("hide")):(a.hasClass("last")||a.hasClass("skipper"))&&(this.$done.addClass("show"),this.$next.addClass("hide"))},_setCircleNav:function(a){var b=a.index();a.hasClass("skipper")?this.$control.removeClass("show").addClass("hide"):this.$control.removeClass("hide").addClass("show").find("a").removeClass("active").filter(":eq("+b+")").addClass("active")},_slideTo:function(b){var c=a(b);c.length>0&&(this.$current.find(".fadable").addClass("faded"),this.$current.removeClass("active"),this.$current=c.addClass("active"),this._setCircleNav(c),this._toggleButtons(c),this._stopLastAnimation(),this._startNewAnimation())},slideToNext:function(){var a=this.$current.next(".tour-slide");return this.$current.hasClass("last")||this._slideTo(a),this},slideToPrev:function(){var a=this.$current.hasClass("skipper")?this.$element.find(".first"):this.$current.prev(".tour-slide");return this._slideTo(a),this},slideToSkipper:function(){var a=this.$element.find(".skipper");return this._slideTo(a),this},slideToFirst:function(){var a=this.$element.find(".first");return this._slideTo(a),this},slideTo:function(a){return this._slideTo(this.$slides[a]),this},_bindControls:function(){this.$navigation.on("click","a",function(a){a.preventDefault()}),this.$skip.fipo("tap","click",this.slideToSkipper.bind(this)),this.$done.fipo("tap","click",this.hide.bind(this)),this.$prev.fipo("tap","click",this.slideToPrev.bind(this)),this.$next.fipo("tap","click",this.slideToNext.bind(this)),this.$control.fipo("tap","click","a",function(b){this.slideTo(a(b.currentTarget).index())}.bind(this)),this.$element.finger("swipe",".tour-slide",function(a){1===a.finger&&("left"===a.direction?this.slideToNext():"right"===a.direction&&this.slideToPrev())}.bind(this))},_startNewAnimation:function(){var a=this.$current.find(".fadable");a&&(this._animationTimer=setInterval(function(){a.toggleClass("faded")},5e3))},_stopLastAnimation:function(){clearInterval(this._animationTimer)},_show:function(){this.$element.addClass("show"),this.slideToFirst(),this._toggleBackdrop(!0),this._startNewAnimation()},_hide:function(){this.$element.removeClass("show"),this._toggleBackdrop(),this._stopLastAnimation()},_removeBackdrop:function(){this.$backdrop&&!this.get("visible")&&(this.$backdrop.remove(),this.$backdrop=null)},_toggleBackdrop:function(b){b&&this.options.backdrop?this.$backdrop?this.$backdrop.fadeIn():(this.$backdrop=a("<div/>",{"class":"tour-backdrop",css:{display:"none"}}).appendTo(document.body),setTimeout(function(){this.$backdrop.fadeIn()}.bind(this),50),"static"!==this.options.backdrop&&this.$backdrop.click(this.hide)):!b&&this.$backdrop&&this.$backdrop.fadeOut(function(){this._removeBackdrop()}.bind(this))}}),CUI.util.plugClass(CUI.Tour),CUI.options.dataAPI&&a(document).on("cui-contentloaded.data-api",function(b){a("[data-init=tour]",b.target).tour()})}(window.jQuery),function(a){CUI.NumberInput=new Class({toString:"NumberInput",extend:CUI.Widget,construct:function(){this._fixMarkup(),this._setListeners(),this._setAttributes()},defaults:{max:null,min:null,step:1,hasError:!1,disabled:!1},increment:function(){if(this._isNumber()){var a=this.getValue();a+=this.getStep(),a=a>this.getMax()?this.getMax():a,this.setValue(a)}},decrement:function(){var a=this.getValue();a-=this.getStep(),a=a<this.getMin()?this.getMin():a,this.setValue(a)},setValue:function(a){this.$input.val(a),this.$input.trigger("change")},setMin:function(a){this.set("min",a)},setMax:function(a){this.set("max",a)},setStep:function(a){this.set("step",a)},getValue:function(){var a=this.$input.val();return a="undefined"==typeof a||null==a||a.length<1?"":parseFloat(a)},getMin:function(){return parseFloat(this.options.min)},getMax:function(){return parseFloat(this.options.max)},getStep:function(){return parseFloat(this.options.step)},_fixMarkup:function(){this.$input=this.$element.find("input").not("[type=hidden]"),"text"!=this.$input.attr("type")&&this._switchInputTypeToText(this.$input);var b=this.$element.find("button");b&&2==b.length?(this.$decrementElement=a(b[0]),this.$incrementElement=a(b[1])):(a.each(b,function(c){a(b[c]).detach()}),this.$decrementElement=a('<button type="button">'),this.$incrementElement=a('<button type="button">'),this.$input.before(this.$decrementElement),this.$input.after(this.$incrementElement)),this.$decrementElement.addClass("decrement").html("decrement"),this.$incrementElement.addClass("increment").html("increment")},_setListeners:function(){this.$input.on("change",function(){this._checkMinMaxViolation(),this._adjustValueLimitedToRange()}.bind(this)),this.on("beforeChange:step",function(a){this._optionBeforeChangeHandler(a)}.bind(this)),this.on("beforeChange:min",function(a){this._optionBeforeChangeHandler(a)}.bind(this)),this.on("beforeChange:max",function(a){this._optionBeforeChangeHandler(a)}.bind(this)),this.on("change:disabled",function(){this._toggleDisabled()}.bind(this)),this.on("change:hasError",function(){this._toggleError()}.bind(this)),this.$incrementElement.on("click",function(){this.increment()}.bind(this)),this.$decrementElement.on("click",function(){this.decrement()}.bind(this))},_setAttributes:function(){this.$element.addClass("numberinput"),this.$input.attr("max")&&this.setMax(this.$input.attr("max")),this.$input.attr("min")&&this.setMin(this.$input.attr("min")),this.$input.attr("step")&&this.setStep(this.$input.attr("step")),this.$element.attr("error")&&(this.options.hasError=!0),this.setStep(this.options.step||CUI.Datepicker.step),this.setValue(this.$input.val()||0),(this.$element.attr("disabled")||this.$element.attr("data-disabled"))&&this._toggleDisabled(),(this.$element.hasClass("error")||this.$element.attr("data-error"))&&this.set("hasError",!0)},_adjustValueLimitedToRange:function(){var a=this.getValue();isNaN(a)||(a>this.getMax()?a=this.getMax():a<this.getMin()&&(a=this.getMin())),this.$input.val(a)},_checkMinMaxViolation:function(){this._isNumber()&&(this.$incrementElement.removeAttr("disabled"),this.$decrementElement.removeAttr("disabled"),this.options.max&&this.getValue()>=this.getMax()?this.$incrementElement.attr("disabled","disabled"):this.options.min&&this.getValue()<=this.getMin()&&this.$decrementElement.attr("disabled","disabled"))},_switchInputTypeToText:function(a){var b=a.detach().attr("type","text");this.$element.prepend(b)},_isNumber:function(){return!isNaN(this.$input.val())},_optionBeforeChangeHandler:function(a){isNaN(parseFloat(a.value))&&a.preventDefault()},_toggleDisabled:function(){this.options.disabled?(this.$incrementElement.attr("disabled","disabled"),this.$decrementElement.attr("disabled","disabled"),this.$input.attr("disabled","disabled")):(this.$incrementElement.removeAttr("disabled"),this.$decrementElement.removeAttr("disabled"),this.$input.removeAttr("disabled"))},_toggleError:function(){this.options.hasError?this.$element.addClass("error"):this.$element.removeClass("error")}}),CUI.util.plugClass(CUI.NumberInput),a(document).on("cui-contentloaded.data-api",function(b){a("[data-init~=numberinput]",b.target).numberInput()})}(window.jQuery),function(a){var b='<div class="button-group navigation-bar"></div>',c="<button id='classicButton'><i class=\"icon-viewgrid\"></i></button>",d="<button id='editButton'><i class=\"icon-edit\"></i></button>",e="editMode",f="classicMode";CUI.Colorpicker=new Class({toString:"Colorpicker",extend:CUI.Widget,defaults:{config:{colors:{},displayModes:{}},disabled:!1,name:null,title:""},palettePageSize:3,colorShadeNo:6,lowerLimit:0,upperLimit:0,colorNames:[],currentPage:0,pages:1,construct:function(){if(this._readDataFromMarkup(),this._adjustMarkup(),(null===this.options.config||0===this.options.config.colors.length)&&(this.options.disabled=!0),!this.options.disabled&&this.options.config.displayModes.classicPalette&&this.options.config.displayModes.freestylePalette&&(this.options.disabled=!0),this.options.disabled||0!==this.options.config.displayModes.length&&(this.options.config.displayModes.classicPalette||this.options.config.displayModes.freestylePalette)||(this.options.config.displayModes.classicPalette=!0),this.$openButton=this.$element.find("input.colorpicker-launcher"),this.$hiddenInput=this.$element.find("input[name='"+this.options.name+"']"),this.$element.attr("value")){var b=this.$element.attr("value");CUI.util.color.isValid("rgba",b)||CUI.util.color.isValid("rgb",b)?this._setColor(b):this.$element.removeAttr("value")}this.options.disabled?this.$element.find(">input").attr("disabled","disabled"):(this.colorNames=[],a.each(this.options.config.colors,function(a){this.colorNames.push(a)}.bind(this)),a("body").off("tap."+this.options.name+" click."+this.options.name).fipo("tap."+this.options.name,"click."+this.options.name,function(a){this.keepShown||0===this.$element.find(".popover").has(a.target).length&&this._hidePicker()}.bind(this)),this.$openButton.on("click",function(){try{this.pickerShown?this._hidePicker():this._openPicker(),this.keepShown=!0,setTimeout(function(){this.keepShown=!1}.bind(this),200)}catch(a){}}.bind(this)))},_readDataFromMarkup:function(){this.$element.data("disabled")&&(this.options.disabled=!0),this.$element.data("name")&&(this.options.name=this.$element.data("name")),this.$element.attr("title")&&(this.options.title=this.$element.attr("title"));var a=this.$element;void 0!==a.data("config")&&(this.options.config={},this.options.config.colors={},this.options.config.displayModes={},a.data("config").colors?this.options.config.colors=a.data("config").colors:this.options.disabled=!0,a.data("config").pickerModes&&(this.options.config.displayModes=a.data("config").pickerModes))},_adjustMarkup:function(){this.$element.addClass("colorpicker"),0===this.$element.find(".popover").length&&(this.$element.append('<div class="popover arrow-top" style="display:none"><div class="inner"></div></div>'),this.$element.find(".inner").append('<div class="colorpicker-holder"><div class="palette-header"></div><div class="colorpicker-body"></div><div class="colorpicker-footer"></div></div>')),0===this.$element.find("input[type=hidden]").length&&this.$element.append('<input type="hidden" name="'+this.options.name+'">');var a=this.$element.find("input.colorpicker-launcher");void 0===a.attr("type")&&a.attr("type","button")},_openPicker:function(){this._renderPicker(f);var a=this.$openButton.position().left+this.$openButton.width()/2-(this.$element.find(".popover").width()/2+9);0>a&&(a=0);var b=this.$openButton.position().top+this.$openButton.outerHeight()+14;this._renderPickerFooter(),this.$element.find(".popover").css({position:"absolute",left:a+"px",top:b+"px"}).show(),this.pickerShown=!0},_hidePicker:function(){this.lowerLimit=0,this.upperLimit=0,this.currentPage=0,this.$element.removeClass("focus"),this.$element.find(".popover").hide(),this.pickerShown=!1},_renderPicker:function(a,b,c){if(a!==f||this._calculatePaletteBoundaries(b,c)){var d=null;d=a===f?this._renderPalette():this._renderEditPalette();var g=this.$element.find(".colorpicker-holder"),h=g.find(".palette-navigator"),i=g.find(".colorpicker-body");if(b&&g.find("table").length>0)this._slidePicker(d,"left"===b);else if(g.find("table").remove(),g.find(".sliding-container").remove(),a===e){if(i.append(d),h.remove(),void 0!==this.$hiddenInput.val()&&this.$hiddenInput.val().length>0){d.find("div.color").css("background",this.$hiddenInput.val());var j=CUI.util.color.RGBAToHex(this.$hiddenInput.val());d.find("input[name=':hex']").val(j);var k=CUI.util.color.HexToRGB(j);this._fillRGBFields(k);var l=CUI.util.color.RGBtoCMYK(k);this._fillCMYKFields(l)}}else h.length>0?h.before(d):(i.append(d),this._renderPaletteNavigation())
}},_renderPickerFooter:function(){if(this.$element.find(".colorpicker-footer").html(b),void 0!==this.options.config.displayModes){if(this.options.config.displayModes.classicPalette||this.options.config.displayModes.freestylePalette){var g=a(c);g.addClass("selected"),this.$element.find(".navigation-bar").append(g)}if(!this.options.config.displayModes.edit)return this.$element.find(".colorpicker-footer").remove(),void 0;this.$element.find(".navigation-bar").append(d)}this.$element.find(".colorpicker-footer button").off("tap.button click.button").fipo("tap.button","click.button",function(b){b.stopPropagation(),b.preventDefault();var c=a(b.target),d=null;this.$element.find(".navigation-bar > .selected").removeClass("selected"),"BUTTON"===b.target.nodeName?(c.addClass("selected"),d=a(b.target)):(c.parent().addClass("selected"),d=c.parent()),"editButton"===d.attr("id")?this._renderPicker(e):this._renderPicker(f,!1,this.currentPage)}.bind(this))},_calculatePaletteBoundaries:function(a,b){var c=0;if(c=this.options.config.displayModes.freestylePalette?this.palettePageSize*this.colorShadeNo:this.palettePageSize,a)if("left"===a){if(b=this.currentPage+1,b+1>this.pages)return!1;this.lowerLimit=c*b,this.upperLimit=this.lowerLimit+c-1,this.currentPage=b}else{if(b=this.currentPage-1,0>b)return!1;this.lowerLimit=c*b,this.upperLimit=this.lowerLimit+c-1,this.currentPage=b}else void 0!==b?(this.lowerLimit=c*b,this.upperLimit=this.lowerLimit+c-1,this.currentPage=b):(this.upperLimit+=c-1,this.lowerLimit=0,this.currentPage=0);return!0},_renderPaletteNavigation:function(){this.$element.find(".palette-navigator").remove();var b=a("<div>");if(b.addClass("palette-navigator"),this.pages=this.options.config.displayModes.classicPalette?Math.ceil(this.colorNames.length/this.palettePageSize):Math.ceil(this.colorNames.length/(this.palettePageSize*this.colorShadeNo)),this.pages>1)for(var c=0;c<this.pages;c++)b.append("<i class='dot' page='"+c+"'></i>");this.$element.find(".colorpicker-body").append(b),this.$element.find("i[page='"+this.currentPage+"']").addClass("active"),this.$element.find(".colorpicker-body").on("swipe",function(a){this._renderPicker(f,"left"===a.direction?"left":"right")}.bind(this)),this.$element.find(".dot").off("tap.dot click.dot").fipo("tap.dot","click.dot",function(b){b.stopPropagation(),this.currentPage!==parseInt(a(b.target).attr("page"),10)&&this._renderPicker(f,!1,parseInt(a(b.target).attr("page"),10))}.bind(this))},_slidePicker:function(b,c){this.$element.find(".sliding-container table").stop(!0,!0),this.$element.find(".sliding-container").remove();var d=this.$element.find("table"),e=d.width(),f=d.height(),g=a('<div class="sliding-container">');g.css({display:"block",position:"relative",width:e+"px",height:f+"px",overflow:"hidden"}),this.$element.find(".palette-navigator").before(g),g.append(d).append(b),d.css({position:"absolute",left:0,top:0}),d.after(b),b.css({position:"absolute",left:c?e:-e,top:0});var h=400;d.animate({left:c?-e:e},h,function(){d.remove()}),b.animate({left:0},h,function(){0!==g.parents().length&&(b.css({position:"relative",left:0,top:0}),b.detach(),this.$element.find(".palette-navigator").before(b),g.remove())}.bind(this))},_renderPaletteHeader:function(){var b=a('<div class="palette-header"><div class="title"></div><div class="selection"></div></div>'),c=this.$element.find(".colorpicker-holder");c.find(".palette-header").length>0?c.find(".palette-header").replaceWith(b):c.prepend(b),c.find(".title").html("<span>"+this.options.title+"</span>")},_renderPalette:function(){this._renderPaletteHeader();for(var b=a("<table>"),c="",d=0;d<this.palettePageSize;d++){c+="<tr>";for(var e=0,f="",g="",h="",i=0;i<this.colorShadeNo;i++)this.options.config.displayModes.classicPalette?this.colorNames.length-1<d+this.lowerLimit?c+="<td><a></a></td>":(f=CUI.util.color.HexToRGB(this.options.config.colors[this.colorNames[d+this.lowerLimit]]),h="rgba("+f.r+","+f.g+","+f.b+","+(1-e).toFixed(2)+")",e+=.16,CUI.util.color.isSameColor(h,this.$hiddenInput.val())?(g="selected",this._fillSelectedColor(this.colorNames[d+this.lowerLimit],CUI.util.color.RGBAToHex(h))):g="",c+="<td class='filled'><a style='background-color:"+h+"' color='"+h+"' colorName='"+this.colorNames[d+this.lowerLimit]+"' class='"+g+"'></a></td>"):this.colorNames.length-1<d*this.colorShadeNo+i?c+="<td><a></a></td>":(f=CUI.util.color.HexToRGB(this.options.config.colors[this.colorNames[d*this.colorShadeNo+i]]),h="rgba("+f.r+","+f.g+","+f.b+",1)",g=CUI.util.color.isSameColor(h,this.$hiddenInput.val())?"selected":"",c+="<td class='filled'><a style='background-color:"+h+"' color='"+h+"' colorName='"+this.colorNames[d*this.colorShadeNo+i]+"' class='"+g+"'></a></td>");c+="</tr>"}b.append("<tbody>"+c+"</tbody>"),b.find("a").off("tap.a click.a").fipo("tap.a","click.a",function(b){if(b.stopPropagation(),b.preventDefault(),!CUI.util.color.isSameColor(this.$hiddenInput.val(),a(b.target).attr("color"))){this.$element.find("table").find(".selected").removeClass("selected"),a(b.target).addClass("selected");var c=void 0!==a(b.target).attr("colorName")?a(b.target).attr("colorName"):"";this._fillSelectedColor(c,CUI.util.color.RGBAToHex(a(b.target).attr("color"))),this._setColor(a(b.target).attr("color"))}}.bind(this));var j=this.$element.find(".palette-navigator");return j.find(".active").removeClass("active"),j.find("i[page='"+this.currentPage+"']").addClass("active"),b},_fillSelectedColor:function(a,b){this.$element.find(".colorpicker-holder").find(".selection").html("<div><span>"+a+"</span><span>"+b+"</span></div>")},_renderEditPalette:function(){var b=a("<table>"),c="<tr><td colspan='2' rowspan='2'><div class='color'></div></td><td class='label'>HEX</td><td colspan='2'><input type='text' name=':hex'/></td><td colspan='2'>&nbsp;</td></tr><tr><td class='label'>RGB</td><td><input type='text' name=':rgb_r'/></td><td><input type='text' name=':rgb_g'/></td><td><input type='text' name=':rgb_b'/></td><td>&nbsp;</td></tr><tr><td colspan='2'>&nbsp;</td><td class='label'>CMYK</td><td><input type='text' name=':cmyk_c'/></td><td><input type='text' name=':cmyk_m'/></td><td><input type='text' name=':cmyk_y'/</td><td><input type='text' name=':cmyk_k'/></td></tr><tr><td colspan='3'>&nbsp;</td><td colspan='4'><button class='primary'>Save Color</button></td></tr>";return b.append("<tbody>"+c+"</tbody>"),this.$element.find(".palette-header").remove(),b.find("input[name^=':rgb_']").each(function(b,c){a(c).attr("maxlength","3"),a(c).on("blur",function(b){var c=/^([0]|[1-9]\d?|[1]\d{2}|2([0-4]\d|5[0-5]))$/;if(!c.test(a(b.target).val().trim())||a("input:text[value=''][name^='rgb_']").length>0)return a(b.target).val(""),this._clearCMYKFields(),this.$element.find("input[name=':hex']").val(""),this.$element.find("div.color").removeAttr("style"),void 0;var d={r:this.$element.find("input[name=':rgb_r']").val(),g:this.$element.find("input[name=':rgb_g']").val(),b:this.$element.find("input[name=':rgb_b']").val()},e=CUI.util.color.RGBtoCMYK(d),f=CUI.util.color.RGBToHex(d);this._fillCMYKFields(e),this.$element.find("input[name=':hex']").val(f),this.$element.find("div.color").css("background",f)}.bind(this))}.bind(this)),b.find("input[name^=':cmyk_']").each(function(b,c){a(c).attr("maxlength","3"),a(c).on("blur",function(b){var c=/^[1-9]?[0-9]{1}$|^100$/;if(!c.test(a(b.target).val().trim())||a("input:text[value=''][name^='cmyk_']").length>0)return a(b.target).val(""),this._clearRGBFields(),this.$element.find("input[name=':hex']").val(""),this.$element.find("div.color").removeAttr("style"),void 0;var d={c:this.$element.find("input[name=':cmyk_c']").val(),m:this.$element.find("input[name=':cmyk_m']").val(),y:this.$element.find("input[name=':cmyk_y']").val(),k:this.$element.find("input[name=':cmyk_k']").val()},e=CUI.util.color.CMYKtoRGB(d),f=CUI.util.color.RGBToHex(e);this.$element.find("input[name=':hex']").val(f),this._fillRGBFields(e),this.$element.find("div.color").css("background",f)}.bind(this))}.bind(this)),b.find("input[name=':hex']").each(function(c,d){a(d).attr("maxlength","7"),a(d).on("blur",function(c){var d=CUI.util.color.fixHex(a(c.target).val().trim());if(0===d.length)return this._clearRGBFields(),this._clearCMYKFields(),this.$element.find("div.color").removeAttr("style"),void 0;var e=CUI.util.color.HexToRGB(d),f=CUI.util.color.RGBtoCMYK(e);this._fillRGBFields(e),this._fillCMYKFields(f),b.find("div.color").css("background",d)}.bind(this))}.bind(this)),b.on("click tap","input, div",function(a){a.stopPropagation(),a.preventDefault()}),b.on("click tap","button",function(a){a.stopPropagation(),a.preventDefault(),void 0!==this.$element.find("input[name=':hex']").val()&&this.$element.find("input[name=':hex']").val().length>0&&this._setColor(this.$element.find("input[name=':hex']").val())}.bind(this)),b},_setColor:function(a){this.$hiddenInput.val(a),this.$openButton.css("background-color",this.$hiddenInput.val())},_fillRGBFields:function(a){this.$element.find("input[name=':rgb_r']").val(a.r),this.$element.find("input[name=':rgb_g']").val(a.g),this.$element.find("input[name=':rgb_b']").val(a.b)},_clearRGBFields:function(){this.$element.find("input[name^=':rgb']").val("")},_fillCMYKFields:function(a){this.$element.find("input[name=':cmyk_c']").val(a.c),this.$element.find("input[name=':cmyk_m']").val(a.m),this.$element.find("input[name=':cmyk_y']").val(a.y),this.$element.find("input[name=':cmyk_k']").val(a.k)},_clearCMYKFields:function(){this.$element.find("input[name^=':cmyk']").val("")}}),CUI.util.plugClass(CUI.Colorpicker),CUI.options.dataAPI&&a(document).on("cui-contentloaded.data-api",function(b){a("[data-init~=colorpicker]",b.target).colorpicker()})}(window.jQuery),function(a){"use strict";function b(a){var b=a.next();return b.length>0?b:a.prevAll().last()}CUI.CycleButtons=new Class({toString:"CycleButtons",extend:CUI.Widget,construct:function(){this.$element.on("click tap",function(c){if(!c._cycleButtons){c.stopPropagation(),c.preventDefault();var d=a(this);if(1!==d.children().length){var e=d.children(".cyclebuttons-active"),f=b(e);e.removeClass("cyclebuttons-active"),f.addClass("cyclebuttons-active");var g=a.Event("click",{_cycleButtons:!0});f.trigger(g)}}})}}),CUI.util.plugClass(CUI.CycleButtons),a(document).on("cui-contentloaded.data-api",function(b){a("[data-init~='cyclebuttons']",b.target).cycleButtons()})}(window.jQuery),function(a){CUI.SelectList=new Class({toString:"SelectList",extend:CUI.Widget,construct:function(){this.applyOptions(),this.$element.on("change:type",this._setType.bind(this)).on("change:autohide",this._setAutohide.bind(this)).on("click",'[role="option"]',this._triggerSelected.bind(this)).on("mouseenter",'[role="option"]',this._handleMouseEnter.bind(this)),this._makeAccessible()},defaults:{type:"static",multiple:!1,relatedElement:null,autofocus:!0,autohide:!0,dataurl:null,dataurlformat:"html",datapaging:!0,datapagesize:10,dataadditional:null,loadData:a.noop,position:"center bottom-1"},applyOptions:function(){this._setType()},_setAutohide:function(){var a=this,b=!1;this.options.autohide?this.$element.on("focusout.selectlist-autohide",function(){clearTimeout(a._autohideTimer),a._autohideTimer=setTimeout(function(){b||a.hide(),b=!1},500)}).on("focusin.selectlist-autohide",function(){b=!0}):this.$element.off("focusout.selectlist-autohide focusin.selectlist-autohide")},_setType:function(){function a(){var a=c.$element.get(0),b=a.scrollHeight,d=a.scrollTop;b-c.$element.height()<=d+30&&c._handleLoadData()}var b,c=this;"dynamic"===this.options.type?this.$element.on("scroll.selectlist-dynamic-load",function(){b&&clearTimeout(b),c._loadingComplete||this._loadingIsActive||(b=setTimeout(a,500))}):this.$element.off("scroll.selectlist-dynamic-load")},_makeAccessible:function(){this.$element.attr({role:"listbox",tabindex:-1,"aria-controls":this.options.relatedElement.attr("id")||"","aria-hidden":!0,"aria-multiselectable":this.options.multiple}),this._makeAccessibleListOption(this.$element.children()),this.$element.on("focusin focusout",'li[role="option"]',function(b){a(b.currentTarget).attr("tabindex","focusin"===b.type?-1:0)}),this.$element.on("keydown",'li[role="option"]',function(b){var c=a(b.currentTarget),d=a(b.delegateTarget).find('[role="option"]').not('[aria-disabled="true"]'),e=c,f=!0,g=d.index(c);switch(b.which){case 13:case 32:c.trigger("click"),b.preventDefault(),f=!1;break;case 27:c.trigger("blur"),f=!1;break;case 33:case 37:case 38:e=g-1>-1?d[g-1]:d[d.length-1];break;case 34:case 39:case 40:e=g+1<d.length?d[g+1]:d[0];break;case 36:e=d[0];break;case 35:e=d[d.length-1];break;default:f=!1}f&&(b.preventDefault(),a(e).trigger("focus"))})},_makeAccessibleListOption:function(b){b.each(function(b,c){var d=a(c);d.hasClass("optgroup")?(d.attr({role:"presentation",tabindex:-1}).children("ul").attr({role:"group"}).children("li").attr({role:"option",tabindex:0}),d.children("span").attr({tabindex:-1})):d.attr({role:"option",tabindex:0})})},_show:function(){var a=this;this.$element.addClass("visible").attr("aria-hidden",!1),this.$element.position({my:"top",at:this.options.position,of:this.options.relatedElement}),this.options.autofocus&&this.$element.find('li[role="option"]:first').trigger("focus"),"dynamic"===this.options.type?this._handleLoadData().done(function(){a.$element.find('li[role="option"]:first').trigger("focus"),a._setAutohide()}):this._setAutohide()},_hide:function(){this._autohideTimer&&clearTimeout(this._autohideTimer),this.$element.removeClass("visible").attr("aria-hidden",!0),this.reset()},_triggerSelected:function(b){var c=a(b.currentTarget),d=c.data("value"),e=c.text();c.trigger(a.Event("selected",{selectedValue:d,displayedValue:e}))},_handleMouseEnter:function(b){a(b.currentTarget).trigger("focus")},clearItems:function(){this.$element.empty()},_pagestart:0,_loadingComplete:!1,_loadingIsActive:!1,_handleLoadData:function(){var b,c=this,d=this._pagestart+this.options.datapagesize,e=a("<div/>",{"class":"selectlist-wait"}).append(a("<span/>",{"class":"wait"}));return this._loadingIsActive?a.Deferred().resolve().promise():(this._loadingIsActive=!0,this.$element.append(e),b=this.options.dataurl?a.ajax({url:this.options.dataurl,context:this,dataType:this.options.dataurlformat,data:a.extend({start:this._pagestart,end:d},this.options.dataadditional||{})}).done(function(b){var d=0;if("html"===c.options.dataurlformat){var e=a(b);d=e.filter("li").length,c._makeAccessibleListOption(e),c.$element.append(e)}d<c.options.datapagesize&&(this._loadingComplete=!0)}):this.options.loadData.call(this,this._pagestart,d),this._pagestart=d,b.always(function(){e.remove(),this._loadingIsActive=!1}),b)},reset:function(){"dynamic"===this.options.type&&(this.clearItems(),this._pagestart=0,this._loadingComplete=!1)},triggerLoadData:function(a){a&&this.reset(),this._handleLoadData()}}),CUI.util.plugClass(CUI.SelectList),CUI.options.dataAPI&&a(document).on("cui-contentloaded.data-api",function(b){a("[data-init~=selectlist]",b.target).selectList()})}(jQuery,this),function(a){CUI.TagList=new Class({toString:"TagList",extend:CUI.Widget,construct:function(){var b=this;this.applyOptions(),this.$element.on("change:values",this._setValues.bind(this)),this.$element.fipo("tap","click","button",function(c){var d=a(c.currentTarget).next("input");b.removeItem(d.val())}),this._makeAccessible()},defaults:{fieldname:"",values:null,tag:"li"},_existingValues:null,applyOptions:function(){var b=this;this._existingValues=[],this.options.values=this.options.values||[],this.options.values.length>0?this._setValues():this.$element.find("input").each(function(c,d){var e=a(d);b._existingValues.push(e.attr("value"))})},_setValues:function(){var a=this.options.values;this.$element.empty(),this.options.values=[],this.addItem(a)},_makeAccessible:function(){this.$element.attr({role:"list"}),this.$element.children(this.options.tag).attr({role:"listitem"})},_show:function(){this.$element.show().attr("aria-hidden",!1)},_hide:function(){this.$element.hide().attr("aria-hidden",!0)},_removeItem:function(b){var c=this.$element.find('input[value="'+b+'"]');c.length>0&&(c.parent().remove(),this.$element.trigger(a.Event("itemremoved"),{value:b}))},_appendItem:function(b){var c,d,e;"string"===a.type(b)?c=d=b:(c=b.display,d=b.value),d+="",a.inArray(d,this._existingValues)>-1||0===d.length||(this._existingValues.push(d),e=a("<"+this.options.tag+"/>",{role:"listitem",text:c}),a("<button/>",{"class":"icon-close"}).prependTo(e),a("<input/>",{type:"hidden",value:d,name:this.options.fieldname}).appendTo(e),this.$element.append(e),this.$element.trigger(a.Event("itemadded"),{value:d,display:c}))},removeItem:function(a){var b=this._existingValues.indexOf(""+a);b>-1&&(this._removeItem(a),this._existingValues.splice(b,1))},addItem:function(b){var c=this,d=a.isArray(b)?b:[b];a.each(d,function(a,b){c._appendItem(b)})},getValues:function(){return this._existingValues.slice(0)}}),CUI.util.plugClass(CUI.TagList),CUI.options.dataAPI&&a(document).on("cui-contentloaded.data-api",function(b){a("[data-init~=taglist]",b.target).tagList()})}(jQuery,this),function(a){CUI.Select=new Class({toString:"Select",extend:CUI.Widget,construct:function(){this._button=this.$element.children("button"),this._select=this.$element.children("select"),this._selectList=this.$element.children(".selectlist"),this._tagList=this.$element.children(".taglist"),this._valueInput=this.$element.children("input[type=hidden]"),this.applyOptions()},defaults:{type:"static",nativewidget:!1,nativewidgetonmobile:!0,multiple:!1,tagConfig:null,selectlistConfig:null},applyOptions:function(){var a=this.options.nativewidgetonmobile&&CUI.util.isTouch&&"static"===this.options.type;this._select.length>0&&this._select.prop("multiple")&&(this.options.multiple=!0),this.options.nativewidget||a?this._setNativeWidget(a):this._setSelectList(),this._setTagList(),"static"===this.options.type&&this._handleNativeSelect()},_setNativeWidget:function(a){this.options.nativewidget||a?(this.$element.addClass("native"),this._select.css({height:this._button.outerHeight()}),this.options.multiple&&this._setTagList(),this._select.on("change.select",this._handleNativeSelect.bind(this))):(this.$element.removeClass("native"),this._select.off("change.select"))},_handleNativeSelect:function(b){var c,d,e=this;e.options.multiple?(a.each(e._select[0].options,function(a,b){b.selected?e._tagListWidget.addItem({value:b.value,display:b.text}):e._tagListWidget.removeItem(b.value)}),c=e._tagListWidget.getValues()):(d=e._select[0][e._select[0].selectedIndex],e._button.text(d.text),c=d.value),b&&this.$element.trigger(a.Event("selected",{selected:c}))},_parseMarkup:function(){function b(b,c){b.children("option").each(function(b,d){var e=a(d);a("<li/>",{"data-value":e.val(),text:e.text()}).appendTo(c)})}var c=this,d=this._select.children("optgroup");d.length>0?d.each(function(d,e){var f=a(e),g=a("<li/>",{"class":"optgroup"}).append(a("<span/>",{text:f.attr("label")}));b(f,a("<ul/>").appendTo(g)),c._selectList.append(g)}):b(this._select,this._selectList)},_setSelectList:function(){var b=this,c="static";0===this._selectList.length&&(this._selectList=a("<ul/>",{"class":"selectlist"}).appendTo(this.$element)),this._select.length>0?this._parseMarkup():c="dynamic",this._selectList.selectList(a.extend({relatedElement:this._button,type:c},this.options.selectlistConfig||{})),this._selectListWidget=this._selectList.data("selectList"),this._button.fipo("tap","click",function(a){a.preventDefault(),b._toggleList()}).finger("click",!1),this._selectList.on("selected.select",this._handleSelected.bind(this)).on("show.dropdown hide.select",function(a){b._button.toggleClass("active","show"===a.type)})},_setTagList:function(){this.options.multiple&&(0===this._tagList.length&&(this._tagList=a("<ol/>",{"class":"taglist"}).appendTo(this.$element)),this._tagList.tagList(this.options.tagConfig||{}),this._tagListWidget=this._tagList.data("tagList"))},_handleSelected:function(b){var c;b&&b.stopPropagation(),this._selectListWidget.hide(),this._select.val(b.selectedValue),this.options.multiple?(this._tagListWidget.addItem({value:b.selectedValue,display:b.displayedValue}),c=this._tagListWidget.getValues()):(this._button.text(b.displayedValue),this._valueInput.val(b.selectedValue),c=""+b.selectedValue),this._button.trigger("focus"),this.$element.trigger(a.Event("selected",{selected:c}))},_toggleList:function(){this._selectListWidget.toggleVisibility()}}),CUI.util.plugClass(CUI.Select),CUI.options.dataAPI&&a(document).on("cui-contentloaded.data-api",function(b){a("[data-init~=select]",b.target).select()})}(jQuery,this),function(a){CUI.Autocomplete=new Class({toString:"Autocomplete",extend:CUI.Widget,construct:function(){this._input=this.options.predefine.input||this.$element.children("input"),this._selectlist=this.options.predefine.selectlist||this.$element.find(".selectlist"),this._tags=this.options.predefine.tags||this.$element.find(".taglist"),this._suggestionsBtn=this.options.predefine.suggestionsBtn||this.$element.find(".autocomplete-suggestion-toggle"),this.applyOptions(),this._makeAccessible()},defaults:{mode:"starts",ignorecase:!0,delay:500,typeahead:!0,showsuggestions:!1,multiple:!1,selectlistConfig:null,tagConfig:null,predefine:{}},applyOptions:function(){this._setTags(),this._setSelectlist(),this._setTypeahead(),this._setSuggestions()},_setSelectlist:function(){0===this._selectlist.length&&(this._selectlist=a("<ul/>",{"class":"selectlist"}).appendTo(this.$element)),this._selectlist.selectList(a.extend({relatedElement:this._input,autofocus:!1,autohide:!1},this.options.selectlistConfig||{})),this._selectListWidget=this._selectlist.data("selectList"),this._selectlist.on("selected.autcomplete",this._handleSelected.bind(this))},_setTags:function(){this.options.multiple?(0===this._tags.length&&(this._tags=a("<ul/>",{"class":"taglist"}).appendTo(this.$element)),this._tags.tagList(this.options.tagConfig||{}),this._tagList=this._tags.data("tagList"),this._input.on("keyup.autocomplete-addtag",this._addTag.bind(this))):this._input.off("keyup.autocomplete-addtag")},_setTypeahead:function(){function a(){c.handleInput(c._input.val(),c._selectListWidget)}var b,c=this;this.options.typeahead?this._input.on("keyup.autocomplete",function(){b&&clearTimeout(b),b=setTimeout(a,c.options.delay)}):this._input.off("keyup.autocomplete")},_setSuggestions:function(){var b=this;this.options.showsuggestions?(0===this._suggestionsBtn.length&&(this._suggestionsBtn=a("<button/>",{"class":"autocomplete-suggestion-toggle"}),this._suggestionsBtn.appendTo(this.$element)),this._suggestionsBtn.fipo("tap","click",function(a){a.preventDefault(),b._selectListWidget.options.visible?b._selectListWidget.hide():b.handleInput(null,b._selectListWidget)}).finger("click",!1),this._input.addClass("autocomplete-has-suggestion-btn")):(this._suggestionsBtn.remove(),this._input.removeClass("autocomplete-has-suggestion-btn"))},_makeAccessible:function(){this.$element.attr({role:"combobox","aria-multiselectable":this.options.multiple,"aria-autocomplete":this.options.typeahead?"list":"","aria-owns":this._selectlist.attr("id")||""}),this.$element.on("keydown",'li[role="option"]',function(b){a(b.currentTarget);switch(b.which){case 13:break;case 27:break;case 40:}})},_addTag:function(a){13===a.which&&(this._tagList.addItem(this._input.val()),this.clear())},_handleSelected:function(a){this._selectListWidget.hide(),this.options.multiple?this._tagList.addItem(a.displayedValue):this._input.val(a.displayedValue),this._input.trigger("focus")},handleInput:function(b){this.$element.trigger(a.Event("query",{value:b})),"static"===this._selectListWidget.options.type?this._handleStaticFilter(b):"dynamic"===this._selectListWidget.options.type&&this._handleDynamicFilter(b),this._selectListWidget.show()},_handleStaticFilter:function(b){var c=this,d=this._selectlist.find('[role="option"]');b?d.each(function(d,e){var f,g=a(e),h=g.text();c.options.ignorecase&&(h=h.toLowerCase(),b=b.toLowerCase()),f="starts"===c.options.mode?0===h.lastIndexOf(b,0):"contains"===c.options.mode?-1!==h.search(b):!1,g.toggle(f)}):d.show()},_handleDynamicFilter:function(a){this._selectListWidget.set("dataadditional",{query:a}),this._selectListWidget.triggerLoadData(!0)},clear:function(){this._input.val("")},disable:function(){this.$element.addClass("disabled"),this.$element.attr("aria-disabled",!0),this._input.prop("disabled",!0),this._suggestionsBtn.prop("disabled",!0)},enable:function(){this.$element.removeClass("disabled"),this.$element.attr("aria-disabled",!1),this._input.prop("disabled",!1),this._suggestionsBtn.prop("disabled",!1)}}),CUI.util.plugClass(CUI.Autocomplete),CUI.options.dataAPI&&a(document).on("cui-contentloaded.data-api",function(b){a("[data-init~=autocomplete]",b.target).autocomplete()})}(jQuery,this),function(a){"use strict";var b="<button type='button' class='multifield-add icon-add-circle medium'/>",c="<button type='button' class='multifield-remove icon-minus-circle medium'/>",d="<button type='button' class='multifield-move icon-navigation medium'/>",e="<li><div class='multifield-placeholder'></div>"+c+d+"</li>";CUI.Multifield=new Class({toString:"Multifield",extend:CUI.Widget,construct:function(){this.script=this.$element.find("script[type='text/html']"),this.ol=this.$element.children("ol"),0===this.ol.length&&(this.ol=a("<ol>").prependTo(this.$element)),this._adjustMarkup(),this._addListeners()},_adjustMarkup:function(){this.$element.toggleClass("multifield",!0),this.ol.children("li").append(c).append(d),this.ol.after(b)},_addListeners:function(){var b=this;this.$element.on("click",".multifield-add",function(){var c=a(e);c.find(".multifield-placeholder").replaceWith(b.script.html().trim()),c.appendTo(b.ol),a(b.ol).trigger("cui-contentloaded")}),this.$element.on("click",".multifield-remove",function(){a(this).closest("li").remove()}),this.$element.fipo("taphold","mousedown",".multifield-move",function(c){c.preventDefault();var d=a(this).closest("li");d.prevAll().addClass("drag-before"),d.nextAll().addClass("drag-after"),b.ol.css({height:b.ol.height()+a(c.item).height()+"px"}),new CUI.DragAction(c,b.$element,d,[b.ol],"vertical")}).on("dragenter",function(a){b.ol.addClass("drag-over"),b._reorderPreview(a)}).on("dragover",function(a){b._reorderPreview(a)}).on("dragleave",function(){b.ol.removeClass("drag-over").children().removeClass("drag-before drag-after")}).on("drop",function(c){b._reorder(a(c.item)),b.ol.children().removeClass("drag-before drag-after")}).on("dragend",function(){b.ol.css({height:""})})},_reorder:function(a){var b=this.ol.children(".drag-after").first(),c=this.ol.children(".drag-before").last();b.length>0&&a.insertBefore(b),c.length>0&&a.insertAfter(c)},_reorderPreview:function(b){var c=this._pagePosition(b);this.ol.children(":not(.dragging)").each(function(){var b=a(this),d=c.y<b.offset().top+b.outerHeight()/2;b.toggleClass("drag-after",d),b.toggleClass("drag-before",!d)})},_pagePosition:function(a){var b={};if(a.originalEvent){var c=a.originalEvent;c.changedTouches&&c.changedTouches.length>0&&(b=c.changedTouches[0]),c.touches&&c.touches.length>0&&(b=c.touches[0])}return{x:b.pageX||a.pageX,y:b.pageY||a.pageY}}}),CUI.util.plugClass(CUI.Multifield),CUI.options.dataAPI&&a(document).on("cui-contentloaded.data-api",function(b){a("[data-init~=multifield]",b.target).multifield()})}(jQuery,window.console),function(a,b){"use strict";function c(b,c){var d=b.next(".form-error");b.attr("aria-invalid","true").toggleClass("error",!0),0===d.length?b.after(a("<span class='form-error' data-init='quicktip' data-quicktip-arrow='top' data-quicktip-type='error' />").html(c)):d.html(c)}function d(a){a.removeAttr("aria-invalid").removeClass("error"),a.next(".form-error").remove()}return a.message&&a.validator?(a.message.register({selector:"*",message:{"validation.required":"Please fill out this field."}}),a.message.register({selector:":lang(de)",message:{}}),a(document).on("cui-contentloaded",function(b){a(":submittable",b.target).on("invalid",function(b){if(!b.isJqueryValidator){b.preventDefault();var c=a(this);c.checkValidity(),c.updateErrorUI()}})}),a.validator.register({selector:"form *",show:c,clear:d}),a.validator.register({selector:"form .fieldwrapper .field",show:function(b,c){b.attr("aria-invalid","true").toggleClass("error",!0),b.nextAll(".fieldinfo").addClass("hidden-accessible");var d=b.nextAll(".fielderror");if(0===d.length){var e=b.closest("form").hasClass("vertical")?"right":"top";a("<span class='fielderror form-error small' data-init='quicktip' data-quicktip-type='error' />").attr("data-quicktip-arrow",e).html(c).insertAfter(b)}else d.html(c)},clear:function(a){a.removeAttr("aria-invalid").removeClass("error").nextAll(".fielderror").remove(),a.nextAll(".fieldinfo").removeClass("hidden-accessible")}}),a.validator.register({selector:"form input, form textarea",validate:function(a){var b=a.prop("required")===!0||void 0===a.prop("required")&&void 0!==a.attr("required")||"true"===a.attr("aria-required");return b&&0===a.val().length?a.message("validation.required")||"required":void 0}}),a(document).on("input","form input, form textarea",function(){var b=a(this);b.checkValidity(),b.updateErrorUI()}),a.validator.register({selector:"[role=listbox]",validate:function(b){if("true"===b.attr("aria-required")){var c=!1;return b.find("[role=option]").each(function(){return"true"===a(this).attr("aria-selected")?(c=!0,!1):void 0}),c?void 0:b.message("validation.required")||"required"}}}),void 0):(b&&b.warn("$.message and/or $.validator are not available, thus nothing is registered."),void 0)}(jQuery,window.console);